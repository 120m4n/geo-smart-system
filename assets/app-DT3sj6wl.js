import{i as e}from"./core-components-3sVhZi7P.js";import{c as n,a as t}from"./optional-components-CtGkecLC.js";import{i as o}from"./utils-BjG0z9UU.js";import"./maps-BlyNy95n.js";import"./ui-DXU7C635.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&n(e)}).observe(document,{childList:!0,subtree:!0})}function n(e){if(e.ep)return;e.ep=!0;const n=function(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?n.credentials="include":"anonymous"===e.crossOrigin?n.credentials="omit":n.credentials="same-origin",n}(e);fetch(e.href,n)}}();class r extends HTMLElement{constructor(){super(),this.shadowDOM=this.attachShadow({mode:"open"}),this.expanded=!1}connectedCallback(){this.render(),this.shadowDOM.querySelector(".toggle-button").addEventListener("click",()=>this.togglePanel()),this.shadowDOM.querySelector(".extra-button").addEventListener("click",e=>this.handleExtraButtonClick(e))}togglePanel(){this.expanded=!this.expanded,this.updatePanel()}handleExtraButtonClick(e){e.stopPropagation();const n=new CustomEvent("flushdb-click",{detail:{},bubbles:!0,composed:!0});this.dispatchEvent(n)}updatePanel(){const e=this.shadowDOM.querySelector(".content"),n=this.shadowDOM.querySelector(".extra-button");this.expanded?(e.style.transform="translateY(0)",e.style.height="80vh",n.style.display="block"):(e.style.transform="translateY(calc(100% - 3px))",e.style.height="0px",n.style.display="none")}render(){this.shadowDOM.innerHTML=`\n            ${this.templateCss()}\n            ${this.template()}\n        `,this.updatePanel()}template(){return'\n        <div class="panel">\n            <div class="header">\n                <button class="toggle-button">Avatares</button>\n                <button class="extra-button" style="display:none;"></button>\n            </div>\n            <div class="content">\n                <slot></slot>\n            </div>\n        </div>\n    '}templateCss(){return"\n        <style>\n            .panel {\n                position: fixed;\n                bottom: 16px;\n                right: 16px;\n                max-width: 260px;\n                width: 240px;\n                border-radius: 10px 10px 8px 8px;\n                border: 1px solid #d0d0d0;\n                box-shadow: 0 4px 16px rgba(0,0,0,0.08);\n                background: #fff;\n                transform-origin: bottom;\n                overflow: hidden;\n                z-index: 1000;\n            }\n            .header {\n                display: flex;\n                flex-direction: row;\n                align-items: center;\n                width: 100%;\n            }\n            .toggle-button {\n                flex: 1 1 auto;\n                background-color: #1976d2;\n                color: #fff;\n                border: none;\n                padding: 0 10px;\n                height: 48px;\n                font-size: 1rem;\n                font-weight: 500;\n                border-radius: 10px 0 0 0;\n                cursor: pointer;\n                transition: background 0.2s;\n                text-align: left;\n            }\n            .toggle-button:hover {\n                background-color: #1565c0;\n            }\n            .extra-button {\n                flex: 0 0 auto;\n                background-color: #fff;\n                color: #1976d2;\n                border: none;\n                height: 24px;\n                width: 24px;\n                margin: 0 6px 0 6px;\n                border-radius: 0 10px 0 0;\n                cursor: pointer;\n                transition: background 0.2s, color 0.2s;\n                background-image: url('assets/icons8-basura-24.png');\n                background-size: cover;\n                background-position: center;\n                background-repeat: no-repeat;\n            }\n            .extra-button:hover {\n                background-color: #e3eafc;\n                color: #1565c0;\n            }\n            .content {\n                background: #fafbfc;\n                border-radius: 0 0 8px 8px;\n                box-shadow: 0 1px 4px rgba(0,0,0,0.03);\n                transform: translateY(calc(100% - 48px));\n                overflow-y: auto;\n                transition: transform 1s, height 1s;\n                padding: 10px 8px 8px 8px;\n                min-height: 0;\n                max-height: 70vh;\n            }\n            \n            /* Dispositivos m칩viles peque침os (iPhone SE: 375px) */\n            @media (max-width: 414px) {\n                .panel {\n                    right: 8px;\n                    bottom: 8px;\n                    width: 280px;\n                    max-width: calc(100vw - 16px);\n                }\n                .content {\n                    max-height: 60vh;\n                    padding: 8px 6px 6px 6px;\n                }\n                .toggle-button {\n                    font-size: 0.9rem;\n                    padding: 0 8px;\n                    height: 44px;\n                }\n                .extra-button {\n                    height: 22px;\n                    width: 22px;\n                    margin: 0 4px 0 4px;\n                }\n            }\n            \n            /* iPhone SE espec칤fico (375px) */\n            @media (max-width: 375px) {\n                .panel {\n                    right: 6px;\n                    bottom: 6px;\n                    width: 260px;\n                    max-width: calc(100vw - 12px);\n                }\n                .content {\n                    max-height: 55vh;\n                    padding: 6px 5px 5px 5px;\n                }\n                .toggle-button {\n                    font-size: 0.85rem;\n                    padding: 0 6px;\n                    height: 42px;\n                }\n            }\n            \n            /* Dispositivos muy peque침os */\n            @media (max-width: 320px) {\n                .panel {\n                    right: 4px;\n                    bottom: 4px;\n                    width: 240px;\n                    max-width: calc(100vw - 8px);\n                }\n                .content {\n                    max-height: 50vh;\n                    padding: 6px 4px 4px 4px;\n                }\n                .toggle-button {\n                    font-size: 0.8rem;\n                    padding: 0 5px;\n                    height: 40px;\n                }\n                .extra-button {\n                    height: 20px;\n                    width: 20px;\n                    margin: 0 3px 0 3px;\n                }\n            }\n        </style>\n    "}}customElements.define("side-panel",r);class i extends HTMLElement{constructor(){super(),this.shadowDOM=this.attachShadow({mode:"open"})}connectedCallback(){this.render(),this.shadowDOM.querySelector(".image").addEventListener("click",()=>this.handleImageClick()),this.shadowDOM.querySelector(".btn_clear").addEventListener("click",()=>this.handleBtnClearClick()),this.shadowDOM.querySelector(".btn_history").addEventListener("click",()=>this.handleBtnHistoryClick())}handleBtnClearClick(){const e=this.getAttribute("id"),n=new CustomEvent("clear-click",{detail:{id:e},bubbles:!0,composed:!0});this.dispatchEvent(n)}handleImageClick(){const e=this.getAttribute("id"),n=new CustomEvent("avatar-click",{detail:{id:e},bubbles:!0,composed:!0});this.dispatchEvent(n)}handleBtnHistoryClick(){const e=this.getAttribute("id"),n=new CustomEvent("avatar-history-click",{detail:{id:e},bubbles:!0,composed:!0});this.dispatchEvent(n)}render(){this.shadowDOM.innerHTML=`\n            ${this.templateCss()}\n            ${this.template()}\n        `}template(){return`\n            <div class="container">\n                <img src="${this.getAttribute("img-src")||""}" alt="Image" class="image" onerror="this.onerror=null;this.src='assets/hacker.png';">\n                <div class="content">\n                    <span class="title">${this.getAttribute("title")||"Title"}</span>\n                    <span class="subtitle">${this.getAttribute("subtitle")||"Subtitle"}</span>\n                </div>\n                <div class="controls">\n                    <div class="btn_history" title="Ver historial"></div>\n                    <div class="btn_clear"></div>\n                </div>\n            </div>\n        `}templateCss(){return"\n            <style>\n                .container {\n                    display: flex;\n                    align-items: center;\n                    width: 100%;\n                    height: 53px;\n                    min-width: 0;\n                    box-sizing: border-box;\n                    padding-left: 3px;\n                    padding-right: 3px;\n                    border-bottom: 1px solid #aaa;\n                    background-color: #f9f9f9;\n                }\n                .image {\n                    width: 47px;\n                    height: 47px;\n                    object-fit: cover;\n                    cursor: pointer;\n                    border-radius: 4px;\n                    flex-shrink: 0;\n                }\n                .content {\n                    display: flex;\n                    flex-direction: column;\n                    justify-content: center;\n                    padding-left: 10px;\n                    flex-grow: 1;\n                    min-width: 0;\n                    overflow: hidden;\n                }\n                .title {\n                    font-weight: bold;\n                    white-space: nowrap;\n                    overflow: hidden;\n                    text-overflow: ellipsis;\n                    max-width: 140px;\n                    display: block;\n                    font-size: 0.9rem;\n                    line-height: 1.2;\n                }\n                .subtitle {\n                    color: grey;\n                    font-size: 0.8rem;\n                    white-space: nowrap;\n                    overflow: hidden;\n                    text-overflow: ellipsis;\n                    max-width: 140px;\n                }\n                .controls {\n                    display: flex;\n                    flex-direction: row;\n                    align-items: center;\n                    justify-content: flex-end;\n                    width: 50px;\n                    height: 100%;\n                    box-sizing: border-box;\n                    padding-top: 2px;\n                    gap: 4px;\n                    flex-shrink: 0;\n                }\n                .btn_clear {\n                    background: none;\n                    cursor: pointer;\n                    padding: 0;\n                    width: 24px;\n                    height: 24px;\n                    background-image: url('assets/icons8-close-24.png');\n                    background-size: cover;\n                    background-position: center;\n                    background-repeat: no-repeat;\n                    border: none;\n                    outline: none;\n                    transition: opacity 0.2s ease;\n                }\n                .btn_clear:hover {\n                    opacity: 0.7;\n                }\n                .btn_clear:active {\n                    opacity: 0.5;\n                }\n                .btn_history {\n                    background: none;\n                    cursor: pointer;\n                    padding: 0;\n                    width: 22px;\n                    height: 22px;\n                    background-image: url('assets/icons8-ruta-50.png');\n                    background-size: cover;\n                    background-position: center;\n                    background-repeat: no-repeat;\n                    border: none;\n                    outline: none;\n                    transition: opacity 0.2s ease;\n                }\n                .btn_history:hover {\n                    opacity: 0.7;\n                }\n                .btn_history:active {\n                    opacity: 0.5;\n                }\n                \n                /* Dispositivos m칩viles peque침os (iPhone SE: 375px) */\n                @media (max-width: 414px) {\n                    .container {\n                        height: 50px;\n                        padding-left: 2px;\n                        padding-right: 2px;\n                    }\n                    .image {\n                        width: 42px;\n                        height: 42px;\n                    }\n                    .content {\n                        padding-left: 8px;\n                    }\n                    .title {\n                        font-size: 0.85rem;\n                        max-width: 120px;\n                    }\n                    .subtitle {\n                        font-size: 0.75rem;\n                        max-width: 120px;\n                    }\n                    .controls {\n                        width: 45px;\n                        gap: 3px;\n                    }\n                    .btn_clear {\n                        width: 22px;\n                        height: 22px;\n                    }\n                    .btn_history {\n                        width: 20px;\n                        height: 20px;\n                    }\n                }\n                \n                /* iPhone SE espec칤fico (375px) */\n                @media (max-width: 375px) {\n                    .container {\n                        height: 48px;\n                        padding-left: 2px;\n                        padding-right: 2px;\n                    }\n                    .image {\n                        width: 40px;\n                        height: 40px;\n                    }\n                    .content {\n                        padding-left: 6px;\n                    }\n                    .title {\n                        font-size: 0.8rem;\n                        max-width: 110px;\n                    }\n                    .subtitle {\n                        font-size: 0.7rem;\n                        max-width: 110px;\n                    }\n                    .controls {\n                        width: 42px;\n                        gap: 2px;\n                    }\n                    .btn_clear {\n                        width: 20px;\n                        height: 20px;\n                    }\n                    .btn_history {\n                        width: 18px;\n                        height: 18px;\n                    }\n                }\n                \n                /* Dispositivos muy peque침os */\n                @media (max-width: 320px) {\n                    .container {\n                        height: 46px;\n                        padding-left: 1px;\n                        padding-right: 1px;\n                    }\n                    .image {\n                        width: 38px;\n                        height: 38px;\n                    }\n                    .content {\n                        padding-left: 5px;\n                    }\n                    .title {\n                        font-size: 0.75rem;\n                        max-width: 100px;\n                    }\n                    .subtitle {\n                        font-size: 0.65rem;\n                        max-width: 100px;\n                    }\n                    .controls {\n                        width: 38px;\n                        gap: 2px;\n                    }\n                    .btn_clear {\n                        width: 18px;\n                        height: 18px;\n                    }\n                    .btn_history {\n                        width: 16px;\n                        height: 16px;\n                    }\n                }\n                \n                /* Mejoras de accesibilidad t치ctil para m칩viles */\n                @media (max-width: 768px) {\n                    .btn_clear,\n                    .btn_history {\n                        min-width: 24px;\n                        min-height: 24px;\n                        position: relative;\n                    }\n                    \n                    /* 츼rea t치ctil m치s grande sin cambiar el dise침o visual */\n                    .btn_clear::before,\n                    .btn_history::before {\n                        content: '';\n                        position: absolute;\n                        top: -4px;\n                        left: -4px;\n                        right: -4px;\n                        bottom: -4px;\n                    }\n                    \n                    .image {\n                        transition: transform 0.1s ease;\n                    }\n                    \n                    .image:active {\n                        transform: scale(0.95);\n                    }\n                }\n            </style>\n        "}static get observedAttributes(){return["img-src","title","subtitle","id"]}attributeChangedCallback(e,n,t){n!==t&&this.render()}}function a(e){if(!(this instanceof a))throw new Error("The 'Keycloak' constructor must be invoked with 'new'.");if("string"!=typeof e&&!c(e))throw new Error("The 'Keycloak' constructor must be provided with a configuration object, or a URL to a JSON configuration file.");if(c(e)){const n="oidcProvider"in e?["clientId"]:["url","realm","clientId"];for(const t of n)if(!e[t])throw new Error(`The configuration object is missing the required '${t}' property.`)}var n,t,o=this,r=[],i={enable:!0,callbackList:[],interval:5};o.didInitialize=!1;var l=!0,d=I(console.info),u=I(console.warn);function p(e){return function(e,n){for(var t=function(e){if("undefined"==typeof crypto||void 0===crypto.getRandomValues)throw new Error("Web Crypto API is not available.");return crypto.getRandomValues(new Uint8Array(e))}(e),o=new Array(e),r=0;r<e;r++)o[r]=n.charCodeAt(t[r]%n.length);return String.fromCharCode.apply(null,o)}(e,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789")}async function h(e,n){if("S256"!==e)throw new TypeError(`Invalid value for 'pkceMethod', expected 'S256' but got '${e}'.`);return function(e){const n=String.fromCodePoint(...e);return btoa(n)}(new Uint8Array(await async function(e){const n=(new TextEncoder).encode(e);if("undefined"==typeof crypto||void 0===crypto.subtle)throw new Error("Web Crypto API is not available.");return await crypto.subtle.digest("SHA-256",n)}(n))).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}function f(){return void 0!==o.authServerUrl?"/"==o.authServerUrl.charAt(o.authServerUrl.length-1)?o.authServerUrl+"realms/"+encodeURIComponent(o.realm):o.authServerUrl+"/realms/"+encodeURIComponent(o.realm):void 0}function g(e,n){var t=e.code,r=e.error,i=e.prompt,a=(new Date).getTime();if(e.kc_action_status&&o.onActionUpdate&&o.onActionUpdate(e.kc_action_status,e.kc_action),r)if("none"!=i)if(e.error_description&&"authentication_expired"===e.error_description)o.login(e.loginOptions);else{var s={error:r,error_description:e.error_description};o.onAuthError&&o.onAuthError(s),n&&n.setError(s)}else n&&n.setSuccess();else if("standard"!=o.flow&&(e.access_token||e.id_token)&&h(e.access_token,null,e.id_token,!0),"implicit"!=o.flow&&t){var c="code="+t+"&grant_type=authorization_code",u=o.endpoints.token(),p=new XMLHttpRequest;p.open("POST",u,!0),p.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c+="&client_id="+encodeURIComponent(o.clientId),c+="&redirect_uri="+e.redirectUri,e.pkceCodeVerifier&&(c+="&code_verifier="+e.pkceCodeVerifier),p.withCredentials=!0,p.onreadystatechange=function(){if(4==p.readyState)if(200==p.status){var e=JSON.parse(p.responseText);h(e.access_token,e.refresh_token,e.id_token,"standard"===o.flow),S()}else o.onAuthError&&o.onAuthError(),n&&n.setError()},p.send(c)}function h(t,r,i,s){k(t,r,i,a=(a+(new Date).getTime())/2),l&&o.idTokenParsed&&o.idTokenParsed.nonce!=e.storedNonce?(d("[KEYCLOAK] Invalid nonce, clearing token"),o.clearToken(),n&&n.setError()):s&&(o.onAuthSuccess&&o.onAuthSuccess(),n&&n.setSuccess())}}function m(e){return 0==e.status&&e.responseText&&e.responseURL.startsWith("file:")}function k(e,n,t,r){if(o.tokenTimeoutHandle&&(clearTimeout(o.tokenTimeoutHandle),o.tokenTimeoutHandle=null),n?(o.refreshToken=n,o.refreshTokenParsed=s(n)):(delete o.refreshToken,delete o.refreshTokenParsed),t?(o.idToken=t,o.idTokenParsed=s(t)):(delete o.idToken,delete o.idTokenParsed),e){if(o.token=e,o.tokenParsed=s(e),o.sessionId=o.tokenParsed.sid,o.authenticated=!0,o.subject=o.tokenParsed.sub,o.realmAccess=o.tokenParsed.realm_access,o.resourceAccess=o.tokenParsed.resource_access,r&&(o.timeSkew=Math.floor(r/1e3)-o.tokenParsed.iat),null!=o.timeSkew&&(d("[KEYCLOAK] Estimated time difference between browser and server is "+o.timeSkew+" seconds"),o.onTokenExpired)){var i=1e3*(o.tokenParsed.exp-(new Date).getTime()/1e3+o.timeSkew);d("[KEYCLOAK] Token expires in "+Math.round(i/1e3)+" s"),i<=0?o.onTokenExpired():o.tokenTimeoutHandle=setTimeout(o.onTokenExpired,i)}}else delete o.token,delete o.tokenParsed,delete o.subject,delete o.realmAccess,delete o.resourceAccess,o.authenticated=!1}function v(){if("undefined"==typeof crypto||void 0===crypto.randomUUID)throw new Error("Web Crypto API is not available.");return crypto.randomUUID()}function w(e){var n=function(e){var n;switch(o.flow){case"standard":n=["code","state","session_state","kc_action_status","kc_action","iss"];break;case"implicit":n=["access_token","token_type","id_token","state","session_state","expires_in","kc_action_status","kc_action","iss"];break;case"hybrid":n=["access_token","token_type","id_token","code","state","session_state","expires_in","kc_action_status","kc_action","iss"]}n.push("error"),n.push("error_description"),n.push("error_uri");var t,r,i=e.indexOf("?"),a=e.indexOf("#");"query"===o.responseMode&&-1!==i?(t=e.substring(0,i),""!==(r=b(e.substring(i+1,-1!==a?a:e.length),n)).paramsString&&(t+="?"+r.paramsString),-1!==a&&(t+=e.substring(a))):"fragment"===o.responseMode&&-1!==a&&(t=e.substring(0,a),""!==(r=b(e.substring(a+1),n)).paramsString&&(t+="#"+r.paramsString));if(r&&r.oauthParams)if("standard"===o.flow||"hybrid"===o.flow){if((r.oauthParams.code||r.oauthParams.error)&&r.oauthParams.state)return r.oauthParams.newUrl=t,r.oauthParams}else if("implicit"===o.flow&&(r.oauthParams.access_token||r.oauthParams.error)&&r.oauthParams.state)return r.oauthParams.newUrl=t,r.oauthParams}(e);if(n){var r=t.get(n.state);return r&&(n.valid=!0,n.redirectUri=r.redirectUri,n.storedNonce=r.nonce,n.prompt=r.prompt,n.pkceCodeVerifier=r.pkceCodeVerifier,n.loginOptions=r.loginOptions),n}}function b(e,n){for(var t=e.split("&"),o={paramsString:"",oauthParams:{}},r=0;r<t.length;r++){var i=t[r].indexOf("="),a=t[r].slice(0,i);-1!==n.indexOf(a)?o.oauthParams[a]=t[r].slice(i+1):(""!==o.paramsString&&(o.paramsString+="&"),o.paramsString+=t[r])}return o}function x(){var e={setSuccess:function(n){e.resolve(n)},setError:function(n){e.reject(n)}};return e.promise=new Promise(function(n,t){e.resolve=n,e.reject=t}),e}function y(){var e=x();if(!i.enable)return e.setSuccess(),e.promise;if(i.iframe)return e.setSuccess(),e.promise;var n=document.createElement("iframe");i.iframe=n,n.onload=function(){var n=o.endpoints.authorize();"/"===n.charAt(0)?i.iframeOrigin=window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""):i.iframeOrigin=n.substring(0,n.indexOf("/",8)),e.setSuccess()};var t=o.endpoints.checkSessionIframe();n.setAttribute("src",t),n.setAttribute("sandbox","allow-storage-access-by-user-activation allow-scripts allow-same-origin"),n.setAttribute("title","keycloak-session-iframe"),n.style.display="none",document.body.appendChild(n);return window.addEventListener("message",function(e){if(e.origin===i.iframeOrigin&&i.iframe.contentWindow===e.source&&("unchanged"==e.data||"changed"==e.data||"error"==e.data)){"unchanged"!=e.data&&o.clearToken();for(var n=i.callbackList.splice(0,i.callbackList.length),t=n.length-1;t>=0;--t){var r=n[t];"error"==e.data?r.setError():r.setSuccess("unchanged"==e.data)}}},!1),e.promise}function S(){i.enable&&o.token&&setTimeout(function(){E().then(function(e){e&&S()})},1e3*i.interval)}function E(){var e=x();if(i.iframe&&i.iframeOrigin){var n=o.clientId+" "+(o.sessionId?o.sessionId:"");i.callbackList.push(e);var t=i.iframeOrigin;1==i.callbackList.length&&i.iframe.contentWindow.postMessage(n,t)}else e.setSuccess();return e.promise}function _(e){if(!e||"default"==e)return{login:async function(e){return window.location.assign(await o.createLoginUrl(e)),x().promise},logout:async function(e){if("GET"===((null==e?void 0:e.logoutMethod)??o.logoutMethod))return void window.location.replace(o.createLogoutUrl(e));const t=document.createElement("form");t.setAttribute("method","POST"),t.setAttribute("action",o.createLogoutUrl(e)),t.style.display="none";const r={id_token_hint:o.idToken,client_id:o.clientId,post_logout_redirect_uri:n.redirectUri(e,!1)};for(const[n,o]of Object.entries(r)){const e=document.createElement("input");e.setAttribute("type","hidden"),e.setAttribute("name",n),e.setAttribute("value",o),t.appendChild(e)}document.body.appendChild(t),t.submit()},register:async function(e){return window.location.assign(await o.createRegisterUrl(e)),x().promise},accountManagement:function(){var e=o.createAccountUrl();if(void 0===e)throw"Not supported by the OIDC server";return window.location.href=e,x().promise},redirectUri:function(e,n){return e&&e.redirectUri?e.redirectUri:o.redirectUri?o.redirectUri:location.href}};if("cordova"==e){i.enable=!1;var t=function(e,n,t){return window.cordova&&window.cordova.InAppBrowser?window.cordova.InAppBrowser.open(e,n,t):window.open(e,n,t)},r=function(e){var n=function(e){return e&&e.cordovaOptions?Object.keys(e.cordovaOptions).reduce(function(n,t){return n[t]=e.cordovaOptions[t],n},{}):{}}(e);return n.location="no",e&&"none"==e.prompt&&(n.hidden="yes"),function(e){return Object.keys(e).reduce(function(n,t){return n.push(t+"="+e[t]),n},[]).join(",")}(n)},a=function(){return o.redirectUri||"http://localhost"};return{login:async function(e){var n=x(),i=r(e),s=await o.createLoginUrl(e),c=t(s,"_blank",i),l=!1,d=!1,u=function(){d=!0,c.close()};return c.addEventListener("loadstart",function(e){0==e.url.indexOf(a())&&(g(w(e.url),n),u(),l=!0)}),c.addEventListener("loaderror",function(e){l||(0==e.url.indexOf(a())?(g(w(e.url),n),u(),l=!0):(n.setError(),u()))}),c.addEventListener("exit",function(e){d||n.setError({reason:"closed_by_user"})}),n.promise},logout:function(e){var n,r=x(),i=o.createLogoutUrl(e),s=t(i,"_blank","location=no,hidden=yes,clearcache=yes");return s.addEventListener("loadstart",function(e){0==e.url.indexOf(a())&&s.close()}),s.addEventListener("loaderror",function(e){0==e.url.indexOf(a())||(n=!0),s.close()}),s.addEventListener("exit",function(e){n?r.setError():(o.clearToken(),r.setSuccess())}),r.promise},register:async function(e){var n=x(),i=await o.createRegisterUrl(),s=r(e),c=t(i,"_blank",s);return c.addEventListener("loadstart",function(e){0==e.url.indexOf(a())&&(c.close(),g(w(e.url),n))}),n.promise},accountManagement:function(){var e=o.createAccountUrl();if(void 0===e)throw"Not supported by the OIDC server";var n=t(e,"_blank","location=no");n.addEventListener("loadstart",function(e){0==e.url.indexOf(a())&&n.close()})},redirectUri:function(e){return a()}}}if("cordova-native"==e)return i.enable=!1,{login:async function(e){var n=x(),t=await o.createLoginUrl(e);return universalLinks.subscribe("keycloak",function(e){universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close(),g(w(e.url),n)}),window.cordova.plugins.browsertab.openUrl(t),n.promise},logout:function(e){var n=x(),t=o.createLogoutUrl(e);return universalLinks.subscribe("keycloak",function(e){universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close(),o.clearToken(),n.setSuccess()}),window.cordova.plugins.browsertab.openUrl(t),n.promise},register:async function(e){var n=x(),t=await o.createRegisterUrl(e);return universalLinks.subscribe("keycloak",function(e){universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close(),g(w(e.url),n)}),window.cordova.plugins.browsertab.openUrl(t),n.promise},accountManagement:function(){var e=o.createAccountUrl();if(void 0===e)throw"Not supported by the OIDC server";window.cordova.plugins.browsertab.openUrl(e)},redirectUri:function(e){return e&&e.redirectUri?e.redirectUri:o.redirectUri?o.redirectUri:"http://localhost"}};throw"invalid adapter type: "+e}globalThis.isSecureContext||u("[KEYCLOAK] Keycloak JS must be used in a 'secure context' to function properly as it relies on browser APIs that are otherwise not available.\nContinuing to run your application insecurely will lead to unexpected behavior and breakage.\n\nFor more information see: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts"),o.init=function(r={}){if(o.didInitialize)throw new Error("A 'Keycloak' instance can only be initialized once.");o.didInitialize=!0,o.authenticated=!1,t=function(){try{return new C}catch(e){}return new A}();if(n=["default","cordova","cordova-native"].indexOf(r.adapter)>-1?_(r.adapter):"object"==typeof r.adapter?r.adapter:window.Cordova||window.cordova?_("cordova"):_(),void 0!==r.useNonce&&(l=r.useNonce),void 0!==r.checkLoginIframe&&(i.enable=r.checkLoginIframe),r.checkLoginIframeInterval&&(i.interval=r.checkLoginIframeInterval),"login-required"===r.onLoad&&(o.loginRequired=!0),r.responseMode){if("query"!==r.responseMode&&"fragment"!==r.responseMode)throw"Invalid value for responseMode";o.responseMode=r.responseMode}if(r.flow){switch(r.flow){case"standard":o.responseType="code";break;case"implicit":o.responseType="id_token token";break;case"hybrid":o.responseType="code id_token token";break;default:throw"Invalid value for flow"}o.flow=r.flow}if(null!=r.timeSkew&&(o.timeSkew=r.timeSkew),r.redirectUri&&(o.redirectUri=r.redirectUri),r.silentCheckSsoRedirectUri&&(o.silentCheckSsoRedirectUri=r.silentCheckSsoRedirectUri),"boolean"==typeof r.silentCheckSsoFallback?o.silentCheckSsoFallback=r.silentCheckSsoFallback:o.silentCheckSsoFallback=!0,void 0!==r.pkceMethod){if("S256"!==r.pkceMethod&&!1!==r.pkceMethod)throw new TypeError(`Invalid value for pkceMethod', expected 'S256' or false but got ${r.pkceMethod}.`);o.pkceMethod=r.pkceMethod}else o.pkceMethod="S256";"boolean"==typeof r.enableLogging?o.enableLogging=r.enableLogging:o.enableLogging=!1,"POST"===r.logoutMethod?o.logoutMethod="POST":o.logoutMethod="GET","string"==typeof r.scope&&(o.scope=r.scope),"string"==typeof r.acrValues&&(o.acrValues=r.acrValues),"number"==typeof r.messageReceiveTimeout&&r.messageReceiveTimeout>0?o.messageReceiveTimeout=r.messageReceiveTimeout:o.messageReceiveTimeout=1e4,o.responseMode||(o.responseMode="fragment"),o.responseType||(o.responseType="code",o.flow="standard");var a=x(),s=x();s.promise.then(function(){o.onReady&&o.onReady(o.authenticated),a.setSuccess(o.authenticated)}).catch(function(e){a.setError(e)});var c=function(){var n,t=x();"string"==typeof e&&(n=e);function r(e){o.endpoints=e?{authorize:function(){return e.authorization_endpoint},token:function(){return e.token_endpoint},logout:function(){if(!e.end_session_endpoint)throw"Not supported by the OIDC server";return e.end_session_endpoint},checkSessionIframe:function(){if(!e.check_session_iframe)throw"Not supported by the OIDC server";return e.check_session_iframe},register:function(){throw'Redirection to "Register user" page not supported in standard OIDC mode'},userinfo:function(){if(!e.userinfo_endpoint)throw"Not supported by the OIDC server";return e.userinfo_endpoint}}:{authorize:function(){return f()+"/protocol/openid-connect/auth"},token:function(){return f()+"/protocol/openid-connect/token"},logout:function(){return f()+"/protocol/openid-connect/logout"},checkSessionIframe:function(){return f()+"/protocol/openid-connect/login-status-iframe.html"},thirdPartyCookiesIframe:function(){return f()+"/protocol/openid-connect/3p-cookies/step1.html"},register:function(){return f()+"/protocol/openid-connect/registrations"},userinfo:function(){return f()+"/protocol/openid-connect/userinfo"}}}if(n){(a=new XMLHttpRequest).open("GET",n,!0),a.setRequestHeader("Accept","application/json"),a.onreadystatechange=function(){if(4==a.readyState)if(200==a.status||m(a)){var e=JSON.parse(a.responseText);o.authServerUrl=e["auth-server-url"],o.realm=e.realm,o.clientId=e.resource,r(null),t.setSuccess()}else t.setError()},a.send()}else{o.clientId=e.clientId;var i,a,s=e.oidcProvider;if(s)if("string"==typeof s)i="/"==s.charAt(s.length-1)?s+".well-known/openid-configuration":s+"/.well-known/openid-configuration",(a=new XMLHttpRequest).open("GET",i,!0),a.setRequestHeader("Accept","application/json"),a.onreadystatechange=function(){4==a.readyState&&(200==a.status||m(a)?(r(JSON.parse(a.responseText)),t.setSuccess()):t.setError())},a.send();else r(s),t.setSuccess();else o.authServerUrl=e.url,o.realm=e.realm,r(null),t.setSuccess()}return t.promise}();function d(){var e=function(e){e||(t.prompt="none"),r.locale&&(t.locale=r.locale),o.login(t).then(function(){s.setSuccess()}).catch(function(e){s.setError(e)})},n=async function(){var e=document.createElement("iframe"),n=await o.createLoginUrl({prompt:"none",redirectUri:o.silentCheckSsoRedirectUri});e.setAttribute("src",n),e.setAttribute("sandbox","allow-storage-access-by-user-activation allow-scripts allow-same-origin"),e.setAttribute("title","keycloak-silent-check-sso"),e.style.display="none",document.body.appendChild(e);var t=function(n){n.origin===window.location.origin&&e.contentWindow===n.source&&(g(w(n.data),s),document.body.removeChild(e),window.removeEventListener("message",t))};window.addEventListener("message",t)},t={};switch(r.onLoad){case"check-sso":i.enable?y().then(function(){E().then(function(t){t?s.setSuccess():o.silentCheckSsoRedirectUri?n():e(!1)}).catch(function(e){s.setError(e)})}):o.silentCheckSsoRedirectUri?n():e(!1);break;case"login-required":e(!0);break;default:throw"Invalid value for onLoad"}}function p(){var e=w(window.location.href);if(e&&window.history.replaceState(window.history.state,null,e.newUrl),e&&e.valid)return y().then(function(){g(e,s)}).catch(function(e){s.setError(e)});r.token&&r.refreshToken?(k(r.token,r.refreshToken,r.idToken),i.enable?y().then(function(){E().then(function(e){e?(o.onAuthSuccess&&o.onAuthSuccess(),s.setSuccess(),S()):s.setSuccess()}).catch(function(e){s.setError(e)})}):o.updateToken(-1).then(function(){o.onAuthSuccess&&o.onAuthSuccess(),s.setSuccess()}).catch(function(e){o.onAuthError&&o.onAuthError(),r.onLoad?d():s.setError(e)})):r.onLoad?d():s.setSuccess()}return c.then(function(){(function(){var e=x();if((i.enable||o.silentCheckSsoRedirectUri)&&"function"==typeof o.endpoints.thirdPartyCookiesIframe){var n=document.createElement("iframe");n.setAttribute("src",o.endpoints.thirdPartyCookiesIframe()),n.setAttribute("sandbox","allow-storage-access-by-user-activation allow-scripts allow-same-origin"),n.setAttribute("title","keycloak-3p-check-iframe"),n.style.display="none",document.body.appendChild(n);var t=function(r){n.contentWindow===r.source&&("supported"!==r.data&&"unsupported"!==r.data||("unsupported"===r.data&&(u("[KEYCLOAK] Your browser is blocking access to 3rd-party cookies, this means:\n\n - It is not possible to retrieve tokens without redirecting to the Keycloak server (a.k.a. no support for silent authentication).\n - It is not possible to automatically detect changes to the session status (such as the user logging out in another tab).\n\nFor more information see: https://www.keycloak.org/securing-apps/javascript-adapter#_modern_browsers"),i.enable=!1,o.silentCheckSsoFallback&&(o.silentCheckSsoRedirectUri=!1)),document.body.removeChild(n),window.removeEventListener("message",t),e.setSuccess()))};window.addEventListener("message",t,!1)}else e.setSuccess();return function(e,n,t){var o=null,r=new Promise(function(e,r){o=setTimeout(function(){r({error:t})},n)});return Promise.race([e,r]).finally(function(){clearTimeout(o)})}(e.promise,o.messageReceiveTimeout,"Timeout when waiting for 3rd party check iframe message.")})().then(p).catch(function(e){a.setError(e)})}),c.catch(function(e){a.setError(e)}),a.promise},o.login=function(e){return n.login(e)},o.createLoginUrl=async function(e){var r,i=v(),a=v(),s=n.redirectUri(e),c={state:i,nonce:a,redirectUri:encodeURIComponent(s),loginOptions:e};e&&e.prompt&&(c.prompt=e.prompt),r=e&&"register"==e.action?o.endpoints.register():o.endpoints.authorize();var d=e&&e.scope||o.scope;d?-1===d.indexOf("openid")&&(d="openid "+d):d="openid";var u,f,g=r+"?client_id="+encodeURIComponent(o.clientId)+"&redirect_uri="+encodeURIComponent(s)+"&state="+encodeURIComponent(i)+"&response_mode="+encodeURIComponent(o.responseMode)+"&response_type="+encodeURIComponent(o.responseType)+"&scope="+encodeURIComponent(d);if(l&&(g=g+"&nonce="+encodeURIComponent(a)),e&&e.prompt&&(g+="&prompt="+encodeURIComponent(e.prompt)),e&&"number"==typeof e.maxAge&&(g+="&max_age="+encodeURIComponent(e.maxAge)),e&&e.loginHint&&(g+="&login_hint="+encodeURIComponent(e.loginHint)),e&&e.idpHint&&(g+="&kc_idp_hint="+encodeURIComponent(e.idpHint)),e&&e.action&&"register"!=e.action&&(g+="&kc_action="+encodeURIComponent(e.action)),e&&e.locale&&(g+="&ui_locales="+encodeURIComponent(e.locale)),e&&e.acr){var m=(u=e.acr,f={id_token:{acr:u}},JSON.stringify(f));g+="&claims="+encodeURIComponent(m)}if((e&&e.acrValues||o.acrValues)&&(g+="&acr_values="+encodeURIComponent(e.acrValues||o.acrValues)),o.pkceMethod)try{const e=p(96),n=await h(o.pkceMethod,e);c.pkceCodeVerifier=e,g+="&code_challenge="+n,g+="&code_challenge_method="+o.pkceMethod}catch(k){throw new Error("Failed to generate PKCE challenge.",{cause:k})}return t.add(c),g},o.logout=function(e){return n.logout(e)},o.createLogoutUrl=function(e){if("POST"===((null==e?void 0:e.logoutMethod)??o.logoutMethod))return o.endpoints.logout();var t=o.endpoints.logout()+"?client_id="+encodeURIComponent(o.clientId)+"&post_logout_redirect_uri="+encodeURIComponent(n.redirectUri(e,!1));return o.idToken&&(t+="&id_token_hint="+encodeURIComponent(o.idToken)),t},o.register=function(e){return n.register(e)},o.createRegisterUrl=async function(e){return e||(e={}),e.action="register",await o.createLoginUrl(e)},o.createAccountUrl=function(e){var t=f(),r=void 0;return void 0!==t&&(r=t+"/account?referrer="+encodeURIComponent(o.clientId)+"&referrer_uri="+encodeURIComponent(n.redirectUri(e))),r},o.accountManagement=function(){return n.accountManagement()},o.hasRealmRole=function(e){var n=o.realmAccess;return!!n&&n.roles.indexOf(e)>=0},o.hasResourceRole=function(e,n){if(!o.resourceAccess)return!1;var t=o.resourceAccess[n||o.clientId];return!!t&&t.roles.indexOf(e)>=0},o.loadUserProfile=function(){var e=f()+"/account",n=new XMLHttpRequest;n.open("GET",e,!0),n.setRequestHeader("Accept","application/json"),n.setRequestHeader("Authorization","bearer "+o.token);var t=x();return n.onreadystatechange=function(){4==n.readyState&&(200==n.status?(o.profile=JSON.parse(n.responseText),t.setSuccess(o.profile)):t.setError())},n.send(),t.promise},o.loadUserInfo=function(){var e=o.endpoints.userinfo(),n=new XMLHttpRequest;n.open("GET",e,!0),n.setRequestHeader("Accept","application/json"),n.setRequestHeader("Authorization","bearer "+o.token);var t=x();return n.onreadystatechange=function(){4==n.readyState&&(200==n.status?(o.userInfo=JSON.parse(n.responseText),t.setSuccess(o.userInfo)):t.setError())},n.send(),t.promise},o.isTokenExpired=function(e){if(!o.tokenParsed||!o.refreshToken&&"implicit"!=o.flow)throw"Not authenticated";if(null==o.timeSkew)return d("[KEYCLOAK] Unable to determine if token is expired as timeskew is not set"),!0;var n=o.tokenParsed.exp-Math.ceil((new Date).getTime()/1e3)+o.timeSkew;if(e){if(isNaN(e))throw"Invalid minValidity";n-=e}return n<0},o.updateToken=function(e){var n=x();if(!o.refreshToken)return n.setError(),n.promise;e=e||5;var t=function(){var t=!1;if(-1==e?(t=!0,d("[KEYCLOAK] Refreshing token: forced refresh")):o.tokenParsed&&!o.isTokenExpired(e)||(t=!0,d("[KEYCLOAK] Refreshing token: token expired")),t){var i="grant_type=refresh_token&refresh_token="+o.refreshToken,a=o.endpoints.token();if(r.push(n),1==r.length){var s=new XMLHttpRequest;s.open("POST",a,!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.withCredentials=!0,i+="&client_id="+encodeURIComponent(o.clientId);var c=(new Date).getTime();s.onreadystatechange=function(){if(4==s.readyState)if(200==s.status){d("[KEYCLOAK] Token refreshed"),c=(c+(new Date).getTime())/2;var e=JSON.parse(s.responseText);k(e.access_token,e.refresh_token,e.id_token,c),o.onAuthRefreshSuccess&&o.onAuthRefreshSuccess();for(var n=r.pop();null!=n;n=r.pop())n.setSuccess(!0)}else{u("[KEYCLOAK] Failed to refresh token"),400==s.status&&o.clearToken(),o.onAuthRefreshError&&o.onAuthRefreshError();for(n=r.pop();null!=n;n=r.pop())n.setError("Failed to refresh token: An unexpected HTTP error occurred while attempting to refresh the token.")}},s.send(i)}}else n.setSuccess(!1)};i.enable?E().then(function(){t()}).catch(function(e){n.setError(e)}):t();return n.promise},o.clearToken=function(){o.token&&(k(null,null,null),o.onAuthLogout&&o.onAuthLogout(),o.loginRequired&&o.login())};const U="kc-callback-";var C=function(){if(!(this instanceof C))return new C;localStorage.setItem("kc-test","test"),localStorage.removeItem("kc-test");function e(){const e=Date.now();for(const[o,r]of n()){const n=t(r);(null===n||n<e)&&localStorage.removeItem(o)}}function n(){return Object.entries(localStorage).filter(([e])=>e.startsWith(U))}function t(e){let n;try{n=JSON.parse(e)}catch(t){return null}return c(n)&&"expires"in n&&"number"==typeof n.expires?n.expires:null}this.get=function(n){if(n){var t=U+n,o=localStorage.getItem(t);return o&&(localStorage.removeItem(t),o=JSON.parse(o)),e(),o}},this.add=function(t){e();const o=U+t.state,r=JSON.stringify({...t,expires:Date.now()+36e5});try{localStorage.setItem(o,r)}catch(i){!function(){for(const[e]of n())localStorage.removeItem(e)}(),localStorage.setItem(o,r)}}},A=function(){if(!(this instanceof A))return new A;var e=this;e.get=function(e){if(e){var r=t(U+e);return o(U+e,"",n(-100)),r?JSON.parse(r):void 0}},e.add=function(e){o(U+e.state,JSON.stringify(e),n(60))},e.removeItem=function(e){o(e,"",n(-100))};var n=function(e){var n=new Date;return n.setTime(n.getTime()+60*e*1e3),n},t=function(e){for(var n=e+"=",t=document.cookie.split(";"),o=0;o<t.length;o++){for(var r=t[o];" "==r.charAt(0);)r=r.substring(1);if(0==r.indexOf(n))return r.substring(n.length,r.length)}return""},o=function(e,n,t){var o=e+"="+n+"; expires="+t.toUTCString()+"; ";document.cookie=o}};function I(e){return function(){o.enableLogging&&e.apply(console,Array.prototype.slice.call(arguments))}}}function s(e){const[n,t]=e.split(".");if("string"!=typeof t)throw new Error("Unable to decode token, payload not found.");let o;try{o=function(e){let n=e.replaceAll("-","+").replaceAll("_","/");switch(n.length%4){case 0:break;case 2:n+="==";break;case 3:n+="=";break;default:throw new Error("Input is not of the correct length.")}try{return function(e){return decodeURIComponent(atob(e).replace(/(.)/g,(e,n)=>{let t=n.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t="0"+t),"%"+t}))}(n)}catch(t){return atob(n)}}(t)}catch(r){throw new Error("Unable to decode token, payload is not a valid Base64URL value.",{cause:r})}try{return JSON.parse(o)}catch(r){throw new Error("Unable to decode token, payload is not a valid JSON value.",{cause:r})}}function c(e){return"object"==typeof e&&null!==e}customElements.define("avatar-component",i);const l=(()=>{const e={url:"https://energis-keycloak.electrosoftware.net",realm:"supervision",clientId:"vite-app-prod",skipAuth:!1};return console.log("=== KEYCLOAK CONFIGURATION DEBUG ==="),console.log("Keycloak Config:",e),console.log("Environment Mode:","production"),console.log("Skip Auth:",!1),console.log("Environment Variables Available:",{VITE_KEYCLOAK_URL:"https://energis-keycloak.electrosoftware.net",VITE_KEYCLOAK_REALM:"supervision",VITE_KEYCLOAK_CLIENT_ID:"vite-app-prod",VITE_SKIP_AUTH:void 0}),console.log("Full Config Object for Keycloak:",{url:e.url,realm:e.realm,clientId:e.clientId}),console.log("=========================================="),e})();const d=new class{constructor(){this.keycloak=new a(l),this.authenticated=!1,this.initialized=!1,this.skipAuth=l.skipAuth||!1}async init(){try{if(this.initialized)return console.log("Keycloak ya fue inicializado, retornando estado actual"),this.authenticated;if(this.skipAuth)return console.log("游뚾 DESARROLLO: Omitiendo autenticaci칩n de Keycloak"),this.authenticated=!0,this.initialized=!0,this.mockUserData={preferred_name:"Usuario Desarrollo",name:"Dev User",email:"dev@localhost",sub:"dev-user-123"},!0;if(!this.keycloak||!l)throw new Error("Keycloak no est치 configurado correctamente");console.log("Iniciando Keycloak con configuraci칩n:",l);const e=await this.keycloak.init({onLoad:"login-required",checkLoginIframe:!1,enableLogging:!0});return this.authenticated=e,this.initialized=!0,e&&(console.log("Usuario autenticado:",this.keycloak.tokenParsed),this.setupTokenRefresh()),e}catch(e){if(console.error("Error al inicializar Keycloak:",e),console.error("Configuraci칩n utilizada:",l),console.error("Estado de Keycloak:",this.keycloak),e.message&&e.message.includes("undefined")&&console.error('El error contiene "undefined". Esto sugiere un problema con las variables de entorno.'),e.message&&e.message.includes("initialized once"))return console.warn("Intento de doble inicializaci칩n detectado. Verificando estado actual..."),this.initialized=!0,this.authenticated=this.keycloak.authenticated||!1,this.authenticated;throw e}}setupTokenRefresh(){this.keycloak.onTokenExpired=()=>{this.keycloak.updateToken(30).then(e=>{e?console.log("Token renovado"):console.log("Token a칰n v치lido")}).catch(()=>{console.error("Error al renovar token"),this.logout()})}}isAuthenticated(){return!!this.skipAuth||this.authenticated&&this.keycloak.authenticated}getToken(){return this.skipAuth?"dev-mock-token":this.keycloak.token}getUserInfo(){return this.skipAuth?this.mockUserData:this.keycloak.tokenParsed}logout(){if(this.skipAuth)return console.log("游뚾 DESARROLLO: Simulando logout"),void window.location.reload();const e=`${window.location.origin}/logout.html`;console.log("Intentando logout con redirect URI:",e),this.keycloak.logout({redirectUri:e}).catch(e=>{console.error("Error durante el logout:",e),console.log("Intentando logout alternativo..."),this.keycloak.logout({redirectUri:window.location.origin}).catch(e=>{console.error("Error en segundo intento de logout:",e),console.log("Redirigiendo manualmente a la p치gina de logout..."),window.location.href="/logout.html"})})}login(){this.skipAuth?console.log("游뚾 DESARROLLO: Ya autenticado en modo desarrollo"):this.keycloak.login()}reset(){console.log("Reinicializando AuthService..."),this.initialized=!1,this.authenticated=!1,this.skipAuth||(this.keycloak=new a(l))}getStatus(){return{initialized:this.initialized,authenticated:this.authenticated,hasToken:!!this.skipAuth||!!this.keycloak.token,skipAuth:this.skipAuth}}};function u(e){return`\n    <div class="error-container">\n      <h2>Error de Autenticaci칩n</h2>\n      <p>${e.message||"No se pudo conectar con el servidor de autenticaci칩n"}</p>\n      <button id="retry-btn">Reintentar</button>\n    </div>\n  `}function p(){const r=document.querySelector("#logout-btn");r&&r.addEventListener("click",()=>{d.logout()});try{(()=>{const e=document.querySelector(".openbtn"),n=document.querySelector(".closebtn"),t=document.querySelector(".sidepanel");t?(null==e||e.addEventListener("click",()=>{t.style.width="250px"}),null==n||n.addEventListener("click",()=>{t.style.width="0"})):console.warn("Sidepanel no encontrado")})();if(!document.querySelector("#map-container"))throw new Error("Contenedor del mapa no encontrado");const o=e("map-container");if(!o)throw new Error("Error al crear instancia del mapa");Promise.all([h("SSE",n,o),h("DragDrop",t,o)]).catch(e=>{console.error("Error inicializando componentes:",e)})}catch(i){console.error("Error cr칤tico en setupMainApp:",i),function(e){const n=document.body;if(n){n.innerHTML=u(e);const t=document.getElementById("retry-btn");t&&t.addEventListener("click",()=>{location.reload()})}else alert(e.message||"Ocurri칩 un error inesperado.")}(i)}o()}function h(e,n,t){return new Promise((o,r)=>{try{"function"==typeof n?(n(t),console.log(`Componente ${e} inicializado`),o(void 0)):r(new Error(`Componente ${e} no disponible`))}catch(i){r(new Error(`Error en componente ${e}: ${i.message}`))}})}const f=document.querySelector("#app");if(!f)throw new Error("No se encontr칩 el contenedor de la aplicaci칩n");function g(){f&&(f.innerHTML=function(){const e=d.getUserInfo();return`\n    <div class="auth-header">\n      <div class="user-info">\n        <span>Bienvenido, ${(null==e?void 0:e.preferred_name)||(null==e?void 0:e.name)||"Usuario"}</span>\n        <button id="logout-btn" class="logout-btn">Cerrar Sesi칩n</button>\n      </div>\n    </div>\n        \n    <div id="map-container" tabindex="0">\n        <div id="popup"></div>\n        \n        \x3c!-- Elementos que van sobre el mapa --\x3e\n\n        \n        <div class="loader" style="display: none;">\n          <div class="bar1"></div>\n          <div class="bar2"></div>\n          <div class="bar3"></div>\n          <div class="bar4"></div>\n          <div class="bar5"></div>\n          <div class="bar6"></div>\n        </div>\n    </div>\n    <div class="openbtn">&raquo;</div>\n    <div id="controlSidepanel" class="sidepanel">\n      <div class="closebtn">&times;</div>\n    </div>\n  `}(),p())}let m=!1;async function k(){if(m)console.log("Ya hay una inicializaci칩n en progreso...");else{m=!0,f&&(f.innerHTML='\n    <div class="loading-container">\n      <div class="loading-spinner"></div>\n      <p>Verificando autenticaci칩n...</p>\n    </div>\n  ');try{console.log("Estado de AuthService antes de init:",d.getStatus());await d.init()?g():console.log("Usuario no autenticado, redirigiendo...")}catch(e){console.error("Error durante la inicializaci칩n:",e),function(e){if(f){f.innerHTML=u(e);const n=document.querySelector("#retry-btn");n&&n.addEventListener("click",()=>{d.reset(),k()})}}(e)}finally{m=!1}}}k();
