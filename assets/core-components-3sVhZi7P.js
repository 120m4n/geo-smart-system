import{T as e,a as t,c as i,e as r,g as n,b as o,d as s,f as a,s as l,r as c,h,i as u,t as d,j as g,k as p,l as f,m,n as y,o as w,p as _,q as x,u as T,v,w as b,x as S,y as F,z as C,A,B as E,E as M,C as P,D as j,F as L,G,H as R,I as O,J as z,K as I,L as k,M as D,N,O as Z,P as V,Q as W,R as U,S as X,U as K,V as B,W as Y,X as H,Y as q,Z as Q,_ as J,$,a0 as ee,a1 as te,a2 as ie,a3 as re,a4 as ne,a5 as oe,a6 as se,a7 as ae,a8 as le,a9 as ce,aa as he,ab as ue,ac as de,ad as ge,ae as pe,af as fe,ag as me,ah as ye,ai as we,aj as _e,ak as xe,al as Te,am as ve,an as be,ao as Se,ap as Fe,aq as Ce,ar as Ae,as as Ee,at as Me,au as Pe,av as je,aw as Le,ax as Ge,ay as Re,az as Oe,aA as ze,aB as Ie,aC as ke,aD as De,aE as Ne,aF as Ze,aG as Ve,aH as We,aI as Ue,aJ as Xe,aK as Ke,aL as Be,aM as Ye}from"./maps-BlyNy95n.js";import{g as He,a as qe,r as Qe}from"./ui-DXU7C635.js";import{P as Je}from"./utils-BjG0z9UU.js";import"./optional-components-CtGkecLC.js";function $e(e){return e instanceof Image||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageBitmap?e:null}const et=new Error("disposed"),tt=[256,256];class it extends e{constructor(e){const i=t.IDLE;super(e.tileCoord,i,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null,this.controller_=e.controller||null}getSize(){if(this.size_)return this.size_;const e=$e(this.data_);return e?[e.width,e.height]:tt}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==t.IDLE&&this.state!==t.ERROR)return;this.state=t.LOADING,this.changed();const e=this;this.loader_().then(function(i){e.data_=i,e.state=t.LOADED,e.changed()}).catch(function(i){e.error_=i,e.state=t.ERROR,e.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(et),this.controller_=null),super.disposeInternal()}}let rt;const nt=[];function ot(e,t,i,r,n){e.beginPath(),e.moveTo(0,0),e.lineTo(t,i),e.lineTo(r,n),e.closePath(),e.save(),e.clip(),e.fillRect(0,0,Math.max(t,r)+1,Math.max(i,n)),e.restore()}function st(e,t){return Math.abs(e[4*t]-210)>2||Math.abs(e[4*t+3]-191.25)>2}function at(e,t,i,r){const n=d(i,t,e);let o=g(t,r,i);const s=t.getMetersPerUnit();void 0!==s&&(o*=s);const a=e.getMetersPerUnit();void 0!==a&&(o/=a);const l=e.getExtent();if(!l||p(l,n)){const t=g(e,o,n)/o;isFinite(t)&&t>0&&(o/=t)}return o}function lt(e,t,h,u,d,g,p,f,m,y,w,_,x,T){const v=i(Math.round(h*e),Math.round(h*t),nt);if(_||(v.imageSmoothingEnabled=!1),0===m.length)return v.canvas;function b(e){return Math.round(e*h)/h}v.scale(h,h),v.globalCompositeOperation="lighter";const S=o();let F;m.forEach(function(e,t,i){r(S,e.extent)});const C=h/u,A=(_?1:1+Math.pow(2,-24))/C;F=i(Math.round(s(S)*C),Math.round(n(S)*C),nt),_||(F.imageSmoothingEnabled=!1),m.forEach(function(e,t,i){if(e.image.width>0&&e.image.height>0){if(e.clipExtent){F.save();const t=(e.clipExtent[0]-S[0])*C,i=-(e.clipExtent[3]-S[3])*C,r=s(e.clipExtent)*C,o=n(e.clipExtent)*C;F.rect(_?t:Math.round(t),_?i:Math.round(i),_?r:Math.round(t+r)-Math.round(t),_?o:Math.round(i+o)-Math.round(i)),F.clip()}const t=(e.extent[0]-S[0])*C,i=-(e.extent[3]-S[3])*C,r=s(e.extent)*C,o=n(e.extent)*C;F.drawImage(e.image,y,y,e.image.width-2*y,e.image.height-2*y,_?t:Math.round(t),_?i:Math.round(i),_?r:Math.round(t+r)-Math.round(t),_?o:Math.round(i+o)-Math.round(i)),e.clipExtent&&F.restore()}});const E=a(p);return f.getTriangles().forEach(function(e,t,r){const o=e.source,a=e.target;let h=o[0][0],u=o[0][1],d=o[1][0],p=o[1][1],f=o[2][0],y=o[2][1];const w=b((a[0][0]-E[0])/g),x=b(-(a[0][1]-E[1])/g),T=b((a[1][0]-E[0])/g),C=b(-(a[1][1]-E[1])/g),M=b((a[2][0]-E[0])/g),P=b(-(a[2][1]-E[1])/g),j=h,L=u;h=0,u=0,d-=j,p-=L,f-=j,y-=L;const G=l([[d,p,0,0,T-w],[f,y,0,0,M-w],[0,0,d,p,C-x],[0,0,f,y,P-x]]);if(!G)return;if(v.save(),v.beginPath(),function(){if(void 0===rt){const e=i(6,6,nt);e.globalCompositeOperation="lighter",e.fillStyle="rgba(210, 0, 0, 0.75)",ot(e,4,5,4,0),ot(e,4,5,0,5);const t=e.getImageData(0,0,3,3).data;rt=st(t,0)||st(t,4)||st(t,8),c(e),nt.push(e.canvas)}return rt}()||!_){v.moveTo(T,C);const e=4,t=w-T,i=x-C;for(let r=0;r<e;r++)v.lineTo(T+b((r+1)*t/e),C+b(r*i/(e-1))),r!=e-1&&v.lineTo(T+b((r+1)*t/e),C+b((r+1)*i/(e-1)));v.lineTo(M,P)}else v.moveTo(T,C),v.lineTo(w,x),v.lineTo(M,P);let R;if(v.clip(),v.transform(G[0],G[2],G[1],G[3],w,x),v.translate(S[0]-j,S[3]-L),F)R=F.canvas,v.scale(A,-A);else{const e=m[0],t=e.extent;R=e.image,v.scale(s(t)/R.width,-n(t)/R.height)}v.drawImage(R,0,0),v.restore()}),F&&(c(F),nt.push(F.canvas)),w&&(v.save(),v.globalCompositeOperation="source-over",v.strokeStyle="black",v.lineWidth=1,f.getTriangles().forEach(function(e,t,i){const r=e.target,n=(r[0][0]-E[0])/g,o=-(r[0][1]-E[1])/g,s=(r[1][0]-E[0])/g,a=-(r[1][1]-E[1])/g,l=(r[2][0]-E[0])/g,c=-(r[2][1]-E[1])/g;v.beginPath(),v.moveTo(s,a),v.lineTo(n,o),v.lineTo(l,c),v.closePath(),v.stroke()}),v.restore()),v.canvas}class ct{constructor(e,t,i,r,n,o,l){this.sourceProj_=e,this.targetProj_=t;let c={};const h=l?f(e=>F(l,d(e,this.targetProj_,this.sourceProj_))):m(this.targetProj_,this.sourceProj_);this.transformInv_=function(e){const t=e[0]+"/"+e[1];return c[t]||(c[t]=h(e)),c[t]},this.maxSourceExtent_=r,this.errorThresholdSquared_=n*n,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&s(r)>=s(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?s(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?s(this.targetProj_.getExtent()):null;const u=a(i),g=y(i),p=w(i),T=_(i),v=this.transformInv_(u),b=this.transformInv_(g),S=this.transformInv_(p),C=this.transformInv_(T),A=10+(o?Math.max(0,Math.ceil(Math.log2(x(i)/(o*o*256*256)))):0);if(this.addQuad_(u,g,p,T,v,b,S,C,A),this.wrapsXInSource_){let e=1/0;this.triangles_.forEach(function(t,i,r){e=Math.min(e,t.source[0][0],t.source[1][0],t.source[2][0])}),this.triangles_.forEach(t=>{if(Math.max(t.source[0][0],t.source[1][0],t.source[2][0])-e>this.sourceWorldWidth_/2){const i=[[t.source[0][0],t.source[0][1]],[t.source[1][0],t.source[1][1]],[t.source[2][0],t.source[2][1]]];i[0][0]-e>this.sourceWorldWidth_/2&&(i[0][0]-=this.sourceWorldWidth_),i[1][0]-e>this.sourceWorldWidth_/2&&(i[1][0]-=this.sourceWorldWidth_),i[2][0]-e>this.sourceWorldWidth_/2&&(i[2][0]-=this.sourceWorldWidth_);const r=Math.min(i[0][0],i[1][0],i[2][0]);Math.max(i[0][0],i[1][0],i[2][0])-r<this.sourceWorldWidth_/2&&(t.source=i)}})}c={}}addTriangle_(e,t,i,r,n,o){this.triangles_.push({source:[r,n,o],target:[e,t,i]})}addQuad_(e,t,i,r,n,o,a,l,c){const h=T([n,o,a,l]),u=this.sourceWorldWidth_?s(h)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,g=this.sourceProj_.canWrapX()&&u>.5&&u<1;let p=!1;if(c>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const n=T([e,t,i,r]);p=s(n)/this.targetWorldWidth_>.25||p}!g&&this.sourceProj_.isGlobal()&&u&&(p=u>.25||p)}if(!p&&this.maxSourceExtent_&&isFinite(h[0])&&isFinite(h[1])&&isFinite(h[2])&&isFinite(h[3])&&!v(h,this.maxSourceExtent_))return;let f=0;if(!(p||isFinite(n[0])&&isFinite(n[1])&&isFinite(o[0])&&isFinite(o[1])&&isFinite(a[0])&&isFinite(a[1])&&isFinite(l[0])&&isFinite(l[1])))if(c>0)p=!0;else if(f=(isFinite(n[0])&&isFinite(n[1])?0:8)+(isFinite(o[0])&&isFinite(o[1])?0:4)+(isFinite(a[0])&&isFinite(a[1])?0:2)+(isFinite(l[0])&&isFinite(l[1])?0:1),1!=f&&2!=f&&4!=f&&8!=f)return;if(c>0){if(!p){const t=[(e[0]+i[0])/2,(e[1]+i[1])/2],r=this.transformInv_(t);let o;if(g){o=(b(n[0],d)+b(a[0],d))/2-b(r[0],d)}else o=(n[0]+a[0])/2-r[0];const s=(n[1]+a[1])/2-r[1];p=o*o+s*s>this.errorThresholdSquared_}if(p){if(Math.abs(e[0]-i[0])<=Math.abs(e[1]-i[1])){const s=[(t[0]+i[0])/2,(t[1]+i[1])/2],h=this.transformInv_(s),u=[(r[0]+e[0])/2,(r[1]+e[1])/2],d=this.transformInv_(u);this.addQuad_(e,t,s,u,n,o,h,d,c-1),this.addQuad_(u,s,i,r,d,h,a,l,c-1)}else{const s=[(e[0]+t[0])/2,(e[1]+t[1])/2],h=this.transformInv_(s),u=[(i[0]+r[0])/2,(i[1]+r[1])/2],d=this.transformInv_(u);this.addQuad_(e,s,u,r,n,h,d,l,c-1),this.addQuad_(s,t,i,u,h,o,a,d,c-1)}return}}if(g){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}11&f||this.addTriangle_(e,i,r,n,a,l),14&f||this.addTriangle_(e,i,t,n,a,o),f&&(13&f||this.addTriangle_(t,r,e,o,l,n),7&f||this.addTriangle_(t,r,i,o,l,a))}calculateSourceExtent(){const e=o();return this.triangles_.forEach(function(t,i,r){const n=t.source;S(e,n[0]),S(e,n[1]),S(e,n[2])}),e}getTriangles(){return this.triangles_}}class ht extends e{constructor(e,i,r,n,o,a,l,c,d,g,p,f){super(o,t.IDLE,f),this.renderEdges_=void 0!==p&&p,this.pixelRatio_=l,this.gutter_=c,this.canvas_=null,this.sourceTileGrid_=i,this.targetTileGrid_=n,this.wrappedTileCoord_=a||o,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=e.canWrapX()?e.getExtent():void 0;const m=n.getTileCoordExtent(this.wrappedTileCoord_),y=this.targetTileGrid_.getExtent();let w=this.sourceTileGrid_.getExtent();const _=y?C(m,y):m;if(0===x(_))return void(this.state=t.EMPTY);const T=e.getExtent();T&&(w=w?C(w,T):T);const v=n.getResolution(this.wrappedTileCoord_[0]),b=function(e,t,i,r){const n=h(i);let o=at(e,t,n,r);return(!isFinite(o)||o<=0)&&u(i,function(i){return o=at(e,t,i,r),isFinite(o)&&o>0}),o}(e,r,_,v);if(!isFinite(b)||b<=0)return void(this.state=t.EMPTY);const S=void 0!==g?g:.5;if(this.triangulation_=new ct(e,r,_,w,b*S,v),0===this.triangulation_.getTriangles().length)return void(this.state=t.EMPTY);this.sourceZ_=i.getZForResolution(b);let F=this.triangulation_.calculateSourceExtent();if(w&&(e.canWrapX()?(F[1]=P(F[1],w[1],w[3]),F[3]=P(F[3],w[1],w[3])):F=C(F,w)),x(F)){let r=0,n=0;e.canWrapX()&&(r=s(T),n=Math.floor((F[0]-T[0])/r));j(F.slice(),e,!0).forEach(e=>{const t=i.getTileRangeForExtentAndZ(e,this.sourceZ_);for(let i=t.minX;i<=t.maxX;i++)for(let e=t.minY;e<=t.maxY;e++){const t=d(this.sourceZ_,i,e,l);if(t){const e=n*r;this.sourceTiles_.push({tile:t,offset:e})}}++n}),0===this.sourceTiles_.length&&(this.state=t.EMPTY)}else this.state=t.EMPTY}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(i=>{var r;const n=i.tile;if(n&&n.getState()==t.LOADED){const t=this.sourceTileGrid_.getTileCoordExtent(n.tileCoord);t[0]+=i.offset,t[2]+=i.offset;const o=null==(r=this.clipExtent_)?void 0:r.slice();o&&(o[0]+=i.offset,o[2]+=i.offset),e.push({extent:t,clipExtent:o,image:n.getImage()})}}),this.sourceTiles_.length=0,0===e.length)this.state=t.ERROR;else{const i=this.wrappedTileCoord_[0],r=this.targetTileGrid_.getTileSize(i),n="number"==typeof r?r:r[0],o="number"==typeof r?r:r[1],s=this.targetTileGrid_.getResolution(i),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=lt(n,o,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),s,l,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=t.LOADED}this.changed()}load(){if(this.state==t.IDLE){this.state=t.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:i})=>{const r=i.getState();if(r==t.IDLE||r==t.LOADING){e++;const r=A(i,M.CHANGE,n=>{const o=i.getState();o!=t.LOADED&&o!=t.ERROR&&o!=t.EMPTY||(E(r),e--,0===e&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(r)}}),0===e?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e},i,r){e.getState()==t.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(E),this.sourcesListenerKeys_=null}release(){this.canvas_&&(c(this.canvas_.getContext("2d")),nt.push(this.canvas_),this.canvas_=null),super.release()}}class ut{constructor(e){this.highWaterMark=void 0!==e?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){const e=this.pop();e instanceof L&&e.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const i=this.entries_[e];return G(void 0!==i,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(e){const t=this.entries_[e];return G(void 0!==t,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t,i=0;for(t=this.newest_;t;t=t.older)e[i++]=t.key_;return e}getValues(){const e=new Array(this.count_);let t,i=0;for(t=this.newest_;t;t=t.older)e[i++]=t.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){var t;return null==(t=this.entries_[e])?void 0:t.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){G(!(e in this.entries_),"Tried to set a value for a key that is used already");const i={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[e]=i,++this.count_}setSize(e){this.highWaterMark=e}}function dt(e,t,i,r){return void 0!==r?(r[0]=e,r[1]=t,r[2]=i,r):[e,t,i]}function gt(e,t,i,r,n){return`${k(e)},${t},${function(e,t,i){return e+"/"+t+"/"+i}(i,r,n)}`}function pt(e,t,i){if(!(i in e))return e[i]=new Set([t]),!0;const r=e[i],n=r.has(t);return n||r.add(t),!n}function ft(e,t,i){const r=e[i];return!!r&&r.delete(t)}function mt(e,t){const i=e.layerStatesArray[e.layerIndex];i.extent&&(t=C(t,N(i.extent,e.viewState.projection)));const r=i.layer.getRenderSource();if(!r.getWrapX()){const i=r.getTileGridForProjection(e.viewState.projection).getExtent();i&&(t=C(t,i))}return t}class yt extends R{constructor(e,t){super(e),t=t||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=o(),this.tempTileRange_=new O(0,0,0,0),this.tempTileCoord_=dt(0,0,0);const i=void 0!==t.cacheSize?t.cacheSize:512;this.tileCache_=new ut(i),this.maxStaleKeys=.5*i}getTileCache(){return this.tileCache_}getOrCreateTile(e,t,i,r){const n=this.tileCache_,o=this.getLayer().getSource(),s=gt(o,o.getKey(),e,t,i);let a;if(n.containsKey(s))a=n.get(s);else{if(a=o.getTile(e,t,i,r.pixelRatio,r.viewState.projection),!a)return null;n.set(s,a)}return a}getTile(e,t,i,r){const n=this.getOrCreateTile(e,t,i,r);return n||null}getData(e){const i=this.frameState;if(!i)return null;const r=this.getLayer(),n=F(i.pixelToCoordinateTransform,e.slice()),o=r.getExtent();if(o&&!p(o,n))return null;const s=i.viewState,a=r.getRenderSource(),l=a.getTileGridForProjection(s.projection),c=a.getTilePixelRatio(i.pixelRatio);for(let h=l.getZForResolution(s.resolution);h>=l.getMinZoom();--h){const e=l.getTileCoordForCoordAndZ(n,h),r=this.getTile(h,e[1],e[2],i);if(!r||r.getState()!==t.LOADED)continue;const o=l.getOrigin(h),u=z(l.getTileSize(h)),d=l.getResolution(h);let g;if(r instanceof I||r instanceof ht)g=r.getImage();else{if(!(r instanceof it))continue;if(g=$e(r.getData()),!g)continue}const p=Math.floor(c*((n[0]-o[0])/d-e[1]*u[0])),f=Math.floor(c*((o[1]-n[1])/d-e[2]*u[1])),m=Math.round(c*a.getGutterForProjection(s.projection));return this.getImageData(g,p+m,f+m)}return null}prepareFrame(e){this.renderedProjection?e.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=e.viewState.projection):this.renderedProjection=e.viewState.projection;const t=this.getLayer().getSource();if(!t)return!1;const i=t.getRevision();return this.renderedSourceRevision_?this.renderedSourceRevision_!==i&&(this.renderedSourceRevision_=i,this.renderedSourceKey_===t.getKey()&&this.tileCache_.clear()):this.renderedSourceRevision_=i,!0}enqueueTiles(e,i,r,n,o){const s=e.viewState,a=this.getLayer(),l=a.getRenderSource(),c=l.getTileGridForProjection(s.projection),h=k(l);h in e.wantedTiles||(e.wantedTiles[h]={});const u=e.wantedTiles[h],d=a.getMapInternal(),g=Math.max(r-o,c.getMinZoom(),c.getZForResolution(Math.min(a.getMaxResolution(),d?d.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):c.getResolution(0)),l.zDirection)),p=s.rotation,f=p?D(s.center,s.resolution,p,e.size):void 0;for(let m=r;m>=g;--m){const r=c.getTileRangeForExtentAndZ(i,m,this.tempTileRange_),o=c.getResolution(m);for(let i=r.minX;i<=r.maxX;++i)for(let s=r.minY;s<=r.maxY;++s){if(p&&!c.tileCoordIntersectsViewport([m,i,s],f))continue;const r=this.getTile(m,i,s,e);if(!r)continue;if(!pt(n,r,m))continue;const a=r.getKey();if(u[a]=!0,r.getState()===t.IDLE&&!e.tileQueue.isKeyQueued(a)){const t=dt(m,i,s,this.tempTileCoord_);e.tileQueue.enqueue([r,h,c.getTileCoordCenter(t),o])}}}}findStaleTile_(e,i){const r=this.tileCache_,n=e[0],o=e[1],s=e[2],a=this.getStaleKeys();for(let l=0;l<a.length;++l){const e=gt(this.getLayer().getSource(),a[l],n,o,s);if(r.containsKey(e)){const o=r.peek(e);if(o.getState()===t.LOADED)return o.endTransition(k(this)),pt(i,o,n),!0}}return!1}findAltTiles_(e,i,r,n){const o=e.getTileRangeForTileCoordAndZ(i,r,this.tempTileRange_);if(!o)return!1;let s=!0;const a=this.tileCache_,l=this.getLayer().getRenderSource(),c=l.getKey();for(let h=o.minX;h<=o.maxX;++h)for(let e=o.minY;e<=o.maxY;++e){const i=gt(l,c,r,h,e);let o=!1;if(a.containsKey(i)){const e=a.peek(i);e.getState()===t.LOADED&&(pt(n,e,r),o=!0)}o||(s=!1)}return s}renderFrame(e,i){this.renderComplete=!0;const r=e.layerStatesArray[e.layerIndex],n=e.viewState,o=n.projection,s=n.resolution,l=n.center,c=e.pixelRatio,h=this.getLayer(),u=h.getSource(),d=u.getTileGridForProjection(o),g=d.getZForResolution(s,u.zDirection),p=d.getResolution(g),f=u.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==f&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=f):this.renderedSourceKey_=f;let m=e.extent;const y=u.getTilePixelRatio(c);this.prepareContainer(e,i);const w=this.context.canvas.width,_=this.context.canvas.height,x=r.extent&&N(r.extent);x&&(m=C(m,N(r.extent)));const T=p*w/2/y,b=p*_/2/y,S=[l[0]-T,l[1]-b,l[0]+T,l[1]+b],A={};this.renderedTiles.length=0;const E=h.getPreload();if(e.nextExtent){const t=d.getZForResolution(n.nextResolution,u.zDirection),i=mt(e,e.nextExtent);this.enqueueTiles(e,i,t,A,E)}const M=mt(e,m);if(this.enqueueTiles(e,M,g,A,0),E>0&&setTimeout(()=>{this.enqueueTiles(e,M,g-1,A,E-1)},0),!(g in A))return this.container;const P=k(this),j=e.time;for(const a of A[g]){const i=a.getState();if(i===t.EMPTY)continue;const r=a.tileCoord;if(i===t.LOADED){if(1===a.getAlpha(P,j)){a.endTransition(P);continue}}i!==t.ERROR&&(this.renderComplete=!1);if(this.findStaleTile_(r,A)){ft(A,a,g),e.animate=!0;continue}if(this.findAltTiles_(d,r,g+1,A))continue;const n=d.getMinZoom();for(let e=g-1;e>=n;--e){if(this.findAltTiles_(d,r,e,A))break}}const L=p/s*c/y,G=this.getRenderContext(e);Z(this.tempTransform,w/2,_/2,L,L,0,-w/2,-_/2),r.extent&&this.clipUnrotated(G,e,x),u.getInterpolate()||(G.imageSmoothingEnabled=!1),this.preRender(G,e);const R=Object.keys(A).map(Number);let O;R.sort(V);const z=[],I=[];for(let C=R.length-1;C>=0;--C){const i=R[C],r=u.getTilePixelSize(i,c,o),n=d.getResolution(i)/p,s=r[0]*n*L,l=r[1]*n*L,h=d.getTileCoordForCoordAndZ(a(S),i),g=d.getTileCoordExtent(h),f=F(this.tempTransform,[y*(g[0]-S[0])/p,y*(S[3]-g[3])/p]),m=y*u.getGutterForProjection(o);for(const o of A[i]){if(o.getState()!==t.LOADED)continue;const r=o.tileCoord,n=h[1]-r[1],a=Math.round(f[0]-(n-1)*s),c=h[2]-r[2],d=Math.round(f[1]-(c-1)*l),g=Math.round(f[0]-n*s),p=Math.round(f[1]-c*l),y=a-g,w=d-p,_=1===R.length;let x=!1;O=[g,p,g+y,p,g+y,p+w,g,p+w];for(let e=0,t=z.length;e<t;++e)if(!_&&i<I[e]){const t=z[e];v([g,p,g+y,p+w],[t[0],t[3],t[4],t[7]])&&(x||(G.save(),x=!0),G.beginPath(),G.moveTo(O[0],O[1]),G.lineTo(O[2],O[3]),G.lineTo(O[4],O[5]),G.lineTo(O[6],O[7]),G.moveTo(t[6],t[7]),G.lineTo(t[4],t[5]),G.lineTo(t[2],t[3]),G.lineTo(t[0],t[1]),G.clip())}z.push(O),I.push(i),this.drawTile(o,e,g,p,y,w,m,_),x&&G.restore(),this.renderedTiles.unshift(o),this.updateUsedTiles(e.usedTiles,u,o)}}if(this.renderedResolution=p,this.extentChanged=!this.renderedExtent_||!W(this.renderedExtent_,S),this.renderedExtent_=S,this.renderedPixelRatio=c,this.postRender(this.context,e),r.extent&&G.restore(),G.imageSmoothingEnabled=!0,this.renderComplete){const t=(e,t)=>{const i=k(u),r=t.wantedTiles[i],n=r?Object.keys(r).length:0;this.updateCacheSize(n),this.tileCache_.expireCache()};e.postRenderFunctions.push(t)}return this.container}updateCacheSize(e){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,2*e)}drawTile(e,t,i,r,n,o,s,a){let l;if(e instanceof it){if(l=$e(e.getData()),!l)throw new Error("Rendering array data is not yet supported")}else l=this.getTileImage(e);if(!l)return;const c=this.getRenderContext(t),h=k(this),u=t.layerStatesArray[t.layerIndex],d=u.opacity*(a?e.getAlpha(h,t.time):1),g=d!==c.globalAlpha;g&&(c.save(),c.globalAlpha=d),c.drawImage(l,s,s,l.width-2*s,l.height-2*s,i,r,n,o),g&&c.restore(),d!==u.opacity?t.animate=!0:a&&e.endTransition(h)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}updateUsedTiles(e,t,i){const r=k(t);r in e||(e[r]={}),e[r][i.getKey()]=!0}}const wt="preload",_t="useInterimTilesOnError";class xt extends U{constructor(e){e=e||{};const t=Object.assign({},e),i=e.cacheSize;delete e.cacheSize,delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=i,this.setPreload(void 0!==e.preload?e.preload:0),this.setUseInterimTilesOnError(void 0===e.useInterimTilesOnError||e.useInterimTilesOnError)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(wt)}setPreload(e){this.set(wt,e)}getUseInterimTilesOnError(){return this.get(_t)}setUseInterimTilesOnError(e){this.set(_t,e)}getData(e){return super.getData(e)}}class Tt extends xt{constructor(e){super(e)}createRenderer(){return new yt(this,{cacheSize:this.getCacheSize()})}}const vt=[0,0,0];class bt{constructor(e){let t;if(this.minZoom=void 0!==e.minZoom?e.minZoom:0,this.resolutions_=e.resolutions,G(X(this.resolutions_,(e,t)=>t-e),"`resolutions` must be sorted in descending order"),!e.origins)for(let r=0,n=this.resolutions_.length-1;r<n;++r)if(t){if(this.resolutions_[r]/this.resolutions_[r+1]!==t){t=void 0;break}}else t=this.resolutions_[r]/this.resolutions_[r+1];this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==e.origin?e.origin:null,this.origins_=null,void 0!==e.origins&&(this.origins_=e.origins,G(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=e.extent;void 0===i||this.origin_||this.origins_||(this.origin_=a(i)),G(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,void 0!==e.tileSizes&&(this.tileSizes_=e.tileSizes,G(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=void 0!==e.tileSize?e.tileSize:this.tileSizes_?null:K,G(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=void 0!==i?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],void 0!==e.sizes?this.fullTileRanges_=e.sizes.map((e,t)=>{const r=new O(Math.min(0,e[0]),Math.max(e[0]-1,-1),Math.min(0,e[1]),Math.max(e[1]-1,-1));if(i){const e=this.getTileRangeForExtentAndZ(i,t);r.minX=Math.max(e.minX,r.minX),r.maxX=Math.min(e.maxX,r.maxX),r.minY=Math.max(e.minY,r.minY),r.maxY=Math.min(e.maxY,r.maxY)}return r}):i&&this.calculateTileRanges_(i)}forEachTileCoord(e,t,i){const r=this.getTileRangeForExtentAndZ(e,t);for(let n=r.minX,o=r.maxX;n<=o;++n)for(let e=r.minY,s=r.maxY;e<=s;++e)i([t,n,e])}forEachTileCoordParentTileRange(e,t,i,r){let n,o,s,a=null,l=e[0]-1;for(2===this.zoomFactor_?(o=e[1],s=e[2]):a=this.getTileCoordExtent(e,r);l>=this.minZoom;){if(void 0!==o&&void 0!==s?(o=Math.floor(o/2),s=Math.floor(s/2),n=B(o,o,s,s,i)):n=this.getTileRangeForExtentAndZ(a,l,i),t(l,n))return!0;--l}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,i){if(e[0]<this.maxZoom){if(2===this.zoomFactor_){const i=2*e[1],r=2*e[2];return B(i,i+1,r,r+1,t)}const r=this.getTileCoordExtent(e,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(r,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,i){if(t>this.maxZoom||t<this.minZoom)return null;const r=e[0],n=e[1],o=e[2];if(t===r)return B(n,o,n,o,i);if(this.zoomFactor_){const e=Math.pow(this.zoomFactor_,t-r),s=Math.floor(n*e),a=Math.floor(o*e);if(t<r)return B(s,s,a,a,i);const l=Math.floor(e*(n+1))-1,c=Math.floor(e*(o+1))-1;return B(s,l,a,c,i)}const s=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,t,i)}getTileRangeForExtentAndZ(e,t,i){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,vt);const r=vt[1],n=vt[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,vt);return B(r,vt[1],n,vt[2],i)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),i=this.getResolution(e[0]),r=z(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*r[0]*i,t[1]-(e[2]+.5)*r[1]*i]}getTileCoordExtent(e,t){const i=this.getOrigin(e[0]),r=this.getResolution(e[0]),n=z(this.getTileSize(e[0]),this.tmpSize_),o=i[0]+e[1]*n[0]*r,s=i[1]-(e[2]+1)*n[1]*r,a=o+n[0]*r,l=s+n[1]*r;return Y(o,s,a,l,t)}getTileCoordForCoordAndResolution(e,t,i){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,i)}getTileCoordForXYAndResolution_(e,t,i,r,n){const o=this.getZForResolution(i),s=i/this.getResolution(o),a=this.getOrigin(o),l=z(this.getTileSize(o),this.tmpSize_);let c=s*(e-a[0])/i/l[0],h=s*(a[1]-t)/i/l[1];return r?(c=Q(c,5)-1,h=Q(h,5)-1):(c=J(c,5),h=J(h,5)),dt(o,c,h,n)}getTileCoordForXYAndZ_(e,t,i,r,n){const o=this.getOrigin(i),s=this.getResolution(i),a=z(this.getTileSize(i),this.tmpSize_);let l=(e-o[0])/s/a[0],c=(o[1]-t)/s/a[1];return r?(l=Q(l,5)-1,c=Q(c,5)-1):(l=J(l,5),c=J(c,5)),dt(i,l,c,n)}getTileCoordForCoordAndZ(e,t,i){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,i)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const i=H(this.resolutions_,e,t||0);return P(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return q(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,i=new Array(t);for(let r=this.minZoom;r<t;++r)i[r]=this.getTileRangeForExtentAndZ(e,r);this.fullTileRanges_=i}}function St(e){let t=e.getDefaultTileGrid();return t||(t=function(e,t,i,r){const n=Ct(e);return function(e,t,i,r){r=void 0!==r?r:"top-left";const n=Ft(e,t,i);return new bt({extent:e,origin:te(e,r),resolutions:n,tileSize:i})}(n,t,i,r)}(e),e.setDefaultTileGrid(t)),t}function Ft(e,t,i,r){t=void 0!==t?t:ie,i=z(void 0!==i?i:K);const o=n(e),a=s(e);r=r>0?r:Math.max(a/i[0],o/i[1]);const l=t+1,c=new Array(l);for(let n=0;n<l;++n)c[n]=r/Math.pow(2,n);return c}function Ct(e){let t=(e=$(e)).getExtent();if(!t){const i=180*ee.degrees/e.getMetersPerUnit();t=Y(-i,-i,i,i)}return t}const At=/\{z\}/g,Et=/\{x\}/g,Mt=/\{y\}/g,Pt=/\{-y\}/g;function jt(e,t){return function(i,r,n){if(!i)return;let o;const s=i[0];if(t){const e=t.getFullTileRange(s);e&&(o=e.getHeight()-1)}return function(e,t,i,r,n){return e.replace(At,t.toString()).replace(Et,i.toString()).replace(Mt,r.toString()).replace(Pt,function(){if(void 0===n)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(n-r).toString()})}(e,s,i[1],i[2],o)}}function Lt(e,t){const i=e.length,r=new Array(i);for(let n=0;n<i;++n)r[n]=jt(e[n],t);return function(e){if(1===e.length)return e[0];return function(t,i,r){if(!t)return;const n=function(e){return t=e[0],i=e[1],r=e[2],(i<<t)+r;var t,i,r}(t),o=b(n,e.length);return e[o](t,i,r)}}(r)}class Gt extends re{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=void 0!==e.tilePixelRatio?e.tilePixelRatio:1,this.tileGrid=void 0!==e.tileGrid?e.tileGrid:null;const t=[256,256];this.tileGrid&&z(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tmpSize=[0,0],this.key_=e.key||k(this),this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,i,r,n){return ne()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:St(e)}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,i){const r=this.getTileGridForProjection(i),n=this.getTilePixelRatio(t),o=z(r.getTileSize(e),this.tmpSize);return 1==n?o:oe(o,n,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){const i=void 0!==t?t:this.getProjection(),r=void 0!==t?this.getTileGridForProjection(i):this.tileGrid||this.getTileGridForProjection(i);return this.getWrapX()&&i.isGlobal()&&(e=function(e,t,i){const r=t[0],n=e.getTileCoordCenter(t),o=Ct(i);if(!p(o,n)){const t=s(o),i=Math.ceil((o[0]-n[0])/t);return n[0]+=t*i,e.getTileCoordForCoordAndZ(n,r)}return t}(r,e,i)),function(e,t){const i=e[0],r=e[1],n=e[2];if(t.getMinZoom()>i||i>t.getMaxZoom())return!1;const o=t.getFullTileRange(i);return!o||o.containsXY(r,n)}(e,r)?e:null}clear(){}refresh(){this.clear(),super.refresh()}}class Rt extends se{constructor(e,t){super(e),this.tile=t}}const Ot="tileloadstart",zt="tileloadend",It="tileloaderror";class kt extends Gt{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===kt.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const i=e.target,r=k(i),n=i.getState();let o;n==t.LOADING?(this.tileLoadingKeys_[r]=!0,o=Ot):r in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[r],o=n==t.ERROR?It:n==t.LOADED?zt:void 0),null!=o&&this.dispatchEvent(new Rt(o,i))}setTileLoadFunction(e){this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,void 0!==t?this.setKey(t):this.changed()}setUrl(e){const t=function(e){const t=[];let i=/\{([a-z])-([a-z])\}/.exec(e);if(i){const r=i[1].charCodeAt(0),n=i[2].charCodeAt(0);let o;for(o=r;o<=n;++o)t.push(e.replace(i[0],String.fromCharCode(o)));return t}if(i=/\{(\d+)-(\d+)\}/.exec(e),i){const r=parseInt(i[2],10);for(let n=parseInt(i[1],10);n<=r;n++)t.push(e.replace(i[0],n.toString()));return t}return t.push(e),t}(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(Lt(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,i){}}class Dt extends kt{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:Nt,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:void 0===e.interpolate||e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=void 0!==e.crossOrigin?e.crossOrigin:null,this.tileClass=void 0!==e.tileClass?e.tileClass:I,this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(e){return this.getProjection()&&e&&!ae(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||ae(t,e)))return this.tileGrid;const i=k(e);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=St(e)),this.tileGridForProjection[i]}createTile_(e,i,r,n,o,s){const a=[e,i,r],l=this.getTileCoordForTileUrlFunction(a,o),c=l?this.tileUrlFunction(l,n,o):void 0,h=new this.tileClass(a,void 0!==c?t.IDLE:t.EMPTY,void 0!==c?c:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return h.key=s,h.addEventListener(M.CHANGE,this.handleTileChange.bind(this)),h}getTile(e,t,i,r,n){const o=this.getProjection();if(!o||!n||ae(o,n))return this.getTileInternal(e,t,i,r,o||n);const s=[e,t,i],a=this.getKey(),l=this.getTileGridForProjection(o),c=this.getTileGridForProjection(n),h=this.getTileCoordForTileUrlFunction(s,n),u=new ht(o,l,n,c,s,h,this.getTilePixelRatio(r),this.getGutter(),(e,t,i,r)=>this.getTileInternal(e,t,i,r,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return u.key=a,u}getTileInternal(e,t,i,r,n){const o=this.getKey();return this.createTile_(e,t,i,r,n,o)}setRenderReprojectionEdges(e){this.renderReprojectionEdges_!=e&&(this.renderReprojectionEdges_=e,this.changed())}setTileGridForProjection(e,t){const i=$(e);if(i){const e=k(i);e in this.tileGridForProjection||(this.tileGridForProjection[e]=t)}}}function Nt(e,t){e.getImage().src=t}class Zt extends Dt{constructor(e){const t=void 0!==(e=e||{}).projection?e.projection:"EPSG:3857",i=void 0!==e.tileGrid?e.tileGrid:function(e){const t=e||{},i=t.extent||$("EPSG:3857").getExtent(),r={extent:i,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:Ft(i,t.maxZoom,t.tileSize,t.maxResolution)};return new bt(r)}({extent:Ct(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=void 0!==e.gutter?e.gutter:0}getGutter(){return this.gutter_}}class Vt extends Zt{constructor(e){let t;t=void 0!==(e=e||{}).attributions?e.attributions:['&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.'];const i=void 0!==e.crossOrigin?e.crossOrigin:"anonymous",r=void 0!==e.url?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:t,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:i,interpolate:e.interpolate,maxZoom:void 0!==e.maxZoom?e.maxZoom:19,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:r,wrapX:e.wrapX,zDirection:e.zDirection})}}const Wt="projection",Ut="coordinateFormat";class Xt extends le{constructor(e){e=e||{};const t=document.createElement("div");t.className=void 0!==e.className?e.className:"ol-mouse-position",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un,this.addChangeListener(Wt,this.handleProjectionChanged_),e.coordinateFormat&&this.setCoordinateFormat(e.coordinateFormat),e.projection&&this.setProjection(e.projection),this.renderOnMouseOut_=void 0!==e.placeholder,this.placeholder_=this.renderOnMouseOut_?e.placeholder:"&#160;",this.renderedHTML_=t.innerHTML,this.mapProjection_=null,this.transform_=null,this.wrapX_=!1!==e.wrapX}handleProjectionChanged_(){this.transform_=null}getCoordinateFormat(){return this.get(Ut)}getProjection(){return this.get(Wt)}handleMouseMove(e){const t=this.getMap();this.updateHTML_(t.getEventPixel(e))}handleMouseOut(e){this.updateHTML_(null)}setMap(e){if(super.setMap(e),e){const t=e.getViewport();this.listenerKeys.push(A(t,ce.POINTERMOVE,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push(A(t,ce.POINTEROUT,this.handleMouseOut,this)),this.updateHTML_(null)}}setCoordinateFormat(e){this.set(Ut,e)}setProjection(e){this.set(Wt,$(e))}updateHTML_(e){let t=this.placeholder_;if(e&&this.mapProjection_){if(!this.transform_){const e=this.getProjection();this.transform_=e?he(this.mapProjection_,e):ue}const i=this.getMap().getCoordinateFromPixelInternal(e);if(i){if(this.transform_(i,i),this.wrapX_){const e=this.getProjection()||this.mapProjection_;de(i,e)}const e=this.getCoordinateFormat();t=e?e(i):i.toString()}}this.renderedHTML_&&t===this.renderedHTML_||(this.element.innerHTML=t,this.renderedHTML_=t)}render(e){const t=e.frameState;t?this.mapProjection_!=t.viewState.projection&&(this.mapProjection_=t.viewState.projection,this.transform_=null):this.mapProjection_=null}}var Kt={exports:{}};var Bt;const Yt=qe(Bt?Kt.exports:(Bt=1,Kt.exports=function(e,t,i){e="default"in e?e.default:e,i="default"in i?i.default:i;const r="layer-switcher-";class n extends e{constructor(e){const t=Object.assign({},e),i=document.createElement("div");super({element:i,target:t.target}),this.activationMode=t.activationMode||"mouseover",this.startActive=!0===t.startActive,this.label=void 0!==t.label?t.label:"",this.collapseLabel=void 0!==t.collapseLabel?t.collapseLabel:"Â»",this.tipLabel=t.tipLabel?t.tipLabel:"Legend",this.collapseTipLabel=t.collapseTipLabel?t.collapseTipLabel:"Collapse legend",this.groupSelectStyle=n.getGroupSelectStyle(t.groupSelectStyle),this.reverse=!1!==t.reverse,this.mapListeners=[],this.hiddenClassName="ol-unselectable ol-control layer-switcher",n.isTouchDevice_()&&(this.hiddenClassName+=" touch"),this.shownClassName="shown",i.className=this.hiddenClassName,this.button=document.createElement("button"),i.appendChild(this.button),this.panel=document.createElement("div"),this.panel.className="panel",i.appendChild(this.panel),n.enableTouchScroll_(this.panel),i.classList.add(r+"group-select-style-"+this.groupSelectStyle),i.classList.add(r+"activation-mode-"+this.activationMode),"click"===this.activationMode?(i.classList.add("activationModeClick"),this.button.onclick=e=>{const t=e||window.event;this.element.classList.contains(this.shownClassName)?this.hidePanel():this.showPanel(),t.preventDefault()}):(this.button.onmouseover=()=>{this.showPanel()},this.button.onclick=e=>{const t=e||window.event;this.showPanel(),t.preventDefault()},this.panel.onmouseout=e=>{this.panel.contains(e.relatedTarget)||this.hidePanel()}),this.updateButton()}setMap(e){for(let i=0;i<this.mapListeners.length;i++)t.unByKey(this.mapListeners[i]);this.mapListeners.length=0,super.setMap(e),e&&(this.startActive?this.showPanel():this.renderPanel(),"click"!==this.activationMode&&this.mapListeners.push(e.on("pointerdown",()=>{this.hidePanel()})))}showPanel(){this.element.classList.contains(this.shownClassName)||(this.element.classList.add(this.shownClassName),this.updateButton(),this.renderPanel()),this.dispatchEvent("show")}hidePanel(){this.element.classList.contains(this.shownClassName)&&(this.element.classList.remove(this.shownClassName),this.updateButton()),this.dispatchEvent("hide")}updateButton(){this.element.classList.contains(this.shownClassName)?(this.button.textContent=this.collapseLabel,this.button.setAttribute("title",this.collapseTipLabel),this.button.setAttribute("aria-label",this.collapseTipLabel)):(this.button.textContent=this.label,this.button.setAttribute("title",this.tipLabel),this.button.setAttribute("aria-label",this.tipLabel))}renderPanel(){this.dispatchEvent("render"),n.renderPanel(this.getMap(),this.panel,{groupSelectStyle:this.groupSelectStyle,reverse:this.reverse}),this.dispatchEvent("rendercomplete")}static renderPanel(e,t,i){const r=new Event("render");for(t.dispatchEvent(r),(i=i||{}).groupSelectStyle=n.getGroupSelectStyle(i.groupSelectStyle),n.ensureTopVisibleBaseLayerShown(e,i.groupSelectStyle);t.firstChild;)t.removeChild(t.firstChild);n.forEachRecursive(e,function(e,t,i){e.set("indeterminate",!1)}),"children"===i.groupSelectStyle||"none"===i.groupSelectStyle?n.setGroupVisibility(e):"group"===i.groupSelectStyle&&n.setChildVisibility(e);const o=document.createElement("ul");t.appendChild(o),n.renderLayers_(e,e,o,i,function(r){n.renderPanel(e,t,i)});const s=new Event("rendercomplete");t.dispatchEvent(s)}static isBaseGroup(e){if(e instanceof i){const t=e.getLayers().getArray();return t.length&&"base"===t[0].get("type")}return!1}static setGroupVisibility(e){n.getGroupsAndLayers(e,function(e){return e instanceof i&&!e.get("combine")&&!n.isBaseGroup(e)}).reverse().forEach(function(e){const t=e.getLayersArray().map(function(e){return e.getVisible()});t.every(function(e){return!0===e})?(e.setVisible(!0),e.set("indeterminate",!1)):t.every(function(e){return!1===e})?(e.setVisible(!1),e.set("indeterminate",!1)):(e.setVisible(!0),e.set("indeterminate",!0))})}static setChildVisibility(e){n.getGroupsAndLayers(e,function(e){return e instanceof i&&!e.get("combine")&&!n.isBaseGroup(e)}).forEach(function(e){const t=e,i=t.getVisible(),r=t.get("indeterminate");t.getLayers().getArray().forEach(function(e){e.set("indeterminate",!1),i&&!r||!e.getVisible()||e.set("indeterminate",!0)})})}static ensureTopVisibleBaseLayerShown(e,t){let i;n.forEachRecursive(e,function(e,t,r){"base"===e.get("type")&&e.getVisible()&&(i=e)}),i&&n.setVisible_(e,i,!0,t)}static getGroupsAndLayers(e,t){const i=[];return t=t||function(e,t,i){return!0},n.forEachRecursive(e,function(e,r,n){e.get("title")&&t(e,r,n)&&i.push(e)}),i}static setVisible_(e,t,r,o){t.setVisible(r),r&&"base"===t.get("type")&&n.forEachRecursive(e,function(e,i,r){e!=t&&"base"===e.get("type")&&e.setVisible(!1)}),t instanceof i&&!t.get("combine")&&"children"===o&&t.getLayers().forEach(i=>{n.setVisible_(e,i,t.getVisible(),o)})}static renderLayer_(e,t,o,s,a){const l=document.createElement("li"),c=t.get("title"),h=n.uuid(),u=document.createElement("label");if(t instanceof i&&!t.get("combine")){const i=n.isBaseGroup(t);if(l.classList.add("group"),i&&l.classList.add(r+"base-group"),t.get("fold")){l.classList.add(r+"fold"),l.classList.add(r+t.get("fold"));const e=document.createElement("button");e.onclick=function(e){const i=e||window.event;n.toggleFold_(t,l),i.preventDefault()},l.appendChild(e)}if(!i&&"none"!=s.groupSelectStyle){const i=document.createElement("input");i.type="checkbox",i.id=h,i.checked=t.getVisible(),i.indeterminate=t.get("indeterminate"),i.onchange=function(i){const r=i.target;n.setVisible_(e,t,r.checked,s.groupSelectStyle),a(t)},l.appendChild(i),u.htmlFor=h}u.innerHTML=c,l.appendChild(u);const o=document.createElement("ul");l.appendChild(o),n.renderLayers_(e,t,o,s,a)}else{l.className="layer";const i=document.createElement("input");"base"===t.get("type")?i.type="radio":i.type="checkbox",i.id=h,i.checked=t.get("visible"),i.indeterminate=t.get("indeterminate"),i.onchange=function(i){const r=i.target;n.setVisible_(e,t,r.checked,s.groupSelectStyle),a(t)},l.appendChild(i),u.htmlFor=h,u.innerHTML=c;const r=e.getView().getResolution();if(r>=t.getMaxResolution()||r<t.getMinResolution())u.className+=" disabled";else if(t.getMinZoom&&t.getMaxZoom){const i=e.getView().getZoom();(i<=t.getMinZoom()||i>t.getMaxZoom())&&(u.className+=" disabled")}l.appendChild(u)}return l}static renderLayers_(e,t,i,r,o){let s=t.getLayers().getArray().slice();r.reverse&&(s=s.reverse());for(let a,l=0;l<s.length;l++)a=s[l],a.get("title")&&i.appendChild(n.renderLayer_(e,a,l,r,o))}static forEachRecursive(e,t){e.getLayers().forEach(function(e,r,o){t(e,r,o),e instanceof i&&n.forEachRecursive(e,t)})}static uuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}static enableTouchScroll_(e){if(n.isTouchDevice_()){let t=0;e.addEventListener("touchstart",function(e){t=this.scrollTop+e.touches[0].pageY},!1),e.addEventListener("touchmove",function(e){this.scrollTop=t-e.touches[0].pageY},!1)}}static isTouchDevice_(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}}static toggleFold_(e,t){t.classList.remove(r+e.get("fold")),e.set("fold","open"===e.get("fold")?"close":"open"),t.classList.add(r+e.get("fold"))}static getGroupSelectStyle(e){return["none","children","group"].indexOf(e)>=0?e:"children"}}return window.ol&&window.ol.control&&(window.ol.control.LayerSwitcher=n),n}(He(ge),He(pe),He(fe))));class Ht extends le{constructor(e){super(e),this.map=e.map,this.element=document.createElement("div"),this.element.className="custom-zoom-level-control"}render(){const e=this.map.getView().getZoom();this.element.innerHTML=`Zoom: ${e.toFixed(1)}`}onAdd(){return this.render(),this.map.getView().on("change:resolution",this.render,this),this.element}onRemove(){this.map.getView().un("change:resolution",this.render,this)}}var qt,Qt={};!function(){if(qt)return Qt;qt=1;var e=function(){},t="+",i="0",r="23456789CFGHJMPQRVWX",n=90,o=180,s=10,a=[20,1,.05,.0025,125e-6],l=125e-6;e.prototype.isValid=function(e){if(!e)return!1;if(-1==e.indexOf(t))return!1;if(e.indexOf(t)!=e.lastIndexOf(t))return!1;if(1==e.length)return!1;if(e.indexOf(t)>8||e.indexOf(t)%2==1)return!1;if(e.indexOf(i)>-1){if(0==e.indexOf(i))return!1;var n=e.match(new RegExp("(0+)","g"));if(n.length>1||n[0].length%2==1||n[0].length>6)return!1;if(e.charAt(e.length-1)!=t)return!1}if(e.length-e.indexOf(t)-1==1)return!1;for(var o=0,s=(e=e.replace(new RegExp("\\++"),"").replace(new RegExp("0+"),"")).length;o<s;o++){var a=e.charAt(o).toUpperCase();if(a!=t&&-1==r.indexOf(a))return!1}return!0},e.prototype.isShort=function(e){return!!this.isValid(e)&&(e.indexOf(t)>=0&&e.indexOf(t)<8)},e.prototype.isFull=function(e){if(!this.isValid(e))return!1;if(this.isShort(e))return!1;if(20*r.indexOf(e.charAt(0).toUpperCase())>=180)return!1;if(e.length>1&&20*r.indexOf(e.charAt(1).toUpperCase())>=360)return!1;return!0},e.prototype.encode=function(e,t,i){if(void 0===i&&(i=s),i<2||i<8&&i%2==1)throw"IllegalArgumentException: Invalid Open Location Code length";e=c(e),t=u(t),90==e&&(e-=h(i));var r=d(e,t,Math.min(i,s));return i>s&&(r+=g(e,t,i-s)),r},e.prototype.decode=function(e){if(!this.isFull(e))throw"IllegalArgumentException: Passed Open Location Code is not a valid full code: "+e;e=(e=(e=e.replace(t,"")).replace(new RegExp("0+"),"")).toUpperCase();var i=p(e.substring(0,s));if(e.length<=s)return i;var r=m(e.substring(s));return y(i.latitudeLo+r.latitudeLo,i.longitudeLo+r.longitudeLo,i.latitudeLo+r.latitudeHi,i.longitudeLo+r.longitudeHi,i.codeLength+r.codeLength)},e.prototype.recoverNearest=function(e,i,r){if(!this.isShort(e)){if(this.isFull(e))return e;throw"ValueError: Passed short code is not valid: "+e}i=c(i),r=u(r);var n=8-(e=e.toUpperCase()).indexOf(t),o=Math.pow(20,2-n/2),s=o/2,a=Math.floor(i/o)*o,l=Math.floor(r/o)*o,h=this.decode(this.encode(a,l).substr(0,n)+e),d=h.latitudeCenter-i;return d>s?h.latitudeCenter-=o:d<-s&&(h.latitudeCenter+=o),(d=h.longitudeCenter-r)>s?h.longitudeCenter-=o:d<-s&&(h.longitudeCenter+=o),this.encode(h.latitudeCenter,h.longitudeCenter,h.codeLength)},e.prototype.shorten=function(e,t,r){if(!this.isFull(e))throw"ValueError: Passed code is not valid and full: "+e;if(-1!=e.indexOf(i))throw"ValueError: Cannot shorten padded codes: "+e;e=e.toUpperCase();var n=this.decode(e);if(n.codeLength<6)throw"ValueError: Code length must be at least 6";t=c(t),r=u(r);for(var o=Math.max(Math.abs(n.latitudeCenter-t),Math.abs(n.longitudeCenter-r)),s=a.length-2;s>=1;s--)if(o<.3*a[s])return e.substring(2*(s+1));return e};var c=function(e){return Math.min(90,Math.max(-90,e))},h=function(e){return e<=10?Math.pow(20,Math.floor(e/-2+2)):Math.pow(20,-3)/Math.pow(5,e-10)},u=function(e){for(;e<-180;)e+=360;for(;e>=180;)e-=360;return e},d=function(e,s,l){for(var c="",h=e+n,u=s+o,d=0;d<l;){var g=a[Math.floor(d/2)],p=Math.floor(h/g);h-=p*g,c+=r.charAt(p),d+=1,u-=(p=Math.floor(u/g))*g,c+=r.charAt(p),8==(d+=1)&&d<l&&(c+=t)}return c.length<8&&(c+=Array(8-c.length+1).join(i)),8==c.length&&(c+=t),c},g=function(e,t,i){for(var s="",a=l,c=l,h=(e+n)%a,u=(t+o)%c,d=0;d<i;d++){var g=Math.floor(h/(a/5)),p=Math.floor(u/(c/4));h-=g*(a/=5),u-=p*(c/=4),s+=r.charAt(4*g+p)}return s},p=function(e){var t=f(e,0),i=f(e,1);return new y(t[0]-n,i[0]-o,t[1]-n,i[1]-o,e.length)},f=function(e,t){for(var i=0,n=0;2*i+t<e.length;)n+=r.indexOf(e.charAt(2*i+t))*a[i],i+=1;return[n,n+a[i-1]]},m=function(e){for(var t=0,i=0,n=l,o=l,s=0;s<e.length;){var a=r.indexOf(e.charAt(s));t+=Math.floor(a/4)*(n/=5),i+=a%4*(o/=4),s+=1}return y(t,i,t+n,i+o,e.length)},y=e.prototype.CodeArea=function(e,t,i,r,n){return new w.init(e,t,i,r,n)},w={init:function(e,t,i,r,s){this.latitudeLo=e,this.longitudeLo=t,this.latitudeHi=i,this.longitudeHi=r,this.codeLength=s,this.latitudeCenter=Math.min(e+(i-e)/2,n),this.longitudeCenter=Math.min(t+(r-t)/2,o)}};Qt.OpenLocationCode=e}();class Jt{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=Se,this.supportedMediaTypes=null}getReadOptions(e,t){if(t){let i=t.dataProjection?$(t.dataProjection):this.readProjection(e);t.extent&&i&&"tile-pixels"===i.getUnits()&&(i=$(i),i.setWorldExtent(t.extent)),t={dataProjection:i,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},e)}getType(){return ne()}readFeature(e,t){return ne()}readFeatures(e,t){return ne()}readGeometry(e,t){return ne()}readProjection(e){return ne()}writeFeature(e,t){return ne()}writeFeatures(e,t){return ne()}writeGeometry(e,t){return ne()}}function $t(e,t,i){const r=i?$(i.featureProjection):null,n=i?$(i.dataProjection):null;let o=e;if(r&&n&&!ae(r,n)){t&&(o=e.clone());const i=t?r:n,s=t?n:r;"tile-pixels"===i.getUnits()?o.transform(i,s):o.applyTransform(m(i,s))}if(t&&i&&void 0!==i.decimals){const t=Math.pow(10,i.decimals),r=function(e){for(let i=0,r=e.length;i<r;++i)e[i]=Math.round(e[i]*t)/t;return e};o===e&&(o=e.clone()),o.applyTransform(r)}return o}const ei={Point:be,LineString:ve,Polygon:Te,MultiPoint:xe,MultiLineString:_e,MultiPolygon:we};function ti(e,t){var i;const r=e.geometry;if(!r)return[];if(Array.isArray(r))return r.map(t=>ti({...e,geometry:t})).flat();const n="MultiPolygon"===r.type?"Polygon":r.type;if("GeometryCollection"===n||"Circle"===n)throw new Error("Unsupported geometry type: "+n);const o=r.layout.length;return $t(new me(n,"Polygon"===n?function(e,t,i){return Array.isArray(t[0])?(Fe(e,0,t,i)||(e=e.slice(),Ce(e,0,t,i)),e):(Ae(e,0,t,i)||(e=e.slice(),Ee(e,0,t,i)),e)}(r.flatCoordinates,r.ends,o):r.flatCoordinates,null==(i=r.ends)?void 0:i.flat(),o,e.properties||{},e.id).enableSimplifyTransformed(),!1,t)}function ii(e,t){if(!e)return null;if(Array.isArray(e)){const i=e.map(e=>ii(e,t));return new ye(i)}return $t(new(0,ei[e.type])(e.flatCoordinates,e.layout||"XY",e.ends),!1,t)}class ri extends Jt{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(ni(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(ni(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return ne()}readFeaturesFromObject(e,t){return ne()}readGeometry(e,t){return this.readGeometryFromObject(ni(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return ne()}readProjection(e){return this.readProjectionFromObject(ni(e))}readProjectionFromObject(e){return ne()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return ne()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return ne()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return ne()}}function ni(e){if("string"==typeof e){const t=JSON.parse(e);return t||null}return null!==e?e:null}class oi extends ri{constructor(e){e=e||{},super(),this.dataProjection=$(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=$(e.featureProjection)),e.featureClass&&(this.featureClass=e.featureClass),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let i=null;i="Feature"===e.type?e:{type:"Feature",geometry:e,properties:null};const r=si(i.geometry);if(this.featureClass===me)return ti({geometry:r,id:i.id,properties:i.properties},t);const n=new Se;return this.geometryName_?n.setGeometryName(this.geometryName_):this.extractGeometryName_&&i.geometry_name&&n.setGeometryName(i.geometry_name),n.setGeometry(ii(r,t)),"id"in i&&n.setId(i.id),i.properties&&n.setProperties(i.properties,!0),n}readFeaturesFromObject(e,t){let i=null;if("FeatureCollection"===e.type){i=[];const r=e.features;for(let e=0,n=r.length;e<n;++e){const n=this.readFeatureFromObject(r[e],t);n&&i.push(n)}}else i=[this.readFeatureFromObject(e,t)];return i.flat()}readGeometryFromObject(e,t){return function(e,t){const i=si(e);return ii(i,t)}(e,t)}readProjectionFromObject(e){const t=e.crs;let i;if(t)if("name"==t.type)i=$(t.properties.name);else{if("EPSG"!==t.type)throw new Error("Unknown SRS type");i=$("EPSG:"+t.properties.code)}else i=this.dataProjection;return i}writeFeatureObject(e,t){t=this.adaptOptions(t);const i={type:"Feature",geometry:null,properties:null},r=e.getId();if(void 0!==r&&(i.id=r),!e.hasProperties())return i;const n=e.getProperties(),o=e.getGeometry();return o&&(i.geometry=ai(o,t),delete n[e.getGeometryName()]),Me(n)||(i.properties=n),i}writeFeaturesObject(e,t){t=this.adaptOptions(t);const i=[];for(let r=0,n=e.length;r<n;++r)i.push(this.writeFeatureObject(e[r],t));return{type:"FeatureCollection",features:i}}writeGeometryObject(e,t){return ai(e,this.adaptOptions(t))}}function si(e,t){if(!e)return null;let i;switch(e.type){case"Point":i=function(e){const t=e.coordinates;return{type:"Point",flatCoordinates:t,layout:je(t.length)}}(e);break;case"LineString":i=function(e){var t;const i=e.coordinates,r=i.flat();return{type:"LineString",flatCoordinates:r,ends:[r.length],layout:je((null==(t=i[0])?void 0:t.length)||2)}}(e);break;case"Polygon":i=function(e){var t,i;const r=e.coordinates,n=[],o=null==(i=null==(t=r[0])?void 0:t[0])?void 0:i.length,s=Le(n,0,r,o);return{type:"Polygon",flatCoordinates:n,ends:s,layout:je(o)}}(e);break;case"MultiPoint":i=function(e){var t;const i=e.coordinates;return{type:"MultiPoint",flatCoordinates:i.flat(),layout:je((null==(t=i[0])?void 0:t.length)||2)}}(e);break;case"MultiLineString":i=function(e){var t,i;const r=e.coordinates,n=(null==(i=null==(t=r[0])?void 0:t[0])?void 0:i.length)||2,o=[],s=Le(o,0,r,n);return{type:"MultiLineString",flatCoordinates:o,ends:s,layout:je(n)}}(e);break;case"MultiPolygon":i=function(e){var t,i;const r=e.coordinates,n=[],o=(null==(i=null==(t=r[0])?void 0:t[0])?void 0:i[0].length)||2,s=Pe(n,0,r,o);return{type:"MultiPolygon",flatCoordinates:n,ends:s,layout:je(o)}}(e);break;case"GeometryCollection":i=function(e){const t=e.geometries.map(function(e){return si(e)});return t}(e);break;default:throw new Error("Unsupported GeoJSON type: "+e.type)}return i}function ai(e,t){const i=(e=$t(e,!0,t)).getType();let r;switch(i){case"Point":r=function(e){return{type:"Point",coordinates:e.getCoordinates()}}(e);break;case"LineString":r=function(e){return{type:"LineString",coordinates:e.getCoordinates()}}(e);break;case"Polygon":r=function(e,t){let i;t&&(i=t.rightHanded);return{type:"Polygon",coordinates:e.getCoordinates(i)}}(e,t);break;case"MultiPoint":r=function(e){return{type:"MultiPoint",coordinates:e.getCoordinates()}}(e);break;case"MultiLineString":r=function(e){return{type:"MultiLineString",coordinates:e.getCoordinates()}}(e);break;case"MultiPolygon":r=function(e,t){let i;t&&(i=t.rightHanded);return{type:"MultiPolygon",coordinates:e.getCoordinates(i)}}(e,t);break;case"GeometryCollection":r=function(e,t){t=Object.assign({},t),delete t.featureProjection;const i=e.getGeometriesArray().map(function(e){return ai(e,t)});return{type:"GeometryCollection",geometries:i}}(e,t);break;case"Circle":r={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+i)}return r}const li=qe(Qe()),ci=(e,t)=>{try{let i=e.getLayerGroup().getLayers().getArray().find(e=>e instanceof U&&e.get("title")===t);return i||(i=new We({layers:[]}),i.set("title",t),e.addLayer(i)),i}catch(i){console.error(i),li({text:i,duration:3e3}).showToast()}};class hi{constructor(e,t){this.map=e,this.options=t,this.layer=new De({visible:!0,zIndex:100,source:new Ne({}),style:this._styleFunction}),this.duration=1e3,this.start=Date.now(),t.title&&this.layer.set("title",t.title),this.getSource().on("addfeature",e=>{this._flash(e.feature)})}_styleFromUrl(e){return new ze({image:new ke({anchor:[.5,.5],src:e})})}_styleName(e){return new ze({text:new Ie({font:"12px Arial",offsetY:27,offsetX:0,fill:new Re({color:"#000"}),stroke:new Oe({color:"#fff",width:4}),text:e})})}_styleFunction(e){return mi.default}_flash(e){const t=performance.now(),i=e.getGeometry().clone();e._flashListenerKey&&(Ze(e._flashListenerKey),e._flashListenerKey=null);let r=!0;const n=i=>{if(!r)return;if(i-t>=this.duration)return r=!1,e._flashListenerKey&&(Ze(e._flashListenerKey),e._flashListenerKey=null),void this.map.render();this.map.render(),requestAnimationFrame(n)};e._flashListenerKey=this.layer.on("postrender",e=>{if(!r)return;e.frameState;const n=(performance.now()-t)/this.duration,o=25*Xe(n)+5,s=Xe(1-n),a=Ue(e),l=new ze({image:new Ge({radius:o,stroke:new Oe({color:`rgba(142, 245, 39, ${s})`,width:3*s})})});a.setStyle(l),a.drawGeometry(i)}),requestAnimationFrame(n)}addFeature(e){const t=this.layer.getSource(),i=new be(Ve([e.x,e.y])),r=new Se(i);e.fleet&&e.avatar&&e.uniqueid&&(r.set("fleet",e.fleet),r.set("avatar_icon",e.avatar),r.set("unique_id",e.uniqueid),r.setStyle([this._styleFromUrl(e.avatar),this._styleName(e.userId)])),t&&t.addFeature(r)}clearFeatures(){const e=this.layer.getSource();e&&e.clear()}getSource(){return this.layer.getSource()}}class ui{constructor(e,t){this.map=e,this.options=t,this.layer=new De({visible:!0,source:new Ne({}),style:this._styleFunction}),this.geojsonFormat=new oi({dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"}),this.mapGeoFences={},this.featureCounters={},this.layer.getSource().on("addfeature",e=>{this.mapGeoFences[e.feature.get("Name")]=e.feature,this.featureCounters[e.feature.get("Name")]=0}),t.title&&this.layer.set("title",t.title)}_styleFunction(e,t){const i=fi.default;let r=i.getText();return r&&r.setText(e.get("Name")),i}addLayer(){this.layer.setVisible(!0),this.map.addLayer(this.layer)}removeLayer(){this.map.removeLayer(this.layer)}getSource(){return this.layer.getSource()}incrementUserCount(e){this.featureCounters[e]=this.featureCounters[e]+1}decrementUserCount(e){this.featureCounters[e]>0&&(this.featureCounters[e]=this.featureCounters[e]-1)}getFeatureCount(e){return this.featureCounters[e]}async setSource(e){try{const t=await fetch(e),i=await t.json();if(i.data&&i.data.length>0){const e=this.layer.getSource();e&&(e.clear(),i.data.forEach(t=>{if(t.object)try{const i=JSON.parse(t.object);this.geojsonFormat.readFeatures(i).forEach(r=>{r.set("Name",t.id);let n=null;"FeatureCollection"===i.type?i.features&&i.features.length>0&&(n=i.features[0].properties):n=(i.type,i.properties),n&&"object"==typeof n&&Object.keys(n).forEach(e=>{const t=n[e];null!=t&&""!==t&&(r.set(e,t),"Name"===e&&r.set("Name",t))}),r.set("fence_id",t.id),e.addFeature(r)})}catch(i){console.error(`Error parsing fence object for ID ${t.id}:`,i),console.log("Problematic object:",t.object)}}))}}catch(t){console.error("Error:",t)}}setVisibility(e){this.layer.setVisible(e)}getLayer(){return this.layer}getStyleByHook(e="default"){return function(t,i){const r=fi[e];let n=r.getText();return n&&n.setText(t.get("Name")),r}}}class di{constructor(e,t){this.map=e,this.options=t,this.layer=new De({visible:!0,zIndex:99,source:new Ne({}),style:this._styleFunction.bind(this)}),t.title&&this.layer.set("title",t.title)}_styleFunction(e){const t=e.getGeometry(),i=[new ze({stroke:new Oe({color:e.get("color")||"#3C64E9",width:3})})];return"LineString"===t.getType()&&t.forEachSegment((e,t)=>{const r=t[0]-e[0],n=t[1]-e[1],o=Math.atan2(n,r);i.push(new ze({geometry:new be(t),image:new ke({src:"assets/row_right_16.png",anchor:[.75,.5],rotateWithView:!0,rotation:-o,scale:.7})}))}),i}clearFeatures(){this.layer.getSource().clear()}filterHistoryByMaxSegment(e,t=500){if(!Array.isArray(e)||e.length<2)return e;const i=[e[e.length-1]];for(let r=e.length-2;r>=0;r--){const n=i[i.length-1].coordinates,o=e[r].coordinates;this._calculateDistance(o,n)<=t&&i.push(e[r])}return i.reverse()}_calculateDistance(e,t){const i=e=>e*Math.PI/180,r=i(e[1]),n=i(e[0]),o=i(t[1]),s=o-r,a=i(t[0])-n,l=Math.sin(s/2)*Math.sin(s/2)+Math.cos(r)*Math.cos(o)*Math.sin(a/2)*Math.sin(a/2);return 6371e3*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))}addTrajectory(e,t=""){const i=this.filterHistoryByMaxSegment(e,500);if(!Array.isArray(i)||i.length<2)return;const r=i.map(e=>Ve(e.coordinates)),n=new Se({geometry:new ve(r),color:t}),o=this.layer.getSource();o&&o.addFeature(n)}}class gi{constructor(e,t){this.map=e,this.options=t,this.layer=new De({visible:!0,zIndex:101,source:new Ne({})}),t.title&&this.layer.set("title",t.title)}_styleFunction(e){return new ze({image:new Ge({radius:4,stroke:new Oe({color:"#2196F3",width:1}),fill:new Re({color:"rgba(33, 150, 243, 0.7)"})}),text:new Ie({font:"12px Arial",offsetY:-20,offsetX:0,fill:new Re({color:"#000"}),stroke:new Oe({color:"#fff",width:3}),text:e.get("name")||e.get("userId")||"Punto"})})}addFeature(e){const t=this.layer.getSource(),i=new be(Ve([e.x,e.y])),r=new Se(i);e.id&&r.set("id",e.id),e.name&&r.set("name",e.name),e.userId&&r.set("userId",e.userId),e.fleet&&r.set("fleet",e.fleet),t&&t.addFeature(r)}clearFeatures(){const e=this.layer.getSource();e&&e.clear()}getSource(){return this.layer.getSource()}getLayer(){return this.layer}setVisibility(e){this.layer.setVisible(e)}}const pi=new Ge({radius:5,stroke:new Oe({color:"red",width:1}),fill:new Re({color:"rgba(255, 0, 0, 0.1)"})}),fi={enter:new ze({stroke:new Oe({color:"rgba(191, 44, 44, 1)",lineDash:[4],width:3}),fill:new Re({color:"rgba(255, 0, 0, 0.5)"}),text:new Ie({text:"enter"})}),cross:new ze({stroke:new Oe({color:"rgba(191, 44, 44, 1)",lineDash:[4],width:3}),fill:new Re({color:"rgba(255, 0, 0, 0.5)"}),text:new Ie({text:"cross"})}),exit:new ze({stroke:new Oe({color:"blue",width:3}),fill:new Re({color:"rgba(212, 212, 212, 0.5)"}),text:new Ie({text:"exit"})}),default:new ze({stroke:new Oe({color:"blue",width:3}),fill:new Re({color:"rgba(212, 212, 212, 0.5)"}),text:new Ie({text:"default",textAlign:"center",textBaseline:"middle",font:"normal 12px Arial",fill:new Re({color:"#000"}),stroke:new Oe({color:"#fff",width:2})})})},mi={default:new ze({image:new ke({anchor:[.5,1],src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAACxMAAAsTAQCanBgAAASxSURBVFhHtZdraBxVFMfPnd3sI9mkSbSktURJSNEiFFNrRME2bnzgF/WLii2CKTGINAi1fhGKIvhFBFGwaI1KiwRFpZLQVqVpTKw0VLtFW9qoSWy0ScymadY89r1z/Z+ZmzWbnZlNbPzBzZx77tk5555zHxNBy6Qs2Fk8LzzbM0QPEIkGqDaiXWcMkryKP4MkZb9G+jc3apHeS8d3Rs0xZwoGoN172Eeav0UnsRvdm01tIeRFTWbeLU+G26+ebHYMxDEALXi0QReudyBuNTUrRZ5x6/G2dM+jp5QiD/sAgl/tICEOQCoxFf8VGRV68jnZ8/BBpcjBMgCt6dhOnbSPVXdV0DLxXfq3j3ykulnyAihqOnJnitwnIBabmtVCxrTU7EN632O9SmGgqadB7YOf+NJk1HyVnTPCr7tL3r5+y8trlMIgJ4BLqTUtksTtqmuPQOIEfmo8F8mFEK7NU6X1rapn4FJPqmr6DPvc+z6s1iqVNewoNk80NU40OUYUuUKUwE5zuVE/jzJyQGg1JWW1HamJvhh3sxmYkMXbMftNqmvPxJ9EZ84SnR8iGp4w2/lhoh+h47FCCFddtOzWRtX7NwBB2v1KtIZnPjlKdG6QSNeJvJixBwnk5kWT0PEY2xQoh3T5mpS4aA0Iuk1J+fAL40jzbyNIM5xZOWAdj7EN2zoFIdybbyDysWgGcMd+P9K/wZAtwctmplH7JH7h8GIeY5sZvhqcAtDW/137VIBFI4Ayn4+jMSKyRhae1QJGtnh94Tf2+GJFlcZWNwKIJebTeHCzZznOl0/Gq8/jYlUBuE+3RXGVhlm2Bs79uBKk46xM2KaYs+sQsNSnvMPt2MsLGUBEJDPnWLYGLy2rICpFlXSHIDJsBxu2dSqBnrxYk6E5Fs1FCDQ91a3EfHhWHj8+QWpRKMjsaCms41YHG7Z1yJZIzvbi1DBKng3AMz/cjdRgD9nA+7yyimgLzqoATrwESri4BbzmGNuwrR16elSb7O9RvdxCicYv90mX/1XVtYbP/WScaC6C2qmPHT8WdGk5zgGk38k5k4y8Vf3dEy/izExxN5sBxjUz+IFjFhh24MFsK9cRbUC6ubFcBJ2jc8wVsxdjve0LzpmcANKhvWMiPeucAYbry85ymn3NTTAeC78RGNo/oBQGOQEw1X2PH6RMvEN1VwnMPjV32N3ffGh2yXmTF8AfWMvu8Pd7ka6flOoagfNM/IJr5It924hwnueSFwCTvvD6uGv292acDbj0rwWueyqsXQm11Y90DOA7L69OObtgKdpdHzbp/vWfYuWrf0BWAl4t09MiMvDM2tCeThyz2YW3GMsMLKCf2tUtoqM7sMimlGqZZJ23bgzt6bJzzuACL8DlziGtqjEkiwL3IROlSuuAkfa/KDLw7E1nX+jCtxLuZ3sKBwDk5a5hUbG1j7wV9yAIh29Gdp74hcI/tGz6+aXj+D5ydM4sKwCD8a/HPIGaYxn/ultIc9cpbS7paI820tla/eubp/HFaJv2xTguQitw3pUntn3+ChUFnjd/zg0HUWL6gDj55Gv1RKMhbDzD+P8iyJm7+9DTFDw6QcEjk6Lhvd24Bcqxz1c4IaJ/AMrqpa32gMLfAAAAAElFTkSuQmCC"})}),avatar:new ze({image:new ke({anchor:[.5,.5],anchorXUnits:"fraction",src:"data:image/png;base64,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"})}),car:new ze({image:new ke({anchor:[.5,1],src:"data:image/png;base64,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"})})};new ze({image:new Ge({radius:4,stroke:new Oe({color:"red",width:1}),fill:new Re({color:"rgba(255, 0, 0, 0.3)"})})}),new ze({stroke:new Oe({color:"red",width:3.3,lineDash:[4]})}),new ze({stroke:new Oe({color:"green",width:1})}),new ze({image:pi}),new ze({stroke:new Oe({color:"#d47c1d",lineDash:[4],width:3}),fill:new Re({color:"rgba(212, 124, 29, 0.3)"})}),new ze({stroke:new Oe({color:"#d47c1d",lineDash:[4],width:3}),fill:new Re({color:"rgba(212, 124, 29, 0.3)"})}),new ze({stroke:new Oe({color:"magenta",width:2}),fill:new Re({color:"magenta"}),image:new Ge({radius:10,stroke:new Oe({color:"magenta"})})}),new ze({stroke:new Oe({color:"red",width:2}),fill:new Re({color:"rgba(255,0,0,0.2)"})});function yi(e){const t=Ke({attribution:!1,zoom:!0,rotate:!0});let i=document.getElementById("controlSidepanel");i||(console.warn("controlSidepanel no encontrado, creando elemento..."),i=document.createElement("div"),i.id="controlSidepanel",i.className="sidepanel",document.body.appendChild(i));const r=new Xt({target:i,coordinateFormat:function(e){return"lon: "+e[0].toFixed(6)+", lat: "+e[1].toFixed(6)},className:"custom-mouse-position",projection:"EPSG:4326"}),n=new Tt({title:"OpenStreetMap",type:"base",visible:!0,source:new Vt({url:"https://{a-c}.tile.osm-tile-electrosoftware.xyz/{z}/{x}/{y}.png"}),zIndex:0}),o=new Tt({title:"Code Plus",visible:!1,source:new Zt({attributions:['grid by <a href="https://plus.codes">plus codes</a>'],url:"https://grid.plus.codes/grid/wms/{z}/{x}/{y}.png?col=red"}),zIndex:4}),s=new Be({controls:t.extend([r]),layers:[n,o],target:e,view:new Ye({constrainResolution:!0,center:Ve([-73.850304,5.151929]),minZoom:0,maxZoom:20,zoom:5})}),a=new Yt({activationMode:"click",tipLabel:"Capas",reverse:!0,groupSelectStyle:"group"});s.addControl(a);const l=new Ht({map:s,target:document.getElementById("controlSidepanel")});s.addControl(l),s.on("pointermove",function(e){if(e.dragging)return;let t=s.getEventPixel(e.originalEvent),i=s.hasFeatureAtPixel(t);s.getTargetElement().style.cursor=i?"pointer":""});return Je.subscribe("featureSelected",e=>{s.getView().fit(e.getGeometry().getExtent(),{duration:1e3}),function(e){const t=Date.now(),i=e.getGeometry().clone(),r=n.on("postrender",function(e){const n=e.frameState.time-t;if(n>=3e3)return void Ze(r);const o=Ue(e),a=n/3e3,l=25*Xe(a)+5,c=Xe(1-a),h=new ze({image:new Ge({radius:l,stroke:new Oe({color:"rgba(255, 0, 0, "+c+")",width:.25+c})})});o.setStyle(h),o.drawGeometry(i),s.render()})}(e)}),Je.subscribe("centerView",e=>{const t=e.longitud,i=e.latitud,r=e.zoom;s.getView().animate({center:Ve([t,i]),zoom:r,duration:1500})}),Je.subscribe("initialView",e=>{const t=e.longitud,i=e.latitud,r=e.zoom;s.getView().setCenter(Ve([t,i])),s.getView().setZoom(r)}),s}new ze({image:new Ge({radius:4,fill:new Re({color:"#FFFF00"}),stroke:new Oe({color:"#292929",width:1})})}),new ze({image:new Ge({radius:6,fill:new Re({color:"#EF7F07"}),stroke:new Oe({color:"#000000",width:1})})}),new ze({image:new Ge({radius:4,fill:new Re({color:"#C1E8F7"}),stroke:new Oe({color:"#000000",width:1})})}),new ze({image:new Ge({radius:5,fill:new Re({color:"#818181"}),stroke:new Oe({color:"818181",width:1})})});export{hi as G,li as T,ui as a,di as b,gi as c,ci as g,yi as i};
