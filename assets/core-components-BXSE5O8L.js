import{T as Ft,a as P,c as Ve,e as Ht,g as me,b as $e,d as U,f as Me,s as Qt,r as et,h as Jt,i as $t,t as Ct,j as ht,k as tt,l as ei,m as bt,n as ti,o as ii,p as ni,q as We,u as dt,v as Pt,w as Fe,x as je,y as Ke,z as he,A as Be,B as gt,E as St,C as Ye,D as ri,F as si,G as re,H as oi,I as Mt,J as se,K as Lt,L as K,M as ai,N as qe,O as li,P as ci,Q as ui,R as Rt,S as hi,U as Ot,V as le,W as Gt,X as di,Y as gi,Z as Te,_ as Ee,$ as W,a0 as fi,a1 as mi,a2 as pi,a3 as yi,a4 as k,a5 as xi,a6 as wi,a7 as Ce,a8 as jt,a9 as ft,aa as _i,ab as Ti,ac as Ei,ad as Ai,ae as vi,af as Fi,ag as It,ah as Ci,ai as bi,aj as Pi,ak as Si,al as Mi,am as zt,an as Le,ao as ye,ap as Li,aq as Ri,ar as Oi,as as Gi,at as ji,au as Ii,av as fe,aw as Dt,ax as Q,ay as D,az as j,aA as O,aB as ue,aC as pe,aD as Re,aE as Oe,aF as He,aG as de,aH as zi,aI as Nt,aJ as Pe,aK as Di,aL as Ni,aM as ki}from"./maps-DQlQjAlI.js";import{g as it,a as kt,r as Xi}from"./ui-BKNfdvBf.js";import{P as Ie}from"./utils-DvkBdQn9.js";import"./optional-components-xCqk0V7o.js";function Qe(s){return s instanceof Image||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageBitmap?s:null}const Ui=new Error("disposed"),Zi=[256,256];class mt extends Ft{constructor(e){const t=P.IDLE;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null,this.controller_=e.controller||null}getSize(){if(this.size_)return this.size_;const e=Qe(this.data_);return e?[e.width,e.height]:Zi}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==P.IDLE&&this.state!==P.ERROR)return;this.state=P.LOADING,this.changed();const e=this;this.loader_().then(function(t){e.data_=t,e.state=P.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=P.ERROR,e.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(Ui),this.controller_=null),super.disposeInternal()}}let ze;const ge=[];function pt(s,e,t,i,n){s.beginPath(),s.moveTo(0,0),s.lineTo(e,t),s.lineTo(i,n),s.closePath(),s.save(),s.clip(),s.fillRect(0,0,Math.max(e,i)+1,Math.max(t,n)),s.restore()}function De(s,e){return Math.abs(s[e*4]-210)>2||Math.abs(s[e*4+3]-.75*255)>2}function Vi(){if(ze===void 0){const s=Ve(6,6,ge);s.globalCompositeOperation="lighter",s.fillStyle="rgba(210, 0, 0, 0.75)",pt(s,4,5,4,0),pt(s,4,5,0,5);const e=s.getImageData(0,0,3,3).data;ze=De(e,0)||De(e,4)||De(e,8),et(s),ge.push(s.canvas)}return ze}function yt(s,e,t,i){const n=Ct(t,e,s);let r=ht(e,i,t);const o=e.getMetersPerUnit();o!==void 0&&(r*=o);const u=s.getMetersPerUnit();u!==void 0&&(r/=u);const l=s.getExtent();if(!l||tt(l,n)){const a=ht(s,r,n)/r;isFinite(a)&&a>0&&(r/=a)}return r}function Wi(s,e,t,i){const n=Jt(t);let r=yt(s,e,n,i);return(!isFinite(r)||r<=0)&&$t(t,function(o){return r=yt(s,e,o,i),isFinite(r)&&r>0}),r}function Ki(s,e,t,i,n,r,o,u,l,a,c,h,f,m){const g=Ve(Math.round(t*s),Math.round(t*e),ge);if(h||(g.imageSmoothingEnabled=!1),l.length===0)return g.canvas;g.scale(t,t);function _(x){return Math.round(x*t)/t}g.globalCompositeOperation="lighter";const y=$e();l.forEach(function(x,G,R){Ht(y,x.extent)});let A;const b=t/i,T=(h?1:1+Math.pow(2,-24))/b;A=Ve(Math.round(U(y)*b),Math.round(me(y)*b),ge),h||(A.imageSmoothingEnabled=!1),l.forEach(function(x,G,R){if(x.image.width>0&&x.image.height>0){if(x.clipExtent){A.save();const F=(x.clipExtent[0]-y[0])*b,C=-(x.clipExtent[3]-y[3])*b,S=U(x.clipExtent)*b,L=me(x.clipExtent)*b;A.rect(h?F:Math.round(F),h?C:Math.round(C),h?S:Math.round(F+S)-Math.round(F),h?L:Math.round(C+L)-Math.round(C)),A.clip()}const d=(x.extent[0]-y[0])*b,w=-(x.extent[3]-y[3])*b,p=U(x.extent)*b,E=me(x.extent)*b;A.drawImage(x.image,a,a,x.image.width-2*a,x.image.height-2*a,h?d:Math.round(d),h?w:Math.round(w),h?p:Math.round(d+p)-Math.round(d),h?E:Math.round(w+E)-Math.round(w)),x.clipExtent&&A.restore()}});const v=Me(o);return u.getTriangles().forEach(function(x,G,R){const d=x.source,w=x.target;let p=d[0][0],E=d[0][1],F=d[1][0],C=d[1][1],S=d[2][0],L=d[2][1];const M=_((w[0][0]-v[0])/r),N=_(-(w[0][1]-v[1])/r),I=_((w[1][0]-v[0])/r),z=_(-(w[1][1]-v[1])/r),Z=_((w[2][0]-v[0])/r),oe=_(-(w[2][1]-v[1])/r),B=p,Y=E;p=0,E=0,F-=B,C-=Y,S-=B,L-=Y;const J=[[F,C,0,0,I-M],[S,L,0,0,Z-M],[0,0,F,C,z-N],[0,0,S,L,oe-N]],q=Qt(J);if(!q)return;if(g.save(),g.beginPath(),Vi()||!h){g.moveTo(I,z);const X=4,ae=M-I,ee=N-z;for(let H=0;H<X;H++)g.lineTo(I+_((H+1)*ae/X),z+_(H*ee/(X-1))),H!=X-1&&g.lineTo(I+_((H+1)*ae/X),z+_((H+1)*ee/(X-1)));g.lineTo(Z,oe)}else g.moveTo(I,z),g.lineTo(M,N),g.lineTo(Z,oe);g.clip(),g.transform(q[0],q[2],q[1],q[3],M,N),g.translate(y[0]-B,y[3]-Y);let $;if(A)$=A.canvas,g.scale(T,-T);else{const X=l[0],ae=X.extent;$=X.image,g.scale(U(ae)/$.width,-me(ae)/$.height)}g.drawImage($,0,0),g.restore()}),A&&(et(A),ge.push(A.canvas)),c&&(g.save(),g.globalCompositeOperation="source-over",g.strokeStyle="black",g.lineWidth=1,u.getTriangles().forEach(function(x,G,R){const d=x.target,w=(d[0][0]-v[0])/r,p=-(d[0][1]-v[1])/r,E=(d[1][0]-v[0])/r,F=-(d[1][1]-v[1])/r,C=(d[2][0]-v[0])/r,S=-(d[2][1]-v[1])/r;g.beginPath(),g.moveTo(E,F),g.lineTo(w,p),g.lineTo(C,S),g.closePath(),g.stroke()}),g.restore()),g.canvas}const Bi=10,xt=.25;class Yi{constructor(e,t,i,n,r,o,u){this.sourceProj_=e,this.targetProj_=t;let l={};const a=u?ei(T=>Ke(u,Ct(T,this.targetProj_,this.sourceProj_))):bt(this.targetProj_,this.sourceProj_);this.transformInv_=function(T){const v=T[0]+"/"+T[1];return l[v]||(l[v]=a(T)),l[v]},this.maxSourceExtent_=n,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&U(n)>=U(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?U(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?U(this.targetProj_.getExtent()):null;const c=Me(i),h=ti(i),f=ii(i),m=ni(i),g=this.transformInv_(c),_=this.transformInv_(h),y=this.transformInv_(f),A=this.transformInv_(m),b=Bi+(o?Math.max(0,Math.ceil(Math.log2(We(i)/(o*o*256*256)))):0);if(this.addQuad_(c,h,f,m,g,_,y,A,b),this.wrapsXInSource_){let T=1/0;this.triangles_.forEach(function(v,x,G){T=Math.min(T,v.source[0][0],v.source[1][0],v.source[2][0])}),this.triangles_.forEach(v=>{if(Math.max(v.source[0][0],v.source[1][0],v.source[2][0])-T>this.sourceWorldWidth_/2){const x=[[v.source[0][0],v.source[0][1]],[v.source[1][0],v.source[1][1]],[v.source[2][0],v.source[2][1]]];x[0][0]-T>this.sourceWorldWidth_/2&&(x[0][0]-=this.sourceWorldWidth_),x[1][0]-T>this.sourceWorldWidth_/2&&(x[1][0]-=this.sourceWorldWidth_),x[2][0]-T>this.sourceWorldWidth_/2&&(x[2][0]-=this.sourceWorldWidth_);const G=Math.min(x[0][0],x[1][0],x[2][0]);Math.max(x[0][0],x[1][0],x[2][0])-G<this.sourceWorldWidth_/2&&(v.source=x)}})}l={}}addTriangle_(e,t,i,n,r,o){this.triangles_.push({source:[n,r,o],target:[e,t,i]})}addQuad_(e,t,i,n,r,o,u,l,a){const c=dt([r,o,u,l]),h=this.sourceWorldWidth_?U(c)/this.sourceWorldWidth_:null,f=this.sourceWorldWidth_,m=this.sourceProj_.canWrapX()&&h>.5&&h<1;let g=!1;if(a>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const y=dt([e,t,i,n]);g=U(y)/this.targetWorldWidth_>xt||g}!m&&this.sourceProj_.isGlobal()&&h&&(g=h>xt||g)}if(!g&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!Pt(c,this.maxSourceExtent_))return;let _=0;if(!g&&(!isFinite(r[0])||!isFinite(r[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(u[0])||!isFinite(u[1])||!isFinite(l[0])||!isFinite(l[1]))){if(a>0)g=!0;else if(_=(!isFinite(r[0])||!isFinite(r[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(u[0])||!isFinite(u[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),_!=1&&_!=2&&_!=4&&_!=8)return}if(a>0){if(!g){const y=[(e[0]+i[0])/2,(e[1]+i[1])/2],A=this.transformInv_(y);let b;m?b=(Fe(r[0],f)+Fe(u[0],f))/2-Fe(A[0],f):b=(r[0]+u[0])/2-A[0];const T=(r[1]+u[1])/2-A[1];g=b*b+T*T>this.errorThresholdSquared_}if(g){if(Math.abs(e[0]-i[0])<=Math.abs(e[1]-i[1])){const y=[(t[0]+i[0])/2,(t[1]+i[1])/2],A=this.transformInv_(y),b=[(n[0]+e[0])/2,(n[1]+e[1])/2],T=this.transformInv_(b);this.addQuad_(e,t,y,b,r,o,A,T,a-1),this.addQuad_(b,y,i,n,T,A,u,l,a-1)}else{const y=[(e[0]+t[0])/2,(e[1]+t[1])/2],A=this.transformInv_(y),b=[(i[0]+n[0])/2,(i[1]+n[1])/2],T=this.transformInv_(b);this.addQuad_(e,y,b,n,r,A,T,l,a-1),this.addQuad_(y,t,i,b,A,o,u,T,a-1)}return}}if(m){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(_&11)==0&&this.addTriangle_(e,i,n,r,u,l),(_&14)==0&&this.addTriangle_(e,i,t,r,u,o),_&&((_&13)==0&&this.addTriangle_(t,n,e,o,l,r),(_&7)==0&&this.addTriangle_(t,n,i,o,l,u))}calculateSourceExtent(){const e=$e();return this.triangles_.forEach(function(t,i,n){const r=t.source;je(e,r[0]),je(e,r[1]),je(e,r[2])}),e}getTriangles(){return this.triangles_}}const qi=.5;class Xt extends Ft{constructor(e,t,i,n,r,o,u,l,a,c,h,f){super(r,P.IDLE,f),this.renderEdges_=h!==void 0?h:!1,this.pixelRatio_=u,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=n,this.wrappedTileCoord_=o||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=e.canWrapX()?e.getExtent():void 0;const m=n.getTileCoordExtent(this.wrappedTileCoord_),g=this.targetTileGrid_.getExtent();let _=this.sourceTileGrid_.getExtent();const y=g?he(m,g):m;if(We(y)===0){this.state=P.EMPTY;return}const A=e.getExtent();A&&(_?_=he(_,A):_=A);const b=n.getResolution(this.wrappedTileCoord_[0]),T=Wi(e,i,y,b);if(!isFinite(T)||T<=0){this.state=P.EMPTY;return}const v=c!==void 0?c:qi;if(this.triangulation_=new Yi(e,i,y,_,T*v,b),this.triangulation_.getTriangles().length===0){this.state=P.EMPTY;return}this.sourceZ_=t.getZForResolution(T);let x=this.triangulation_.calculateSourceExtent();if(_&&(e.canWrapX()?(x[1]=Ye(x[1],_[1],_[3]),x[3]=Ye(x[3],_[1],_[3])):x=he(x,_)),!We(x))this.state=P.EMPTY;else{let G=0,R=0;e.canWrapX()&&(G=U(A),R=Math.floor((x[0]-A[0])/G)),ri(x.slice(),e,!0).forEach(w=>{const p=t.getTileRangeForExtentAndZ(w,this.sourceZ_);for(let E=p.minX;E<=p.maxX;E++)for(let F=p.minY;F<=p.maxY;F++){const C=a(this.sourceZ_,E,F,u);if(C){const S=R*G;this.sourceTiles_.push({tile:C,offset:S})}}++R}),this.sourceTiles_.length===0&&(this.state=P.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{var n;const i=t.tile;if(i&&i.getState()==P.LOADED){const r=this.sourceTileGrid_.getTileCoordExtent(i.tileCoord);r[0]+=t.offset,r[2]+=t.offset;const o=(n=this.clipExtent_)==null?void 0:n.slice();o&&(o[0]+=t.offset,o[2]+=t.offset),e.push({extent:r,clipExtent:o,image:i.getImage()})}}),this.sourceTiles_.length=0,e.length===0)this.state=P.ERROR;else{const t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),n=typeof i=="number"?i:i[0],r=typeof i=="number"?i:i[1],o=this.targetTileGrid_.getResolution(t),u=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Ki(n,r,this.pixelRatio_,u,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=P.LOADED}this.changed()}load(){if(this.state==P.IDLE){this.state=P.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{const i=t.getState();if(i==P.IDLE||i==P.LOADING){e++;const n=Be(t,St.CHANGE,r=>{const o=t.getState();(o==P.LOADED||o==P.ERROR||o==P.EMPTY)&&(gt(n),e--,e===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(n)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:t},i,n){t.getState()==P.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(gt),this.sourcesListenerKeys_=null}release(){this.canvas_&&(et(this.canvas_.getContext("2d")),ge.push(this.canvas_),this.canvas_=null),super.release()}}class Hi{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){const e=this.pop();e instanceof si&&e.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const i=this.entries_[e];return re(i!==void 0,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(e){const t=this.entries_[e];return re(t!==void 0,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.key_;return e}getValues(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){var t;return(t=this.entries_[e])==null?void 0:t.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){re(!(e in this.entries_),"Tried to set a value for a key that is used already");const i={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[e]=i,++this.count_}setSize(e){this.highWaterMark=e}}function Se(s,e,t,i){return i!==void 0?(i[0]=s,i[1]=e,i[2]=t,i):[s,e,t]}function Qi(s,e,t){return s+"/"+e+"/"+t}function Ji(s){return $i(s[0],s[1],s[2])}function $i(s,e,t){return(e<<s)+t}function en(s,e){const t=s[0],i=s[1],n=s[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;const r=e.getFullTileRange(t);return r?r.containsXY(i,n):!0}function Ne(s,e,t,i,n){return`${K(s)},${e},${Qi(t,i,n)}`}function ke(s,e,t){if(!(t in s))return s[t]=new Set([e]),!0;const i=s[t],n=i.has(e);return n||i.add(e),!n}function tn(s,e,t){const i=s[t];return i?i.delete(e):!1}function wt(s,e){const t=s.layerStatesArray[s.layerIndex];t.extent&&(e=he(e,qe(t.extent,s.viewState.projection)));const i=t.layer.getRenderSource();if(!i.getWrapX()){const n=i.getTileGridForProjection(s.viewState.projection).getExtent();n&&(e=he(e,n))}return e}class nn extends oi{constructor(e,t){super(e),t=t||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=$e(),this.tempTileRange_=new Mt(0,0,0,0),this.tempTileCoord_=Se(0,0,0);const i=t.cacheSize!==void 0?t.cacheSize:512;this.tileCache_=new Hi(i),this.maxStaleKeys=i*.5}getTileCache(){return this.tileCache_}getOrCreateTile(e,t,i,n){const r=this.tileCache_,u=this.getLayer().getSource(),l=Ne(u,u.getKey(),e,t,i);let a;if(r.containsKey(l))a=r.get(l);else{if(a=u.getTile(e,t,i,n.pixelRatio,n.viewState.projection),!a)return null;r.set(l,a)}return a}getTile(e,t,i,n){const r=this.getOrCreateTile(e,t,i,n);return r||null}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),n=Ke(t.pixelToCoordinateTransform,e.slice()),r=i.getExtent();if(r&&!tt(r,n))return null;const o=t.viewState,u=i.getRenderSource(),l=u.getTileGridForProjection(o.projection),a=u.getTilePixelRatio(t.pixelRatio);for(let c=l.getZForResolution(o.resolution);c>=l.getMinZoom();--c){const h=l.getTileCoordForCoordAndZ(n,c),f=this.getTile(c,h[1],h[2],t);if(!f||f.getState()!==P.LOADED)continue;const m=l.getOrigin(c),g=se(l.getTileSize(c)),_=l.getResolution(c);let y;if(f instanceof Lt||f instanceof Xt)y=f.getImage();else if(f instanceof mt){if(y=Qe(f.getData()),!y)continue}else continue;const A=Math.floor(a*((n[0]-m[0])/_-h[1]*g[0])),b=Math.floor(a*((m[1]-n[1])/_-h[2]*g[1])),T=Math.round(a*u.getGutterForProjection(o.projection));return this.getImageData(y,A+T,b+T)}return null}prepareFrame(e){this.renderedProjection?e.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=e.viewState.projection):this.renderedProjection=e.viewState.projection;const t=this.getLayer().getSource();if(!t)return!1;const i=t.getRevision();return this.renderedSourceRevision_?this.renderedSourceRevision_!==i&&(this.renderedSourceRevision_=i,this.renderedSourceKey_===t.getKey()&&this.tileCache_.clear()):this.renderedSourceRevision_=i,!0}enqueueTiles(e,t,i,n,r){const o=e.viewState,u=this.getLayer(),l=u.getRenderSource(),a=l.getTileGridForProjection(o.projection),c=K(l);c in e.wantedTiles||(e.wantedTiles[c]={});const h=e.wantedTiles[c],f=u.getMapInternal(),m=Math.max(i-r,a.getMinZoom(),a.getZForResolution(Math.min(u.getMaxResolution(),f?f.getView().getResolutionForZoom(Math.max(u.getMinZoom(),0)):a.getResolution(0)),l.zDirection)),g=o.rotation,_=g?ai(o.center,o.resolution,g,e.size):void 0;for(let y=i;y>=m;--y){const A=a.getTileRangeForExtentAndZ(t,y,this.tempTileRange_),b=a.getResolution(y);for(let T=A.minX;T<=A.maxX;++T)for(let v=A.minY;v<=A.maxY;++v){if(g&&!a.tileCoordIntersectsViewport([y,T,v],_))continue;const x=this.getTile(y,T,v,e);if(!x||!ke(n,x,y))continue;const R=x.getKey();if(h[R]=!0,x.getState()===P.IDLE&&!e.tileQueue.isKeyQueued(R)){const d=Se(y,T,v,this.tempTileCoord_);e.tileQueue.enqueue([x,c,a.getTileCoordCenter(d),b])}}}}findStaleTile_(e,t){const i=this.tileCache_,n=e[0],r=e[1],o=e[2],u=this.getStaleKeys();for(let l=0;l<u.length;++l){const a=Ne(this.getLayer().getSource(),u[l],n,r,o);if(i.containsKey(a)){const c=i.peek(a);if(c.getState()===P.LOADED)return c.endTransition(K(this)),ke(t,c,n),!0}}return!1}findAltTiles_(e,t,i,n){const r=e.getTileRangeForTileCoordAndZ(t,i,this.tempTileRange_);if(!r)return!1;let o=!0;const u=this.tileCache_,l=this.getLayer().getRenderSource(),a=l.getKey();for(let c=r.minX;c<=r.maxX;++c)for(let h=r.minY;h<=r.maxY;++h){const f=Ne(l,a,i,c,h);let m=!1;if(u.containsKey(f)){const g=u.peek(f);g.getState()===P.LOADED&&(ke(n,g,i),m=!0)}m||(o=!1)}return o}renderFrame(e,t){this.renderComplete=!0;const i=e.layerStatesArray[e.layerIndex],n=e.viewState,r=n.projection,o=n.resolution,u=n.center,l=e.pixelRatio,a=this.getLayer(),c=a.getSource(),h=c.getTileGridForProjection(r),f=h.getZForResolution(o,c.zDirection),m=h.getResolution(f),g=c.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==g&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=g):this.renderedSourceKey_=g;let _=e.extent;const y=c.getTilePixelRatio(l);this.prepareContainer(e,t);const A=this.context.canvas.width,b=this.context.canvas.height,T=i.extent&&qe(i.extent);T&&(_=he(_,qe(i.extent)));const v=m*A/2/y,x=m*b/2/y,G=[u[0]-v,u[1]-x,u[0]+v,u[1]+x],R={};this.renderedTiles.length=0;const d=a.getPreload();if(e.nextExtent){const I=h.getZForResolution(n.nextResolution,c.zDirection),z=wt(e,e.nextExtent);this.enqueueTiles(e,z,I,R,d)}const w=wt(e,_);if(this.enqueueTiles(e,w,f,R,0),d>0&&setTimeout(()=>{this.enqueueTiles(e,w,f-1,R,d-1)},0),!(f in R))return this.container;const p=K(this),E=e.time;for(const I of R[f]){const z=I.getState();if(z===P.EMPTY)continue;const Z=I.tileCoord;if(z===P.LOADED&&I.getAlpha(p,E)===1){I.endTransition(p);continue}if(z!==P.ERROR&&(this.renderComplete=!1),this.findStaleTile_(Z,R)){tn(R,I,f),e.animate=!0;continue}if(this.findAltTiles_(h,Z,f+1,R))continue;const Y=h.getMinZoom();for(let J=f-1;J>=Y&&!this.findAltTiles_(h,Z,J,R);--J);}const F=m/o*l/y,C=this.getRenderContext(e);li(this.tempTransform,A/2,b/2,F,F,0,-A/2,-b/2),i.extent&&this.clipUnrotated(C,e,T),c.getInterpolate()||(C.imageSmoothingEnabled=!1),this.preRender(C,e);const S=Object.keys(R).map(Number);S.sort(ci);let L;const M=[],N=[];for(let I=S.length-1;I>=0;--I){const z=S[I],Z=c.getTilePixelSize(z,l,r),B=h.getResolution(z)/m,Y=Z[0]*B*F,J=Z[1]*B*F,q=h.getTileCoordForCoordAndZ(Me(G),z),$=h.getTileCoordExtent(q),X=Ke(this.tempTransform,[y*($[0]-G[0])/m,y*(G[3]-$[3])/m]),ae=y*c.getGutterForProjection(r);for(const ee of R[z]){if(ee.getState()!==P.LOADED)continue;const H=ee.tileCoord,lt=q[1]-H[1],Bt=Math.round(X[0]-(lt-1)*Y),ct=q[2]-H[2],Yt=Math.round(X[1]-(ct-1)*J),te=Math.round(X[0]-lt*Y),ie=Math.round(X[1]-ct*J),xe=Bt-te,we=Yt-ie,ut=S.length===1;let Ge=!1;L=[te,ie,te+xe,ie,te+xe,ie+we,te,ie+we];for(let _e=0,qt=M.length;_e<qt;++_e)if(!ut&&z<N[_e]){const V=M[_e];Pt([te,ie,te+xe,ie+we],[V[0],V[3],V[4],V[7]])&&(Ge||(C.save(),Ge=!0),C.beginPath(),C.moveTo(L[0],L[1]),C.lineTo(L[2],L[3]),C.lineTo(L[4],L[5]),C.lineTo(L[6],L[7]),C.moveTo(V[6],V[7]),C.lineTo(V[4],V[5]),C.lineTo(V[2],V[3]),C.lineTo(V[0],V[1]),C.clip())}M.push(L),N.push(z),this.drawTile(ee,e,te,ie,xe,we,ae,ut),Ge&&C.restore(),this.renderedTiles.unshift(ee),this.updateUsedTiles(e.usedTiles,c,ee)}}if(this.renderedResolution=m,this.extentChanged=!this.renderedExtent_||!ui(this.renderedExtent_,G),this.renderedExtent_=G,this.renderedPixelRatio=l,this.postRender(this.context,e),i.extent&&C.restore(),C.imageSmoothingEnabled=!0,this.renderComplete){const I=(z,Z)=>{const oe=K(c),B=Z.wantedTiles[oe],Y=B?Object.keys(B).length:0;this.updateCacheSize(Y),this.tileCache_.expireCache()};e.postRenderFunctions.push(I)}return this.container}updateCacheSize(e){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,e*2)}drawTile(e,t,i,n,r,o,u,l){let a;if(e instanceof mt){if(a=Qe(e.getData()),!a)throw new Error("Rendering array data is not yet supported")}else a=this.getTileImage(e);if(!a)return;const c=this.getRenderContext(t),h=K(this),f=t.layerStatesArray[t.layerIndex],m=f.opacity*(l?e.getAlpha(h,t.time):1),g=m!==c.globalAlpha;g&&(c.save(),c.globalAlpha=m),c.drawImage(a,u,u,a.width-2*u,a.height-2*u,i,n,r,o),g&&c.restore(),m!==f.opacity?t.animate=!0:l&&e.endTransition(h)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}updateUsedTiles(e,t,i){const n=K(t);n in e||(e[n]={}),e[n][i.getKey()]=!0}}const Ae={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class rn extends Rt{constructor(e){e=e||{};const t=Object.assign({},e),i=e.cacheSize;delete e.cacheSize,delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=i,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(Ae.PRELOAD)}setPreload(e){this.set(Ae.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(Ae.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(Ae.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}class _t extends rn{constructor(e){super(e)}createRenderer(){return new nn(this,{cacheSize:this.getCacheSize()})}}const ce=[0,0,0],ne=5;class Ut{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,re(hi(this.resolutions_,(n,r)=>r-n),"`resolutions` must be sorted in descending order");let t;if(!e.origins){for(let n=0,r=this.resolutions_.length-1;n<r;++n)if(!t)t=this.resolutions_[n]/this.resolutions_[n+1];else if(this.resolutions_[n]/this.resolutions_[n+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,re(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=e.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=Me(i)),re(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,re(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:Ot,re(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map((n,r)=>{const o=new Mt(Math.min(0,n[0]),Math.max(n[0]-1,-1),Math.min(0,n[1]),Math.max(n[1]-1,-1));if(i){const u=this.getTileRangeForExtentAndZ(i,r);o.minX=Math.max(u.minX,o.minX),o.maxX=Math.min(u.maxX,o.maxX),o.minY=Math.max(u.minY,o.minY),o.maxY=Math.min(u.maxY,o.maxY)}return o}):i&&this.calculateTileRanges_(i)}forEachTileCoord(e,t,i){const n=this.getTileRangeForExtentAndZ(e,t);for(let r=n.minX,o=n.maxX;r<=o;++r)for(let u=n.minY,l=n.maxY;u<=l;++u)i([t,r,u])}forEachTileCoordParentTileRange(e,t,i,n){let r,o,u,l=null,a=e[0]-1;for(this.zoomFactor_===2?(o=e[1],u=e[2]):l=this.getTileCoordExtent(e,n);a>=this.minZoom;){if(o!==void 0&&u!==void 0?(o=Math.floor(o/2),u=Math.floor(u/2),r=le(o,o,u,u,i)):r=this.getTileRangeForExtentAndZ(l,a,i),t(a,r))return!0;--a}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,i){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const r=e[1]*2,o=e[2]*2;return le(r,r+1,o,o+1,t)}const n=this.getTileCoordExtent(e,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,i){if(t>this.maxZoom||t<this.minZoom)return null;const n=e[0],r=e[1],o=e[2];if(t===n)return le(r,o,r,o,i);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,t-n),a=Math.floor(r*l),c=Math.floor(o*l);if(t<n)return le(a,a,c,c,i);const h=Math.floor(l*(r+1))-1,f=Math.floor(l*(o+1))-1;return le(a,h,c,f,i)}const u=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(u,t,i)}getTileRangeForExtentAndZ(e,t,i){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,ce);const n=ce[1],r=ce[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,ce);const o=ce[1],u=ce[2];return le(n,o,r,u,i)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),i=this.getResolution(e[0]),n=se(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*n[0]*i,t[1]-(e[2]+.5)*n[1]*i]}getTileCoordExtent(e,t){const i=this.getOrigin(e[0]),n=this.getResolution(e[0]),r=se(this.getTileSize(e[0]),this.tmpSize_),o=i[0]+e[1]*r[0]*n,u=i[1]-(e[2]+1)*r[1]*n,l=o+r[0]*n,a=u+r[1]*n;return Gt(o,u,l,a,t)}getTileCoordForCoordAndResolution(e,t,i){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,i)}getTileCoordForXYAndResolution_(e,t,i,n,r){const o=this.getZForResolution(i),u=i/this.getResolution(o),l=this.getOrigin(o),a=se(this.getTileSize(o),this.tmpSize_);let c=u*(e-l[0])/i/a[0],h=u*(l[1]-t)/i/a[1];return n?(c=Te(c,ne)-1,h=Te(h,ne)-1):(c=Ee(c,ne),h=Ee(h,ne)),Se(o,c,h,r)}getTileCoordForXYAndZ_(e,t,i,n,r){const o=this.getOrigin(i),u=this.getResolution(i),l=se(this.getTileSize(i),this.tmpSize_);let a=(e-o[0])/u/l[0],c=(o[1]-t)/u/l[1];return n?(a=Te(a,ne)-1,c=Te(c,ne)-1):(a=Ee(a,ne),c=Ee(c,ne)),Se(i,a,c,r)}getTileCoordForCoordAndZ(e,t,i){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,i)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const i=di(this.resolutions_,e,t||0);return Ye(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return gi(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,i=new Array(t);for(let n=this.minZoom;n<t;++n)i[n]=this.getTileRangeForExtentAndZ(e,n);this.fullTileRanges_=i}}function Zt(s){let e=s.getDefaultTileGrid();return e||(e=ln(s),s.setDefaultTileGrid(e)),e}function sn(s,e,t){const i=e[0],n=s.getTileCoordCenter(e),r=nt(t);if(!tt(r,n)){const o=U(r),u=Math.ceil((r[0]-n[0])/o);return n[0]+=o*u,s.getTileCoordForCoordAndZ(n,i)}return e}function on(s,e,t,i){i=i!==void 0?i:"top-left";const n=Vt(s,e,t);return new Ut({extent:s,origin:mi(s,i),resolutions:n,tileSize:t})}function an(s){const e=s||{},t=e.extent||W("EPSG:3857").getExtent(),i={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:Vt(t,e.maxZoom,e.tileSize,e.maxResolution)};return new Ut(i)}function Vt(s,e,t,i){e=e!==void 0?e:pi,t=se(t!==void 0?t:Ot);const n=me(s),r=U(s);i=i>0?i:Math.max(r/t[0],n/t[1]);const o=e+1,u=new Array(o);for(let l=0;l<o;++l)u[l]=i/Math.pow(2,l);return u}function ln(s,e,t,i){const n=nt(s);return on(n,e,t,i)}function nt(s){s=W(s);let e=s.getExtent();if(!e){const t=180*fi.degrees/s.getMetersPerUnit();e=Gt(-t,-t,t,t)}return e}const cn=/\{z\}/g,un=/\{x\}/g,hn=/\{y\}/g,dn=/\{-y\}/g;function gn(s,e,t,i,n){return s.replace(cn,e.toString()).replace(un,t.toString()).replace(hn,i.toString()).replace(dn,function(){if(n===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(n-i).toString()})}function fn(s){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(s);if(t){const i=t[1].charCodeAt(0),n=t[2].charCodeAt(0);let r;for(r=i;r<=n;++r)e.push(s.replace(t[0],String.fromCharCode(r)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(s),t){const i=parseInt(t[2],10);for(let n=parseInt(t[1],10);n<=i;n++)e.push(s.replace(t[0],n.toString()));return e}return e.push(s),e}function mn(s,e){return function(t,i,n){if(!t)return;let r;const o=t[0];if(e){const u=e.getFullTileRange(o);u&&(r=u.getHeight()-1)}return gn(s,o,t[1],t[2],r)}}function pn(s,e){const t=s.length,i=new Array(t);for(let n=0;n<t;++n)i[n]=mn(s[n],e);return yn(i)}function yn(s){return s.length===1?s[0]:function(e,t,i){if(!e)return;const n=Ji(e),r=Fe(n,s.length);return s[r](e,t,i)}}class xn extends yi{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&se(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tmpSize=[0,0],this.key_=e.key||K(this),this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,i,n,r){return k()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:Zt(e)}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,i){const n=this.getTileGridForProjection(i),r=this.getTilePixelRatio(t),o=se(n.getTileSize(e),this.tmpSize);return r==1?o:xi(o,r,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){const i=t!==void 0?t:this.getProjection(),n=t!==void 0?this.getTileGridForProjection(i):this.tileGrid||this.getTileGridForProjection(i);return this.getWrapX()&&i.isGlobal()&&(e=sn(n,e,i)),en(e,n)?e:null}clear(){}refresh(){this.clear(),super.refresh()}}class wn extends wi{constructor(e,t){super(e),this.tile=t}}const Xe={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class rt extends xn{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===rt.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,i=K(t),n=t.getState();let r;n==P.LOADING?(this.tileLoadingKeys_[i]=!0,r=Xe.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],r=n==P.ERROR?Xe.TILELOADERROR:n==P.LOADED?Xe.TILELOADEND:void 0),r!=null&&this.dispatchEvent(new wn(r,t))}setTileLoadFunction(e){this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=fn(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(pn(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,i){}}class _n extends rt{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:Tn,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:Lt,this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(e){return this.getProjection()&&e&&!Ce(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||Ce(t,e)))return this.tileGrid;const i=K(e);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=Zt(e)),this.tileGridForProjection[i]}createTile_(e,t,i,n,r,o){const u=[e,t,i],l=this.getTileCoordForTileUrlFunction(u,r),a=l?this.tileUrlFunction(l,n,r):void 0,c=new this.tileClass(u,a!==void 0?P.IDLE:P.EMPTY,a!==void 0?a:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener(St.CHANGE,this.handleTileChange.bind(this)),c}getTile(e,t,i,n,r){const o=this.getProjection();if(!o||!r||Ce(o,r))return this.getTileInternal(e,t,i,n,o||r);const u=[e,t,i],l=this.getKey(),a=this.getTileGridForProjection(o),c=this.getTileGridForProjection(r),h=this.getTileCoordForTileUrlFunction(u,r),f=new Xt(o,a,r,c,u,h,this.getTilePixelRatio(n),this.getGutter(),(m,g,_,y)=>this.getTileInternal(m,g,_,y,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return f.key=l,f}getTileInternal(e,t,i,n,r){const o=this.getKey();return this.createTile_(e,t,i,n,r,o)}setRenderReprojectionEdges(e){this.renderReprojectionEdges_!=e&&(this.renderReprojectionEdges_=e,this.changed())}setTileGridForProjection(e,t){const i=W(e);if(i){const n=K(i);n in this.tileGridForProjection||(this.tileGridForProjection[n]=t)}}}function Tn(s,e){s.getImage().src=e}class Wt extends _n{constructor(e){e=e||{};const t=e.projection!==void 0?e.projection:"EPSG:3857",i=e.tileGrid!==void 0?e.tileGrid:an({extent:nt(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}}const En='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class An extends Wt{constructor(e){e=e||{};let t;e.attributions!==void 0?t=e.attributions:t=[En];const i=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",n=e.url!==void 0?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:t,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:i,interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:19,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:n,wrapX:e.wrapX,zDirection:e.zDirection})}}const Ue="projection",Tt="coordinateFormat";class vn extends jt{constructor(e){e=e||{};const t=document.createElement("div");t.className=e.className!==void 0?e.className:"ol-mouse-position",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un,this.addChangeListener(Ue,this.handleProjectionChanged_),e.coordinateFormat&&this.setCoordinateFormat(e.coordinateFormat),e.projection&&this.setProjection(e.projection),this.renderOnMouseOut_=e.placeholder!==void 0,this.placeholder_=this.renderOnMouseOut_?e.placeholder:"&#160;",this.renderedHTML_=t.innerHTML,this.mapProjection_=null,this.transform_=null,this.wrapX_=e.wrapX!==!1}handleProjectionChanged_(){this.transform_=null}getCoordinateFormat(){return this.get(Tt)}getProjection(){return this.get(Ue)}handleMouseMove(e){const t=this.getMap();this.updateHTML_(t.getEventPixel(e))}handleMouseOut(e){this.updateHTML_(null)}setMap(e){if(super.setMap(e),e){const t=e.getViewport();this.listenerKeys.push(Be(t,ft.POINTERMOVE,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push(Be(t,ft.POINTEROUT,this.handleMouseOut,this)),this.updateHTML_(null)}}setCoordinateFormat(e){this.set(Tt,e)}setProjection(e){this.set(Ue,W(e))}updateHTML_(e){let t=this.placeholder_;if(e&&this.mapProjection_){if(!this.transform_){const r=this.getProjection();r?this.transform_=_i(this.mapProjection_,r):this.transform_=Ti}const n=this.getMap().getCoordinateFromPixelInternal(e);if(n){if(this.transform_(n,n),this.wrapX_){const o=this.getProjection()||this.mapProjection_;Ei(n,o)}const r=this.getCoordinateFormat();r?t=r(n):t=n.toString()}}(!this.renderedHTML_||t!==this.renderedHTML_)&&(this.element.innerHTML=t,this.renderedHTML_=t)}render(e){const t=e.frameState;t?this.mapProjection_!=t.viewState.projection&&(this.mapProjection_=t.viewState.projection,this.transform_=null):this.mapProjection_=null}}var be={exports:{}};const Fn=it(Ai),Cn=it(vi),bn=it(Fi);var Pn=be.exports,Et;function Sn(){return Et||(Et=1,function(s,e){(function(t,i){s.exports=i(Fn,Cn,bn)})(Pn,function(t,i,n){t="default"in t?t.default:t,n="default"in n?n.default:n;const r="layer-switcher-";class o extends t{constructor(l){const a=Object.assign({},l),c=document.createElement("div");super({element:c,target:a.target}),this.activationMode=a.activationMode||"mouseover",this.startActive=a.startActive===!0,this.label=a.label!==void 0?a.label:"",this.collapseLabel=a.collapseLabel!==void 0?a.collapseLabel:"»",this.tipLabel=a.tipLabel?a.tipLabel:"Legend",this.collapseTipLabel=a.collapseTipLabel?a.collapseTipLabel:"Collapse legend",this.groupSelectStyle=o.getGroupSelectStyle(a.groupSelectStyle),this.reverse=a.reverse!==!1,this.mapListeners=[],this.hiddenClassName="ol-unselectable ol-control layer-switcher",o.isTouchDevice_()&&(this.hiddenClassName+=" touch"),this.shownClassName="shown",c.className=this.hiddenClassName,this.button=document.createElement("button"),c.appendChild(this.button),this.panel=document.createElement("div"),this.panel.className="panel",c.appendChild(this.panel),o.enableTouchScroll_(this.panel),c.classList.add(r+"group-select-style-"+this.groupSelectStyle),c.classList.add(r+"activation-mode-"+this.activationMode),this.activationMode==="click"?(c.classList.add("activationModeClick"),this.button.onclick=h=>{const f=h||window.event;this.element.classList.contains(this.shownClassName)?this.hidePanel():this.showPanel(),f.preventDefault()}):(this.button.onmouseover=()=>{this.showPanel()},this.button.onclick=h=>{const f=h||window.event;this.showPanel(),f.preventDefault()},this.panel.onmouseout=h=>{this.panel.contains(h.relatedTarget)||this.hidePanel()}),this.updateButton()}setMap(l){for(let a=0;a<this.mapListeners.length;a++)i.unByKey(this.mapListeners[a]);this.mapListeners.length=0,super.setMap(l),l&&(this.startActive?this.showPanel():this.renderPanel(),this.activationMode!=="click"&&this.mapListeners.push(l.on("pointerdown",()=>{this.hidePanel()})))}showPanel(){this.element.classList.contains(this.shownClassName)||(this.element.classList.add(this.shownClassName),this.updateButton(),this.renderPanel()),this.dispatchEvent("show")}hidePanel(){this.element.classList.contains(this.shownClassName)&&(this.element.classList.remove(this.shownClassName),this.updateButton()),this.dispatchEvent("hide")}updateButton(){this.element.classList.contains(this.shownClassName)?(this.button.textContent=this.collapseLabel,this.button.setAttribute("title",this.collapseTipLabel),this.button.setAttribute("aria-label",this.collapseTipLabel)):(this.button.textContent=this.label,this.button.setAttribute("title",this.tipLabel),this.button.setAttribute("aria-label",this.tipLabel))}renderPanel(){this.dispatchEvent("render"),o.renderPanel(this.getMap(),this.panel,{groupSelectStyle:this.groupSelectStyle,reverse:this.reverse}),this.dispatchEvent("rendercomplete")}static renderPanel(l,a,c){const h=new Event("render");for(a.dispatchEvent(h),c=c||{},c.groupSelectStyle=o.getGroupSelectStyle(c.groupSelectStyle),o.ensureTopVisibleBaseLayerShown(l,c.groupSelectStyle);a.firstChild;)a.removeChild(a.firstChild);o.forEachRecursive(l,function(g,_,y){g.set("indeterminate",!1)}),c.groupSelectStyle==="children"||c.groupSelectStyle==="none"?o.setGroupVisibility(l):c.groupSelectStyle==="group"&&o.setChildVisibility(l);const f=document.createElement("ul");a.appendChild(f),o.renderLayers_(l,l,f,c,function(_){o.renderPanel(l,a,c)});const m=new Event("rendercomplete");a.dispatchEvent(m)}static isBaseGroup(l){if(l instanceof n){const a=l.getLayers().getArray();return a.length&&a[0].get("type")==="base"}else return!1}static setGroupVisibility(l){o.getGroupsAndLayers(l,function(c){return c instanceof n&&!c.get("combine")&&!o.isBaseGroup(c)}).reverse().forEach(function(c){const h=c.getLayersArray().map(function(f){return f.getVisible()});h.every(function(f){return f===!0})?(c.setVisible(!0),c.set("indeterminate",!1)):h.every(function(f){return f===!1})?(c.setVisible(!1),c.set("indeterminate",!1)):(c.setVisible(!0),c.set("indeterminate",!0))})}static setChildVisibility(l){o.getGroupsAndLayers(l,function(c){return c instanceof n&&!c.get("combine")&&!o.isBaseGroup(c)}).forEach(function(c){const h=c,f=h.getVisible(),m=h.get("indeterminate");h.getLayers().getArray().forEach(function(g){g.set("indeterminate",!1),(!f||m)&&g.getVisible()&&g.set("indeterminate",!0)})})}static ensureTopVisibleBaseLayerShown(l,a){let c;o.forEachRecursive(l,function(h,f,m){h.get("type")==="base"&&h.getVisible()&&(c=h)}),c&&o.setVisible_(l,c,!0,a)}static getGroupsAndLayers(l,a){const c=[];return a=a||function(h,f,m){return!0},o.forEachRecursive(l,function(h,f,m){h.get("title")&&a(h,f,m)&&c.push(h)}),c}static setVisible_(l,a,c,h){a.setVisible(c),c&&a.get("type")==="base"&&o.forEachRecursive(l,function(f,m,g){f!=a&&f.get("type")==="base"&&f.setVisible(!1)}),a instanceof n&&!a.get("combine")&&h==="children"&&a.getLayers().forEach(f=>{o.setVisible_(l,f,a.getVisible(),h)})}static renderLayer_(l,a,c,h,f){const m=document.createElement("li"),g=a.get("title"),_=o.uuid(),y=document.createElement("label");if(a instanceof n&&!a.get("combine")){const A=o.isBaseGroup(a);if(m.classList.add("group"),A&&m.classList.add(r+"base-group"),a.get("fold")){m.classList.add(r+"fold"),m.classList.add(r+a.get("fold"));const T=document.createElement("button");T.onclick=function(v){const x=v||window.event;o.toggleFold_(a,m),x.preventDefault()},m.appendChild(T)}if(!A&&h.groupSelectStyle!="none"){const T=document.createElement("input");T.type="checkbox",T.id=_,T.checked=a.getVisible(),T.indeterminate=a.get("indeterminate"),T.onchange=function(v){const x=v.target;o.setVisible_(l,a,x.checked,h.groupSelectStyle),f(a)},m.appendChild(T),y.htmlFor=_}y.innerHTML=g,m.appendChild(y);const b=document.createElement("ul");m.appendChild(b),o.renderLayers_(l,a,b,h,f)}else{m.className="layer";const A=document.createElement("input");a.get("type")==="base"?A.type="radio":A.type="checkbox",A.id=_,A.checked=a.get("visible"),A.indeterminate=a.get("indeterminate"),A.onchange=function(T){const v=T.target;o.setVisible_(l,a,v.checked,h.groupSelectStyle),f(a)},m.appendChild(A),y.htmlFor=_,y.innerHTML=g;const b=l.getView().getResolution();if(b>=a.getMaxResolution()||b<a.getMinResolution())y.className+=" disabled";else if(a.getMinZoom&&a.getMaxZoom){const T=l.getView().getZoom();(T<=a.getMinZoom()||T>a.getMaxZoom())&&(y.className+=" disabled")}m.appendChild(y)}return m}static renderLayers_(l,a,c,h,f){let m=a.getLayers().getArray().slice();h.reverse&&(m=m.reverse());for(let g=0,_;g<m.length;g++)_=m[g],_.get("title")&&c.appendChild(o.renderLayer_(l,_,g,h,f))}static forEachRecursive(l,a){l.getLayers().forEach(function(c,h,f){a(c,h,f),c instanceof n&&o.forEachRecursive(c,a)})}static uuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(l){const a=Math.random()*16|0;return(l=="x"?a:a&3|8).toString(16)})}static enableTouchScroll_(l){if(o.isTouchDevice_()){let a=0;l.addEventListener("touchstart",function(c){a=this.scrollTop+c.touches[0].pageY},!1),l.addEventListener("touchmove",function(c){this.scrollTop=a-c.touches[0].pageY},!1)}}static isTouchDevice_(){try{return document.createEvent("TouchEvent"),!0}catch{return!1}}static toggleFold_(l,a){a.classList.remove(r+l.get("fold")),l.set("fold",l.get("fold")==="open"?"close":"open"),a.classList.add(r+l.get("fold"))}static getGroupSelectStyle(l){return["none","children","group"].indexOf(l)>=0?l:"children"}}return window.ol&&window.ol.control&&(window.ol.control.LayerSwitcher=o),o})}(be)),be.exports}var Mn=Sn();const Ln=kt(Mn);class Rn extends jt{constructor(e){super(e),this.map=e.map,this.element=document.createElement("div"),this.element.className="custom-zoom-level-control"}render(){const t=this.map.getView().getZoom();this.element.innerHTML=`Zoom: ${t.toFixed(1)}`}onAdd(){return this.render(),this.map.getView().on("change:resolution",this.render,this),this.element}onRemove(){this.map.getView().un("change:resolution",this.render,this)}}var Ze={},At;function On(){if(At)return Ze;At=1;var s=function(){},e="+",t=8,i="0",n="23456789CFGHJMPQRVWX",r=n.length,o=90,u=180,l=10,a=[20,1,.05,.0025,125e-6],c=4,h=5,f=125e-6,m=6;s.prototype.isValid=function(d){if(!d||d.indexOf(e)==-1||d.indexOf(e)!=d.lastIndexOf(e)||d.length==1||d.indexOf(e)>t||d.indexOf(e)%2==1)return!1;if(d.indexOf(i)>-1){if(d.indexOf(i)==0)return!1;var w=d.match(new RegExp("("+i+"+)","g"));if(w.length>1||w[0].length%2==1||w[0].length>t-2||d.charAt(d.length-1)!=e)return!1}if(d.length-d.indexOf(e)-1==1)return!1;d=d.replace(new RegExp("\\"+e+"+"),"").replace(new RegExp(i+"+"),"");for(var p=0,E=d.length;p<E;p++){var F=d.charAt(p).toUpperCase();if(F!=e&&n.indexOf(F)==-1)return!1}return!0},s.prototype.isShort=function(d){return this.isValid(d)?d.indexOf(e)>=0&&d.indexOf(e)<t:!1},s.prototype.isFull=function(d){if(!this.isValid(d)||this.isShort(d))return!1;var w=n.indexOf(d.charAt(0).toUpperCase())*r;if(w>=o*2)return!1;if(d.length>1){var p=n.indexOf(d.charAt(1).toUpperCase())*r;if(p>=u*2)return!1}return!0},s.prototype.encode=function(d,w,p){if(typeof p>"u"&&(p=l),p<2||p<t&&p%2==1)throw"IllegalArgumentException: Invalid Open Location Code length";d=g(d),w=y(w),d==90&&(d=d-_(p));var E=A(d,w,Math.min(p,l));return p>l&&(E+=b(d,w,p-l)),E},s.prototype.decode=function(d){if(!this.isFull(d))throw"IllegalArgumentException: Passed Open Location Code is not a valid full code: "+d;d=d.replace(e,""),d=d.replace(new RegExp(i+"+"),""),d=d.toUpperCase();var w=T(d.substring(0,l));if(d.length<=l)return w;var p=x(d.substring(l));return G(w.latitudeLo+p.latitudeLo,w.longitudeLo+p.longitudeLo,w.latitudeLo+p.latitudeHi,w.longitudeLo+p.longitudeHi,w.codeLength+p.codeLength)},s.prototype.recoverNearest=function(d,w,p){if(!this.isShort(d)){if(this.isFull(d))return d;throw"ValueError: Passed short code is not valid: "+d}w=g(w),p=y(p),d=d.toUpperCase();var E=t-d.indexOf(e),F=Math.pow(20,2-E/2),C=F/2,S=Math.floor(w/F)*F,L=Math.floor(p/F)*F,M=this.decode(this.encode(S,L).substr(0,E)+d),N=M.latitudeCenter-w;return N>C?M.latitudeCenter-=F:N<-C&&(M.latitudeCenter+=F),N=M.longitudeCenter-p,N>C?M.longitudeCenter-=F:N<-C&&(M.longitudeCenter+=F),this.encode(M.latitudeCenter,M.longitudeCenter,M.codeLength)},s.prototype.shorten=function(E,w,p){if(!this.isFull(E))throw"ValueError: Passed code is not valid and full: "+E;if(E.indexOf(i)!=-1)throw"ValueError: Cannot shorten padded codes: "+E;var E=E.toUpperCase(),F=this.decode(E);if(F.codeLength<m)throw"ValueError: Code length must be at least "+m;w=g(w),p=y(p);for(var C=Math.max(Math.abs(F.latitudeCenter-w),Math.abs(F.longitudeCenter-p)),S=a.length-2;S>=1;S--)if(C<a[S]*.3)return E.substring((S+1)*2);return E};var g=function(d){return Math.min(90,Math.max(-90,d))},_=function(d){return d<=10?Math.pow(20,Math.floor(d/-2+2)):Math.pow(20,-3)/Math.pow(h,d-10)},y=function(d){for(;d<-180;)d=d+360;for(;d>=180;)d=d-360;return d},A=function(d,w,p){for(var E="",F=d+o,C=w+u,S=0;S<p;){var L=a[Math.floor(S/2)],M=Math.floor(F/L);F-=M*L,E+=n.charAt(M),S+=1,M=Math.floor(C/L),C-=M*L,E+=n.charAt(M),S+=1,S==t&&S<p&&(E+=e)}return E.length<t&&(E=E+Array(t-E.length+1).join(i)),E.length==t&&(E=E+e),E},b=function(d,w,p){for(var E="",F=f,C=f,S=(d+o)%F,L=(w+u)%C,M=0;M<p;M++){var N=Math.floor(S/(F/h)),I=Math.floor(L/(C/c));F/=h,C/=c,S-=N*F,L-=I*C,E+=n.charAt(N*c+I)}return E},T=function(d){var w=v(d,0),p=v(d,1);return new G(w[0]-o,p[0]-u,w[1]-o,p[1]-u,d.length)},v=function(d,w){for(var p=0,E=0;p*2+w<d.length;)E+=n.indexOf(d.charAt(p*2+w))*a[p],p+=1;return[E,E+a[p-1]]},x=function(d){for(var w=0,p=0,E=f,F=f,C=0;C<d.length;){var S=n.indexOf(d.charAt(C)),L=Math.floor(S/c),M=S%c;E/=h,F/=c,w+=L*E,p+=M*F,C+=1}return G(w,p,w+E,p+F,d.length)},G=s.prototype.CodeArea=function(d,w,p,E,F){return new R.init(d,w,p,E,F)},R={init:function(d,w,p,E,F){this.latitudeLo=d,this.longitudeLo=w,this.latitudeHi=p,this.longitudeHi=E,this.codeLength=F,this.latitudeCenter=Math.min(d+(p-d)/2,o),this.longitudeCenter=Math.min(w+(E-w)/2,u)}};return Ze.OpenLocationCode=s,Ze}On();class Gn{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=ye,this.supportedMediaTypes=null}getReadOptions(e,t){if(t){let i=t.dataProjection?W(t.dataProjection):this.readProjection(e);t.extent&&i&&i.getUnits()==="tile-pixels"&&(i=W(i),i.setWorldExtent(t.extent)),t={dataProjection:i,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},e)}getType(){return k()}readFeature(e,t){return k()}readFeatures(e,t){return k()}readGeometry(e,t){return k()}readProjection(e){return k()}writeFeature(e,t){return k()}writeFeatures(e,t){return k()}writeGeometry(e,t){return k()}}function st(s,e,t){const i=t?W(t.featureProjection):null,n=t?W(t.dataProjection):null;let r=s;if(i&&n&&!Ce(i,n)){e&&(r=s.clone());const o=e?i:n,u=e?n:i;o.getUnits()==="tile-pixels"?r.transform(o,u):r.applyTransform(bt(o,u))}if(e&&t&&t.decimals!==void 0){const o=Math.pow(10,t.decimals),u=function(l){for(let a=0,c=l.length;a<c;++a)l[a]=Math.round(l[a]*o)/o;return l};r===s&&(r=s.clone()),r.applyTransform(u)}return r}const jn={Point:Le,LineString:zt,Polygon:Mi,MultiPoint:Si,MultiLineString:Pi,MultiPolygon:bi};function In(s,e,t){return Array.isArray(e[0])?(Li(s,0,e,t)||(s=s.slice(),Ri(s,0,e,t)),s):(Oi(s,0,e,t)||(s=s.slice(),Gi(s,0,e,t)),s)}function Kt(s,e){var r;const t=s.geometry;if(!t)return[];if(Array.isArray(t))return t.map(o=>Kt({...s,geometry:o})).flat();const i=t.type==="MultiPolygon"?"Polygon":t.type;if(i==="GeometryCollection"||i==="Circle")throw new Error("Unsupported geometry type: "+i);const n=t.layout.length;return st(new It(i,i==="Polygon"?In(t.flatCoordinates,t.ends,n):t.flatCoordinates,(r=t.ends)==null?void 0:r.flat(),n,s.properties||{},s.id).enableSimplifyTransformed(),!1,e)}function ot(s,e){if(!s)return null;if(Array.isArray(s)){const i=s.map(n=>ot(n,e));return new Ci(i)}const t=jn[s.type];return st(new t(s.flatCoordinates,s.layout||"XY",s.ends),!1,e)}class zn extends Gn{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(ve(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(ve(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return k()}readFeaturesFromObject(e,t){return k()}readGeometry(e,t){return this.readGeometryFromObject(ve(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return k()}readProjection(e){return this.readProjectionFromObject(ve(e))}readProjectionFromObject(e){return k()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return k()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return k()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return k()}}function ve(s){if(typeof s=="string"){const e=JSON.parse(s);return e||null}return s!==null?s:null}class Dn extends zn{constructor(e){e=e||{},super(),this.dataProjection=W(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=W(e.featureProjection)),e.featureClass&&(this.featureClass=e.featureClass),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let i=null;e.type==="Feature"?i=e:i={type:"Feature",geometry:e,properties:null};const n=at(i.geometry);if(this.featureClass===It)return Kt({geometry:n,id:i.id,properties:i.properties},t);const r=new ye;return this.geometryName_?r.setGeometryName(this.geometryName_):this.extractGeometryName_&&i.geometry_name&&r.setGeometryName(i.geometry_name),r.setGeometry(ot(n,t)),"id"in i&&r.setId(i.id),i.properties&&r.setProperties(i.properties,!0),r}readFeaturesFromObject(e,t){const i=e;let n=null;if(i.type==="FeatureCollection"){const r=e;n=[];const o=r.features;for(let u=0,l=o.length;u<l;++u){const a=this.readFeatureFromObject(o[u],t);a&&n.push(a)}}else n=[this.readFeatureFromObject(e,t)];return n.flat()}readGeometryFromObject(e,t){return Nn(e,t)}readProjectionFromObject(e){const t=e.crs;let i;if(t)if(t.type=="name")i=W(t.properties.name);else if(t.type==="EPSG")i=W("EPSG:"+t.properties.code);else throw new Error("Unknown SRS type");else i=this.dataProjection;return i}writeFeatureObject(e,t){t=this.adaptOptions(t);const i={type:"Feature",geometry:null,properties:null},n=e.getId();if(n!==void 0&&(i.id=n),!e.hasProperties())return i;const r=e.getProperties(),o=e.getGeometry();return o&&(i.geometry=Je(o,t),delete r[e.getGeometryName()]),ji(r)||(i.properties=r),i}writeFeaturesObject(e,t){t=this.adaptOptions(t);const i=[];for(let n=0,r=e.length;n<r;++n)i.push(this.writeFeatureObject(e[n],t));return{type:"FeatureCollection",features:i}}writeGeometryObject(e,t){return Je(e,this.adaptOptions(t))}}function at(s,e){if(!s)return null;let t;switch(s.type){case"Point":{t=Xn(s);break}case"LineString":{t=Un(s);break}case"Polygon":{t=Kn(s);break}case"MultiPoint":{t=Vn(s);break}case"MultiLineString":{t=Zn(s);break}case"MultiPolygon":{t=Wn(s);break}case"GeometryCollection":{t=kn(s);break}default:throw new Error("Unsupported GeoJSON type: "+s.type)}return t}function Nn(s,e){const t=at(s);return ot(t,e)}function kn(s,e){return s.geometries.map(function(i){return at(i)})}function Xn(s){const e=s.coordinates;return{type:"Point",flatCoordinates:e,layout:fe(e.length)}}function Un(s){var i;const e=s.coordinates,t=e.flat();return{type:"LineString",flatCoordinates:t,ends:[t.length],layout:fe(((i=e[0])==null?void 0:i.length)||2)}}function Zn(s){var r,o;const e=s.coordinates,t=((o=(r=e[0])==null?void 0:r[0])==null?void 0:o.length)||2,i=[],n=Dt(i,0,e,t);return{type:"MultiLineString",flatCoordinates:i,ends:n,layout:fe(t)}}function Vn(s){var t;const e=s.coordinates;return{type:"MultiPoint",flatCoordinates:e.flat(),layout:fe(((t=e[0])==null?void 0:t.length)||2)}}function Wn(s){var r,o;const e=s.coordinates,t=[],i=((o=(r=e[0])==null?void 0:r[0])==null?void 0:o[0].length)||2,n=Ii(t,0,e,i);return{type:"MultiPolygon",flatCoordinates:t,ends:n,layout:fe(i)}}function Kn(s){var r,o;const e=s.coordinates,t=[],i=(o=(r=e[0])==null?void 0:r[0])==null?void 0:o.length,n=Dt(t,0,e,i);return{type:"Polygon",flatCoordinates:t,ends:n,layout:fe(i)}}function Je(s,e){s=st(s,!0,e);const t=s.getType();let i;switch(t){case"Point":{i=Jn(s);break}case"LineString":{i=Yn(s);break}case"Polygon":{i=$n(s,e);break}case"MultiPoint":{i=Hn(s);break}case"MultiLineString":{i=qn(s);break}case"MultiPolygon":{i=Qn(s,e);break}case"GeometryCollection":{i=Bn(s,e);break}case"Circle":{i={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+t)}return i}function Bn(s,e){return e=Object.assign({},e),delete e.featureProjection,{type:"GeometryCollection",geometries:s.getGeometriesArray().map(function(i){return Je(i,e)})}}function Yn(s,e){return{type:"LineString",coordinates:s.getCoordinates()}}function qn(s,e){return{type:"MultiLineString",coordinates:s.getCoordinates()}}function Hn(s,e){return{type:"MultiPoint",coordinates:s.getCoordinates()}}function Qn(s,e){let t;return e&&(t=e.rightHanded),{type:"MultiPolygon",coordinates:s.getCoordinates(t)}}function Jn(s,e){return{type:"Point",coordinates:s.getCoordinates()}}function $n(s,e){let t;return e&&(t=e.rightHanded),{type:"Polygon",coordinates:s.getCoordinates(t)}}var er=Xi();const tr=kt(er),gr=(s,e)=>{try{let t=s.getLayerGroup().getLayers().getArray().find(i=>i instanceof Rt&&i.get("title")===e);return t||(t=new zi({layers:[]}),t.set("title",e),s.addLayer(t)),t}catch(t){console.error(t),tr({text:t,duration:3e3}).showToast()}};class fr{constructor(e,t){this.map=e,this.options=t,this.layer=new Re({visible:!0,zIndex:100,source:new Oe({}),style:this._styleFunction}),this.duration=1e3,this.start=Date.now(),t.title&&this.layer.set("title",t.title),this.getSource().on("addfeature",i=>{this._flash(i.feature)})}_styleFromUrl(e){return new O({image:new pe({anchor:[.5,.5],src:e})})}_styleName(e){return new O({text:new ue({font:"12px Arial",offsetY:27,offsetX:0,fill:new D({color:"#000"}),stroke:new j({color:"#fff",width:4}),text:e})})}_styleFunction(e){return nr.default}_flash(e){const t=performance.now(),i=e.getGeometry().clone();e._flashListenerKey&&(He(e._flashListenerKey),e._flashListenerKey=null);let n=!0;const r=u=>{if(!n)return;if(u-t>=this.duration){n=!1,e._flashListenerKey&&(He(e._flashListenerKey),e._flashListenerKey=null),this.map.render();return}this.map.render(),requestAnimationFrame(r)},o=u=>{if(!n)return;u.frameState;const c=(performance.now()-t)/this.duration,h=Pe(c)*25+5,f=Pe(1-c),m=Nt(u),g=new O({image:new Q({radius:h,stroke:new j({color:`rgba(142, 245, 39, ${f})`,width:3*f})})});m.setStyle(g),m.drawGeometry(i)};e._flashListenerKey=this.layer.on("postrender",o),requestAnimationFrame(r)}addFeature(e){const t=this.layer.getSource(),i=new Le(de([e.x,e.y])),n=new ye(i);e.fleet&&e.avatar&&e.uniqueid&&(n.set("fleet",e.fleet),n.set("avatar_icon",e.avatar),n.set("unique_id",e.uniqueid),n.setStyle([this._styleFromUrl(e.avatar),this._styleName(e.userId)])),t&&t.addFeature(n)}clearFeatures(){const e=this.layer.getSource();e&&e.clear()}getSource(){return this.layer.getSource()}}class mr{constructor(e,t){this.map=e,this.options=t,this.layer=new Re({visible:!0,source:new Oe({}),style:this._styleFunction}),this.geojsonFormat=new Dn({dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"}),this.mapGeoFences={},this.featureCounters={},this.layer.getSource().on("addfeature",i=>{this.mapGeoFences[i.feature.get("Name")]=i.feature,this.featureCounters[i.feature.get("Name")]=0}),t.title&&this.layer.set("title",t.title)}_styleFunction(e,t){const i=vt.default;let n=i.getText();return n&&n.setText(e.get("Name")),i}addLayer(){this.layer.setVisible(!0),this.map.addLayer(this.layer)}removeLayer(){this.map.removeLayer(this.layer)}getSource(){return this.layer.getSource()}incrementUserCount(e){this.featureCounters[e]=this.featureCounters[e]+1}decrementUserCount(e){this.featureCounters[e]>0&&(this.featureCounters[e]=this.featureCounters[e]-1)}getFeatureCount(e){return this.featureCounters[e]}async setSource(e){try{const i=await(await fetch(e)).json();if(i.data&&i.data.length>0){const n=this.layer.getSource();n&&(n.clear(),i.data.forEach(r=>{if(r.object)try{const o=JSON.parse(r.object);this.geojsonFormat.readFeatures(o).forEach(l=>{l.set("Name",r.id);let a=null;o.type==="FeatureCollection"?o.features&&o.features.length>0&&(a=o.features[0].properties):(o.type,a=o.properties),a&&typeof a=="object"&&Object.keys(a).forEach(c=>{const h=a[c];h!=null&&h!==""&&(l.set(c,h),c==="Name"&&l.set("Name",h))}),l.set("fence_id",r.id),n.addFeature(l)})}catch(o){console.error(`Error parsing fence object for ID ${r.id}:`,o),console.log("Problematic object:",r.object)}}))}}catch(t){console.error("Error:",t)}}setVisibility(e){this.layer.setVisible(e)}getLayer(){return this.layer}getStyleByHook(e="default"){return function(t,i){const n=vt[e];let r=n.getText();return r&&r.setText(t.get("Name")),n}}}class pr{constructor(e,t){this.map=e,this.options=t,this.layer=new Re({visible:!0,zIndex:99,source:new Oe({}),style:this._styleFunction.bind(this)}),t.title&&this.layer.set("title",t.title)}_styleFunction(e){const t=e.getGeometry(),i=[new O({stroke:new j({color:e.get("color")||"#3C64E9",width:3})})];return t.getType()==="LineString"&&t.forEachSegment((n,r)=>{const o=r[0]-n[0],u=r[1]-n[1],l=Math.atan2(u,o);i.push(new O({geometry:new Le(r),image:new pe({src:"assets/row_right_16.png",anchor:[.75,.5],rotateWithView:!0,rotation:-l,scale:.7})}))}),i}clearFeatures(){this.layer.getSource().clear()}filterHistoryByMaxSegment(e,t=500){if(!Array.isArray(e)||e.length<2)return e;const i=[e[e.length-1]];for(let n=e.length-2;n>=0;n--){const r=i[i.length-1].coordinates,o=e[n].coordinates;this._calculateDistance(o,r)<=t&&i.push(e[n])}return i.reverse()}_calculateDistance(e,t){const i=m=>m*Math.PI/180,n=i(e[1]),r=i(e[0]),o=i(t[1]),u=i(t[0]),l=6371e3,a=o-n,c=u-r,h=Math.sin(a/2)*Math.sin(a/2)+Math.cos(n)*Math.cos(o)*Math.sin(c/2)*Math.sin(c/2),f=2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h));return l*f}addTrajectory(e,t=""){const i=this.filterHistoryByMaxSegment(e,500);if(!Array.isArray(i)||i.length<2)return;const n=i.map(u=>de(u.coordinates)),r=new ye({geometry:new zt(n),color:t}),o=this.layer.getSource();o&&o.addFeature(r)}}class yr{constructor(e,t){this.map=e,this.options=t,this.layer=new Re({visible:!0,zIndex:101,source:new Oe({})}),t.title&&this.layer.set("title",t.title)}_styleFunction(e){return new O({image:new Q({radius:4,stroke:new j({color:"#2196F3",width:1}),fill:new D({color:"rgba(33, 150, 243, 0.7)"})}),text:new ue({font:"12px Arial",offsetY:-20,offsetX:0,fill:new D({color:"#000"}),stroke:new j({color:"#fff",width:3}),text:e.get("name")||e.get("userId")||"Punto"})})}addFeature(e){const t=this.layer.getSource(),i=new Le(de([e.x,e.y])),n=new ye(i);e.id&&n.set("id",e.id),e.name&&n.set("name",e.name),e.userId&&n.set("userId",e.userId),e.fleet&&n.set("fleet",e.fleet),t&&t.addFeature(n)}clearFeatures(){const e=this.layer.getSource();e&&e.clear()}getSource(){return this.layer.getSource()}getLayer(){return this.layer}setVisibility(e){this.layer.setVisible(e)}}const ir=new Q({radius:5,stroke:new j({color:"red",width:1}),fill:new D({color:"rgba(255, 0, 0, 0.1)"})}),vt={enter:new O({stroke:new j({color:"rgba(191, 44, 44, 1)",lineDash:[4],width:3}),fill:new D({color:"rgba(255, 0, 0, 0.5)"}),text:new ue({text:"enter"})}),cross:new O({stroke:new j({color:"rgba(191, 44, 44, 1)",lineDash:[4],width:3}),fill:new D({color:"rgba(255, 0, 0, 0.5)"}),text:new ue({text:"cross"})}),exit:new O({stroke:new j({color:"blue",width:3}),fill:new D({color:"rgba(212, 212, 212, 0.5)"}),text:new ue({text:"exit"})}),default:new O({stroke:new j({color:"blue",width:3}),fill:new D({color:"rgba(212, 212, 212, 0.5)"}),text:new ue({text:"default",textAlign:"center",textBaseline:"middle",font:"normal 12px Arial",fill:new D({color:"#000"}),stroke:new j({color:"#fff",width:2})})})},nr={default:new O({image:new pe({anchor:[.5,1],src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAACxMAAAsTAQCanBgAAASxSURBVFhHtZdraBxVFMfPnd3sI9mkSbSktURJSNEiFFNrRME2bnzgF/WLii2CKTGINAi1fhGKIvhFBFGwaI1KiwRFpZLQVqVpTKw0VLtFW9qoSWy0ScymadY89r1z/Z+ZmzWbnZlNbPzBzZx77tk5555zHxNBy6Qs2Fk8LzzbM0QPEIkGqDaiXWcMkryKP4MkZb9G+jc3apHeS8d3Rs0xZwoGoN172Eeav0UnsRvdm01tIeRFTWbeLU+G26+ebHYMxDEALXi0QReudyBuNTUrRZ5x6/G2dM+jp5QiD/sAgl/tICEOQCoxFf8VGRV68jnZ8/BBpcjBMgCt6dhOnbSPVXdV0DLxXfq3j3ykulnyAihqOnJnitwnIBabmtVCxrTU7EN632O9SmGgqadB7YOf+NJk1HyVnTPCr7tL3r5+y8trlMIgJ4BLqTUtksTtqmuPQOIEfmo8F8mFEK7NU6X1rapn4FJPqmr6DPvc+z6s1iqVNewoNk80NU40OUYUuUKUwE5zuVE/jzJyQGg1JWW1HamJvhh3sxmYkMXbMftNqmvPxJ9EZ84SnR8iGp4w2/lhoh+h47FCCFddtOzWRtX7NwBB2v1KtIZnPjlKdG6QSNeJvJixBwnk5kWT0PEY2xQoh3T5mpS4aA0Iuk1J+fAL40jzbyNIM5xZOWAdj7EN2zoFIdybbyDysWgGcMd+P9K/wZAtwctmplH7JH7h8GIeY5sZvhqcAtDW/137VIBFI4Ayn4+jMSKyRhae1QJGtnh94Tf2+GJFlcZWNwKIJebTeHCzZznOl0/Gq8/jYlUBuE+3RXGVhlm2Bs79uBKk46xM2KaYs+sQsNSnvMPt2MsLGUBEJDPnWLYGLy2rICpFlXSHIDJsBxu2dSqBnrxYk6E5Fs1FCDQ91a3EfHhWHj8+QWpRKMjsaCms41YHG7Z1yJZIzvbi1DBKng3AMz/cjdRgD9nA+7yyimgLzqoATrwESri4BbzmGNuwrR16elSb7O9RvdxCicYv90mX/1XVtYbP/WScaC6C2qmPHT8WdGk5zgGk38k5k4y8Vf3dEy/izExxN5sBxjUz+IFjFhh24MFsK9cRbUC6ubFcBJ2jc8wVsxdjve0LzpmcANKhvWMiPeucAYbry85ymn3NTTAeC78RGNo/oBQGOQEw1X2PH6RMvEN1VwnMPjV32N3ffGh2yXmTF8AfWMvu8Pd7ka6flOoagfNM/IJr5It924hwnueSFwCTvvD6uGv292acDbj0rwWueyqsXQm11Y90DOA7L69OObtgKdpdHzbp/vWfYuWrf0BWAl4t09MiMvDM2tCeThyz2YW3GMsMLKCf2tUtoqM7sMimlGqZZJ23bgzt6bJzzuACL8DlziGtqjEkiwL3IROlSuuAkfa/KDLw7E1nX+jCtxLuZ3sKBwDk5a5hUbG1j7wV9yAIh29Gdp74hcI/tGz6+aXj+D5ydM4sKwCD8a/HPIGaYxn/ultIc9cpbS7paI820tla/eubp/HFaJv2xTguQitw3pUntn3+ChUFnjd/zg0HUWL6gDj55Gv1RKMhbDzD+P8iyJm7+9DTFDw6QcEjk6Lhvd24Bcqxz1c4IaJ/AMrqpa32gMLfAAAAAElFTkSuQmCC"})}),avatar:new O({image:new pe({anchor:[.5,.5],anchorXUnits:"fraction",src:"data:image/png;base64,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"})}),car:new O({image:new pe({anchor:[.5,1],src:"data:image/png;base64,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"})})};new O({image:new Q({radius:4,stroke:new j({color:"red",width:1}),fill:new D({color:"rgba(255, 0, 0, 0.3)"})})}),new O({stroke:new j({color:"red",width:3.3,lineDash:[4]})}),new O({stroke:new j({color:"green",width:1})}),new O({image:ir}),new O({stroke:new j({color:"#d47c1d",lineDash:[4],width:3}),fill:new D({color:"rgba(212, 124, 29, 0.3)"})}),new O({stroke:new j({color:"#d47c1d",lineDash:[4],width:3}),fill:new D({color:"rgba(212, 124, 29, 0.3)"})}),new O({stroke:new j({color:"magenta",width:2}),fill:new D({color:"magenta"}),image:new Q({radius:10,stroke:new j({color:"magenta"})})}),new O({stroke:new j({color:"red",width:2}),fill:new D({color:"rgba(255,0,0,0.2)"})});const rr=-73.850304,sr=5.151929,or=0,ar=20,lr=5;new O({image:new Q({radius:4,fill:new D({color:"#FFFF00"}),stroke:new j({color:"#292929",width:1})})});new O({image:new Q({radius:6,fill:new D({color:"#EF7F07"}),stroke:new j({color:"#000000",width:1})})});new O({image:new Q({radius:4,fill:new D({color:"#C1E8F7"}),stroke:new j({color:"#000000",width:1})})});new O({image:new Q({radius:5,fill:new D({color:"#818181"}),stroke:new j({color:"818181",width:1})})});function xr(s){const e=Di({attribution:!1,zoom:!0,rotate:!0});let t=document.getElementById("controlSidepanel");t||(console.warn("controlSidepanel no encontrado, creando elemento..."),t=document.createElement("div"),t.id="controlSidepanel",t.className="sidepanel",document.body.appendChild(t));const i=new vn({target:t,coordinateFormat:function(h){return"lon: "+h[0].toFixed(6)+", lat: "+h[1].toFixed(6)},className:"custom-mouse-position",projection:"EPSG:4326"}),n=new _t({title:"OpenStreetMap",type:"base",visible:!0,source:new An({url:"https://{a-c}.tile.osm-tile-electrosoftware.xyz/{z}/{x}/{y}.png"}),zIndex:0}),r=new _t({title:"Code Plus",visible:!1,source:new Wt({attributions:['grid by <a href="https://plus.codes">plus codes</a>'],url:"https://grid.plus.codes/grid/wms/{z}/{x}/{y}.png?col=red"}),zIndex:4}),o=new Ni({controls:e.extend([i]),layers:[n,r],target:s,view:new ki({constrainResolution:!0,center:de([rr,sr]),minZoom:or,maxZoom:ar,zoom:lr})}),u=new Ln({activationMode:"click",tipLabel:"Capas",reverse:!0,groupSelectStyle:"group"});o.addControl(u);const l=new Rn({map:o,target:document.getElementById("controlSidepanel")});o.addControl(l),o.on("pointermove",function(h){if(h.dragging)return;let f=o.getEventPixel(h.originalEvent),m=o.hasFeatureAtPixel(f);o.getTargetElement().style.cursor=m?"pointer":""});const a=3e3;function c(h){const f=Date.now(),m=h.getGeometry().clone(),g=n.on("postrender",_);function _(y){const b=y.frameState.time-f;if(b>=a){He(g);return}const T=Nt(y),v=b/a,x=Pe(v)*25+5,G=Pe(1-v),R=new O({image:new Q({radius:x,stroke:new j({color:"rgba(255, 0, 0, "+G+")",width:.25+G})})});T.setStyle(R),T.drawGeometry(m),o.render()}}return Ie.subscribe("featureSelected",h=>{o.getView().fit(h.getGeometry().getExtent(),{duration:1e3}),c(h)}),Ie.subscribe("centerView",h=>{const f=h.longitud,m=h.latitud,g=h.zoom;o.getView().animate({center:de([f,m]),zoom:g,duration:1500})}),Ie.subscribe("initialView",h=>{const f=h.longitud,m=h.latitud,g=h.zoom;o.getView().setCenter(de([f,m])),o.getView().setZoom(g)}),o}export{fr as G,tr as T,mr as a,pr as b,yr as c,gr as g,xr as i};
